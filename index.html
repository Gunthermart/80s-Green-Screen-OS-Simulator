<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LEONCE EQUITY OS - Terminal</title>
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/lucide-react@latest"></script>

    <style>
        @keyframes jitter { 0% { transform: translate(0,0); } 25% { transform: translate(1px, 1px); } 50% { transform: translate(-1px, 0); } 75% { transform: translate(0, -1px); } 100% { transform: translate(0,0); } }
        .animate-jitter { animation: jitter 0.1s infinite; }
        .animate-ticker { animation: ticker 30s linear infinite; }
        @keyframes ticker { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #020617; }
        ::-webkit-scrollbar-thumb { background: #064e3b; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #10b981; }
        body { cursor: crosshair; background-color: black; margin: 0; overflow: hidden; }
        
        @keyframes width-grow {
            from { width: 0%; }
            to { width: 100%; }
        }
        .animate-width { animation: width-grow 2s ease-in-out forwards; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { 
            Terminal, Shield, X, Activity, BarChart3, LayoutGrid, Maximize2, 
            AlertTriangle, Octagon, Trash2, Database, Zap, Send, MessageSquare, 
            Radar, Cpu, Grid, Lock, Target, Scan, Globe, Crosshair, Wifi, WifiOff 
        } = LucideReact;

        /* --- UTILS --- */
        const getCurrentTime = () => {
            return new Date().toLocaleTimeString('fr-FR', { hour12: false });
        };

        /* --- COMPONENTS --- */

        const SniperHUD = () => {
            const [pos, setPos] = useState({ x: 0, y: 0 });
            const [visible, setVisible] = useState(false);

            useEffect(() => {
                const handleMove = (e) => {
                    setPos({ x: e.clientX, y: e.clientY });
                    if (!visible) setVisible(true);
                };
                window.addEventListener('mousemove', handleMove);
                return () => window.removeEventListener('mousemove', handleMove);
            }, [visible]);

            if (!visible) return null;

            return (
                <div className="pointer-events-none fixed inset-0 z-[60] overflow-hidden mix-blend-difference">
                    <div className="absolute top-0 w-[1px] h-full bg-emerald-500/40" style={{ left: pos.x }} />
                    <div className="absolute left-0 h-[1px] w-full bg-emerald-500/40" style={{ top: pos.y }} />
                    <div className="absolute text-[9px] font-mono text-emerald-400 bg-black/80 px-1 border border-emerald-500/50" style={{ left: pos.x + 10, top: pos.y + 10 }}>X:{pos.x} Y:{pos.y}</div>
                    <div className="absolute w-4 h-4 border border-emerald-500/80" style={{ left: pos.x - 8, top: pos.y - 8 }} />
                </div>
            );
        };

        const LiquidityTerrain = ({ speed = 1 }) => {
            const canvasRef = useRef(null);
            useEffect(() => {
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                let width, height;
                const resize = () => { if (canvas.parentElement) { width = canvas.parentElement.clientWidth; height = canvas.parentElement.clientHeight; canvas.width = width; canvas.height = height; } };
                resize();
                window.addEventListener('resize', resize);

                let offsetZ = 0;
                const gridSize = 40;
                const fov = 300;
                const getNoise = (x, z) => Math.sin(x * 0.1) * Math.cos(z * 0.1) * 20 + Math.sin(z * 0.3) * 10;

                const draw = () => {
                    ctx.fillStyle = 'rgba(0, 5, 2, 0.2)'; ctx.fillRect(0, 0, width, height);
                    ctx.strokeStyle = 'rgba(16, 185, 129, 0.3)'; ctx.lineWidth = 1; ctx.beginPath();
                    const cx = width / 2; const cy = height / 2; const horizon = cy * 0.5;
                    offsetZ -= speed; if (offsetZ <= -gridSize) offsetZ = 0;

                    for(let x = -width; x < width; x += gridSize) {
                        for(let z = 0; z < 800; z += gridSize) {
                            const zDepth = z + offsetZ; if (zDepth < 1) continue;
                            const scale = fov / (fov + zDepth); const scaleNext = fov / (fov + zDepth + gridSize);
                            const gridX = (x - cx) / gridSize; const gridZ = zDepth / gridSize;
                            const px = (x * scale) + cx; const py = (getNoise(gridX, gridZ) * scale) + cy + horizon;
                            const pxNext = (x * scaleNext) + cx; const pyNext = (getNoise(gridX, (zDepth + gridSize) / gridSize) * scaleNext) + cy + horizon;
                            ctx.moveTo(px, py); ctx.lineTo(pxNext, pyNext);
                        }
                    }
                    ctx.stroke();
                    const grad = ctx.createLinearGradient(0, 0, 0, height/2); grad.addColorStop(0, 'black'); grad.addColorStop(1, 'transparent');
                    ctx.fillStyle = grad; ctx.fillRect(0, 0, width, height/2);
                    requestAnimationFrame(draw);
                };
                const animationId = requestAnimationFrame(draw);
                return () => { window.removeEventListener('resize', resize); cancelAnimationFrame(animationId); };
            }, [speed]);
            return <canvas ref={canvasRef} className="absolute inset-0 w-full h-full pointer-events-none z-0 opacity-60" />;
        };

        const Globe3D = () => {
            const canvasRef = useRef(null);
            useEffect(() => {
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                let width, height;
                const resize = () => { if (canvas.parentElement) { width = canvas.parentElement.clientWidth; height = canvas.parentElement.clientHeight; canvas.width = width; canvas.height = height; } };
                resize();
                window.addEventListener('resize', resize);
                const GLOBE_RADIUS = Math.min(width, height) * 0.35;
                const PERSPECTIVE = 800;
                const hubs = [{ lat: 40, lon: -74, label: "NYC" }, { lat: 51, lon: 0, label: "LDN" }, { lat: 35, lon: 139, label: "TKY" }, { lat: 1, lon: 103, label: "SGP" }];
                const getXYZ = (lat, lon, r) => {
                    const phi = (90 - lat) * (Math.PI / 180); const theta = (lon + 180) * (Math.PI / 180);
                    return { x: -(r * Math.sin(phi) * Math.cos(theta)), y: (r * Math.cos(phi)), z: (r * Math.sin(phi) * Math.sin(theta)) };
                };
                const dots = Array.from({length: 400}, () => ({
                    x: (Math.random()-0.5)*2*GLOBE_RADIUS, y: (Math.random()-0.5)*2*GLOBE_RADIUS, z: (Math.random()-0.5)*2*GLOBE_RADIUS, alpha: Math.random()
                }));

                let rotation = 0;
                const draw = () => {
                    ctx.clearRect(0, 0, width, height);
                    rotation += 0.002;
                    const cx = width/2; const cy = height/2;
                    dots.forEach(d => {
                        const rotX = d.x * Math.cos(rotation) - d.z * Math.sin(rotation);
                        const rotZ = d.z * Math.cos(rotation) + d.x * Math.sin(rotation);
                        const scale = PERSPECTIVE / (PERSPECTIVE + rotZ);
                        const px = rotX * scale + cx; const py = d.y * scale + cy;
                        ctx.fillStyle = `rgba(16, 185, 129, ${d.alpha})`;
                        ctx.fillRect(px, py, 1.5, 1.5);
                    });
                    requestAnimationFrame(draw);
                };
                draw();
            }, []);
            return <div className="w-full h-full relative bg-black/60 rounded border border-emerald-500/30 overflow-hidden">
                <canvas ref={canvasRef} className="w-full h-full" />
            </div>;
        };

        const CrtOverlay = ({ stressLevel, isGlitching }) => (
            <div className="pointer-events-none fixed inset-0 z-50 overflow-hidden h-full w-full">
                <div className="absolute inset-0 bg-[linear-gradient(rgba(18,16,16,0)_50%,rgba(0,0,0,0.25)_50%),linear-gradient(90deg,rgba(0,255,0,0.06),rgba(0,0,0,0.02),rgba(0,255,0,0.06))] bg-[length:100%_4px,3px_100%]" />
                <div className="absolute inset-0 bg-[radial-gradient(circle,rgba(0,0,0,0)_60%,rgba(0,0,0,0.8)_100%)]" />
                {stressLevel === 'CRITICAL' && isGlitching && <div className="absolute inset-0 bg-red-500/10 animate-pulse" />}
            </div>
        );

        const FinancialChart = () => {
            const canvasRef = useRef(null);
            useEffect(() => {
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                let points = Array.from({length: 50}, () => Math.random() * 100);
                const draw = () => {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    points.push(Math.random() * 100); points.shift();
                    ctx.beginPath(); ctx.strokeStyle = '#10b981'; ctx.lineWidth = 2;
                    points.forEach((p, i) => {
                        const x = (i / 50) * canvas.width; const y = canvas.height - (p / 100) * canvas.height;
                        if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
                    });
                    ctx.stroke();
                    requestAnimationFrame(draw);
                };
                draw();
            }, []);
            return <canvas ref={canvasRef} className="w-full h-[200px] border border-emerald-500/20 bg-black/40" />;
        };

        const Window = ({ id, title, children, onClose, isOpen, isTiled, type }) => {
            if (!isOpen) return null;
            const borderColor = type === 'alert' ? 'border-red-500/50' : 'border-emerald-500/50';
            return (
                <div className={`flex flex-col bg-gray-950/90 border ${borderColor} backdrop-blur-md overflow-hidden h-full min-h-[250px]`}>
                    <div className={`p-2 border-b ${borderColor} flex justify-between items-center bg-emerald-900/10`}>
                        <span className="text-[10px] font-bold text-emerald-400 uppercase tracking-widest flex items-center gap-2">
                             <Activity size={12}/> {title}
                        </span>
                        <button onClick={() => onClose(id)} className="text-red-500 hover:bg-red-500/10 p-1"><X size={14}/></button>
                    </div>
                    <div className="flex-1 p-3 overflow-auto font-mono text-xs text-emerald-500">
                        {children}
                    </div>
                </div>
            );
        };

        const SecureUplink = () => (
            <div className="space-y-4">
                <div className="bg-emerald-950/30 p-2 border border-emerald-500/20">
                    <p className="text-[10px]">STATUS: ENCRYPTED_UPLINK</p>
                    <p className="text-[10px]">DEST: ANALYST_CORE_01</p>
                </div>
                <textarea className="w-full bg-black border border-emerald-900 p-2 text-emerald-500 h-24 outline-none focus:border-emerald-500" placeholder="WAITING FOR INPUT..."></textarea>
                <button className="w-full bg-emerald-600 text-black font-bold p-2 text-[10px] hover:bg-emerald-400">TRANSMIT</button>
            </div>
        );

        /* --- MAIN APP --- */

        function App() {
            const [booted, setBooted] = useState(false);
            const [windows, setWindows] = useState({ terminal: true, market: true, network: true, contact: false });
            const [history, setHistory] = useState(["> LEONCE_OS INITIALIZED", "> ENCRYPTION ACTIVE", "> TYPE 'help' FOR CMDS"]);
            const [input, setInput] = useState('');
            const [isGlitching, setIsGlitching] = useState(false);

            useEffect(() => {
                setTimeout(() => setBooted(true), 1500);
            }, []);

            const handleCommand = (e) => {
                if (e.key === 'Enter') {
                    const cmd = input.toLowerCase().trim();
                    let newHist = [...history, `partner@leonce:~$ ${input}`];
                    if (cmd === 'help') newHist.push("CMDS: market, network, contact, clear");
                    else if (cmd === 'clear') { setHistory([]); setInput(''); return; }
                    else if (cmd === 'market') setWindows(v => ({...v, market: true}));
                    else if (cmd === 'network') setWindows(v => ({...v, network: true}));
                    else if (cmd === 'contact') setWindows(v => ({...v, contact: true}));
                    else newHist.push(`ERR: UNKNOWN COMMAND '${cmd}'`);
                    setHistory(newHist);
                    setInput('');
                }
            };

            if (!booted) return (
                <div className="h-screen bg-black flex items-center justify-center font-mono text-emerald-500">
                    <div className="text-center">
                        <Shield size={48} className="mx-auto mb-4 animate-pulse" />
                        <p className="tracking-[0.5em] text-sm">BOOTING_LEONCE_OS...</p>
                    </div>
                </div>
            );

            return (
                <div className="h-screen w-screen flex flex-col relative overflow-hidden">
                    <SniperHUD />
                    <CrtOverlay stressLevel="NORMAL" isGlitching={isGlitching} />
                    <LiquidityTerrain />

                    {/* TOP BAR */}
                    <header className="h-12 bg-black border-b border-emerald-900/50 flex justify-between items-center px-4 z-50">
                        <div className="flex items-center gap-4">
                            <Shield size={20} className="text-emerald-500" />
                            <span className="font-bold text-sm tracking-tighter">LEONCE_EQUITY_OS_V5</span>
                        </div>
                        <div className="flex gap-4">
                            <button onClick={() => setWindows(v => ({...v, terminal: !v.terminal}))} className="text-emerald-800 hover:text-emerald-400"><Terminal size={18}/></button>
                            <button onClick={() => setWindows(v => ({...v, market: !v.market}))} className="text-emerald-800 hover:text-emerald-400"><BarChart3 size={18}/></button>
                            <button onClick={() => setWindows(v => ({...v, network: !v.network}))} className="text-emerald-800 hover:text-emerald-400"><Globe size={18}/></button>
                        </div>
                    </header>

                    {/* MAIN CONTENT */}
                    <main className="flex-1 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 p-4 z-10 overflow-auto">
                        <Window id="terminal" title="TERMINAL_MAIN" isOpen={windows.terminal} onClose={(id) => setWindows(v => ({...v, [id]: false}))}>
                            <div className="h-full flex flex-col">
                                <div className="flex-1">
                                    {history.map((line, i) => <div key={i}>{line}</div>)}
                                </div>
                                <div className="flex mt-2">
                                    <span className="mr-2 opacity-50">$</span>
                                    <input autoFocus className="bg-transparent outline-none flex-1" value={input} onChange={e => setInput(e.target.value)} onKeyDown={handleCommand} />
                                </div>
                            </div>
                        </Window>
                        
                        <Window id="market" title="MARKET_PREDICT" isOpen={windows.market} onClose={(id) => setWindows(v => ({...v, [id]: false}))}>
                            <FinancialChart />
                            <div className="mt-4 grid grid-cols-2 gap-2 text-[9px] uppercase">
                                <div className="p-1 bg-emerald-950/20 border border-emerald-500/10">Volatility: High</div>
                                <div className="p-1 bg-emerald-950/20 border border-emerald-500/10">Trend: Bullish</div>
                            </div>
                        </Window>

                        <Window id="network" title="GLOBAL_NEXUS" isOpen={windows.network} onClose={(id) => setWindows(v => ({...v, [id]: false}))}>
                            <Globe3D />
                        </Window>

                        {windows.contact && (
                            <Window id="contact" title="SECURE_UPLINK" isOpen={windows.contact} onClose={(id) => setWindows(v => ({...v, [id]: false}))}>
                                <SecureUplink />
                            </Window>
                        )}
                    </main>

                    {/* FOOTER */}
                    <footer className="h-8 bg-emerald-950/20 border-t border-emerald-900/50 flex items-center z-50">
                        <div className="bg-emerald-900 px-3 h-full flex items-center text-[10px] font-bold text-black tracking-widest">FEED</div>
                        <div className="flex-1 overflow-hidden">
                            <div className="animate-ticker whitespace-nowrap flex text-[10px] gap-8">
                                <span>SYSTEM STATUS: OPTIMAL</span>
                                <span>LATENCY: 12ms</span>
                                <span>ALPHA_DETECTED: BTC +2.4%</span>
                                <span>ENCRYPTION: AES-256</span>
                                <span>SYSTEM STATUS: OPTIMAL</span>
                                <span>LATENCY: 12ms</span>
                            </div>
                        </div>
                    </footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
