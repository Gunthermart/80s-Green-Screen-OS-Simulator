<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minuteur de Cycle Visuel</title>
    <!-- Chargement de Tailwind CSS pour le style -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Style pour la police Inter depuis Google Fonts */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            /* Empêche le rebond du défilement sur mobile */
            overscroll-behavior-y: contain;
        }
        /* Transition douce pour l'offset du cercle de progression */
        .progress-ring__circle {
            transition: stroke-dashoffset 0.5s linear, stroke 0.5s;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen p-4">

    <div class="bg-gray-800 p-6 sm:p-8 rounded-2xl shadow-2xl w-full max-w-md text-center relative">
        
        <!-- Interrupteur Sonore -->
        <div class="absolute top-4 right-4">
            <button id="sound-toggle-btn" title="Activer/Désactiver le son" class="p-2 rounded-full text-gray-400 hover:bg-gray-700 hover:text-white transition-colors">
                <!-- Icône Haut-parleur ON -->
                <svg id="speaker-on-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
                </svg>
                <!-- Icône Haut-parleur OFF -->
                <svg id="speaker-off-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M17 9l4 4m0-4l-4 4" />
                </svg>
            </button>
        </div>

        <h1 class="text-2xl sm:text-3xl font-bold mb-6 text-cyan-400">Minuteur de Cycle</h1>

        <!-- Panneau de configuration -->
        <div id="settings-panel" class="grid grid-cols-2 gap-4 mb-6">
            <div>
                <label for="cycle-duration" class="block text-sm font-medium text-gray-400 mb-1">Cycle (s)</label>
                <input type="number" id="cycle-duration" value="25" min="1" class="w-full bg-gray-700 text-white text-center text-lg sm:text-xl p-2 rounded-lg border-2 border-gray-600 focus:border-cyan-500 focus:ring-cyan-500 outline-none transition" placeholder="Cycle">
            </div>
            <div>
                <label for="pause-duration" class="block text-sm font-medium text-gray-400 mb-1">Pause (s)</label>
                <input type="number" id="pause-duration" value="10" min="0" class="w-full bg-gray-700 text-white text-center text-lg sm:text-xl p-2 rounded-lg border-2 border-gray-600 focus:border-amber-500 focus:ring-amber-500 outline-none transition" placeholder="Pause">
            </div>
        </div>

        <!-- Affichage du minuteur -->
        <div class="relative w-48 h-48 sm:w-64 sm:h-64 mx-auto mb-6 flex items-center justify-center">
            <svg class="w-full h-full" viewBox="0 0 120 120">
                <circle class="text-gray-700" stroke-width="8" stroke="currentColor" fill="transparent" r="52" cx="60" cy="60"/>
                <circle id="progress-circle" class="progress-ring__circle text-cyan-400" stroke-width="8" stroke-linecap="round" stroke="currentColor" fill="transparent" r="52" cx="60" cy="60"/>
            </svg>
            <div class="absolute">
                <div id="time-display" class="text-4xl sm:text-5xl font-bold">25</div>
                <div id="status-display" class="text-sm text-gray-400 h-4 mt-1"></div>
            </div>
        </div>

        <!-- Affichage des cycles -->
        <div class="mb-8">
            <p class="text-base sm:text-lg text-gray-400">Cycles terminés</p>
            <p id="cycle-count-display" class="text-3xl sm:text-4xl font-bold text-green-400">0</p>
        </div>

        <!-- Panneau de contrôle -->
        <div class="flex justify-center space-x-4">
            <button id="start-pause-btn" class="bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-3 px-6 sm:px-8 rounded-lg transition-transform transform hover:scale-105 text-base sm:text-lg">
                Démarrer
            </button>
            <button id="reset-btn" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-3 px-6 sm:px-8 rounded-lg transition-transform transform hover:scale-105 text-base sm:text-lg">
                Réinitialiser
            </button>
        </div>
    </div>

    <script>
        // --- Références aux éléments du DOM ---
        const durationInput = document.getElementById('cycle-duration');
        const pauseInput = document.getElementById('pause-duration');
        const timeDisplay = document.getElementById('time-display');
        const statusDisplay = document.getElementById('status-display');
        const cycleCountDisplay = document.getElementById('cycle-count-display');
        const startPauseBtn = document.getElementById('start-pause-btn');
        const resetBtn = document.getElementById('reset-btn');
        const progressCircle = document.getElementById('progress-circle');
        const soundToggleBtn = document.getElementById('sound-toggle-btn');
        const speakerOnIcon = document.getElementById('speaker-on-icon');
        const speakerOffIcon = document.getElementById('speaker-off-icon');

        // --- Configuration du cercle de progression SVG ---
        const radius = progressCircle.r.baseVal.value;
        const circumference = 2 * Math.PI * radius;
        progressCircle.style.strokeDasharray = `${circumference} ${circumference}`;
        
        // --- Variables d'état ---
        let totalDuration, totalPause;
        let timeLeft, pauseLeft;
        let cycleCount = 0;
        let timerInterval = null;
        let isRunning = false;
        let isPausePhase = false;
        let isSoundEnabled = true;
        let audioCtx = null;

        /**
         * Joue un son "bip" simple.
         */
        function playBeep(frequency = 880, duration = 100) {
            if (!isSoundEnabled || !audioCtx) return;

            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(frequency, audioCtx.currentTime);
            gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration / 1000);
            oscillator.start(audioCtx.currentTime);
            oscillator.stop(audioCtx.currentTime + duration / 1000);
        }

        /**
         * Met à jour les variables de temps depuis les inputs.
         */
        function readInputs() {
            totalDuration = parseInt(durationInput.value, 10) || 25;
            totalPause = parseInt(pauseInput.value, 10) || 10;
        }

        /**
         * Met à jour l'affichage visuel.
         */
        function updateDisplay() {
            let currentLeft, currentTotal;
            
            if (isPausePhase) {
                currentLeft = pauseLeft;
                currentTotal = totalPause;
                timeDisplay.textContent = pauseLeft;
                statusDisplay.textContent = 'Pause';
                progressCircle.classList.remove('text-cyan-400');
                progressCircle.classList.add('text-amber-400');
            } else {
                currentLeft = timeLeft;
                currentTotal = totalDuration;
                timeDisplay.textContent = timeLeft;
                statusDisplay.textContent = 'Cycle en cours';
                progressCircle.classList.remove('text-amber-400');
                progressCircle.classList.add('text-cyan-400');
            }
            
            const progress = currentTotal > 0 ? (currentTotal - currentLeft) / currentTotal : 0;
            const offset = circumference - (progress * circumference);
            progressCircle.style.strokeDashoffset = offset;
        }

        /**
         * Boucle principale du minuteur.
         */
        function timerTick() {
            if (isPausePhase) {
                pauseLeft--;
                if (pauseLeft < 0) {
                    isPausePhase = false;
                    timeLeft = totalDuration;
                    playBeep(523, 100); // Bip début de cycle
                }
            } else {
                timeLeft--;
                if (timeLeft < 0) {
                    cycleCount++;
                    cycleCountDisplay.textContent = cycleCount;
                    playBeep(1046, 150); // Bip fin de cycle

                    if (totalPause > 0) {
                        isPausePhase = true;
                        pauseLeft = totalPause;
                    } else {
                        timeLeft = totalDuration;
                        playBeep(523, 100); // Bip début de cycle
                    }
                }
            }
            updateDisplay();
        }

        /**
         * Démarre ou reprend le minuteur.
         */
        function startTimer() {
            if (isRunning) return;
            
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
            
            if (timerInterval === null) {
                 readInputs();
                 timeLeft = totalDuration;
                 playBeep(523, 100); // Bip de démarrage
            }

            isRunning = true;
            startPauseBtn.textContent = 'Pause';
            startPauseBtn.classList.replace('bg-cyan-500', 'bg-amber-500');
            startPauseBtn.classList.replace('hover:bg-cyan-600', 'hover:bg-amber-600');
            durationInput.disabled = true;
            pauseInput.disabled = true;

            updateDisplay();
            timerInterval = setInterval(timerTick, 1000);
        }

        /**
         * Met le minuteur en pause.
         */
        function pauseTimer() {
            clearInterval(timerInterval);
            isRunning = false;
            startPauseBtn.textContent = 'Reprendre';
            startPauseBtn.classList.replace('bg-amber-500', 'bg-cyan-500');
            startPauseBtn.classList.replace('hover:bg-amber-600', 'hover:bg-cyan-600');
        }

        /**
         * Réinitialise le minuteur.
         */
        function resetTimer() {
            clearInterval(timerInterval);
            timerInterval = null;
            isRunning = false;
            isPausePhase = false;
            cycleCount = 0;
            
            readInputs();
            timeLeft = totalDuration;
            pauseLeft = totalPause;

            cycleCountDisplay.textContent = '0';
            statusDisplay.textContent = '';
            startPauseBtn.textContent = 'Démarrer';
            startPauseBtn.classList.remove('bg-amber-500', 'hover:bg-amber-600');
            startPauseBtn.classList.add('bg-cyan-500', 'hover:bg-cyan-600');
            durationInput.disabled = false;
            pauseInput.disabled = false;
            
            updateDisplay();
        }
        
        // --- Écouteurs d'événements ---
        startPauseBtn.addEventListener('click', () => {
            if (isRunning) {
                pauseTimer();
            } else {
                startTimer();
            }
        });

        resetBtn.addEventListener('click', resetTimer);

        function handleInputChange() {
            if (!isRunning) {
                resetTimer();
            }
        }

        durationInput.addEventListener('change', handleInputChange);
        pauseInput.addEventListener('change', handleInputChange);

        soundToggleBtn.addEventListener('click', () => {
            isSoundEnabled = !isSoundEnabled;
            speakerOnIcon.classList.toggle('hidden');
            speakerOffIcon.classList.toggle('hidden');
        });
        
        // --- Initialisation ---
        resetTimer();

    </script>
</body>
</html>
