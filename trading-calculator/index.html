<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO & Social Meta Tags -->
    <title>Calculateur de Trading - Gestion de Risque et Taille de Position</title>
    <meta name="description" content="Calculateur de trading gratuit pour d√©terminer la taille de position optimale, g√©rer votre risque, et visualiser votre ratio risque/r√©compense (RR) en temps r√©el.">
    <meta name="keywords" content="calculateur de trading, gestion du risque, taille de position, risk reward, ratio RR, trading, finance, bourse, crypto, forex, stop-loss, take-profit">
    <meta name="author" content="Leonce Equity">
    <link rel="canonical" href="https://leonce-equity.com/trading-calculator/">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üßÆ</text></svg>">
    <meta property="og:title" content="Calculateur de Trading - Leonce Equity">
    <meta property="og:description" content="D√©terminez la taille de position optimale, g√©rez votre risque, et visualisez votre ratio risque/r√©compense (RR) en temps r√©el.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://leonce-equity.com/trading-calculator/">
    <meta property="og:image" content="https://leonce-equity.com/trading-calculator/trad.png">
    <meta property="og:image:alt" content="Aper√ßu du calculateur de trading de Leonce Equity montrant l'interface de calcul.">
    <meta property="og:locale" content="fr_FR">
    <meta property="og:site_name" content="Leonce Equity">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Calculateur de Trading - Leonce Equity">
    <meta name="twitter:description" content="D√©terminez la taille de position optimale, g√©rez votre risque, et visualisez votre ratio risque/r√©compense (RR) en temps r√©el.">
    <meta name="twitter:image" content="https://leonce-equity.com/trading-calculator/trad.png">
    <meta name="twitter:url" content="https://leonce-equity.com/trading-calculator/">
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "Calculateur de Trading - Leonce Equity",
      "applicationCategory": "FinanceApplication",
      "operatingSystem": "Web",
      "description": "Un outil web pour aider les traders √† calculer la taille de leur position et √† g√©rer leur risque en fonction de leur capital, de leur stop-loss et de leur take-profit.",
      "url": "https://leonce-equity.com/trading-calculator/",
      "aggregateRating": { "@type": "AggregateRating", "ratingValue": "4.9", "reviewCount": "128" },
      "offers": { "@type": "Offer", "price": "0", "priceCurrency": "USD" }
    }
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --bg-light: #f8f9fa;
            --surface-light: #ffffff;
            --text-primary-light: #212529;
            --text-secondary-light: #6c757d;
            --border-light: #dee2e6;
            --accent-light: #007bff;
            --success-light: #28a745;
            --danger-light: #dc3545;
        }
        html.dark {
            --bg-light: #121212;
            --surface-light: #1e1e1e;
            --text-primary-light: #e9ecef;
            --text-secondary-light: #adb5bd;
            --border-light: #495057;
            --accent-light: #3777d3;
            --success-light: #4CAF50;
            --danger-light: #ff5252;
        }
        body {
            background-color: var(--bg-light);
            color: var(--text-primary-light);
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow: hidden; /* Prevent scrollbars when dragging */
        }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        .transition-all { transition: all 0.3s ease-in-out; }
        .input-field {
            background-color: var(--surface-light);
            border: 1px solid var(--border-light);
            color: var(--text-primary-light);
        }
        .input-field:focus {
            box-shadow: 0 0 0 2px var(--accent-light);
            border-color: var(--accent-light);
            outline: none;
        }
    </style>
</head>
<body class="transition-all">

    <div class="flex flex-col min-h-dvh">
        <main class="flex-grow relative w-full h-full">
            <div id="calculator-window" class="bg-[var(--surface-light)] border border-[var(--border-light)] rounded-2xl shadow-lg w-full max-w-lg absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 transition-all">
                
                <!-- Window Title Bar -->
                <div id="window-title-bar" class="h-10 flex items-center justify-between px-4 bg-[var(--bg-light)] border-b border-[var(--border-light)] rounded-t-2xl cursor-move">
                    <div class="flex items-center space-x-2">
                        <div class="w-3 h-3 rounded-full bg-red-500"></div>
                        <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
                        <div class="w-3 h-3 rounded-full bg-green-500"></div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <div class="relative">
                            <button id="lang-toggle" class="p-2 rounded-full text-[var(--text-secondary-light)] hover:bg-[var(--border-light)] transition-all" aria-label="Select Language">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7 2a1 1 0 011 1v1h4V3a1 1 0 112 0v1h1a2 2 0 012 2v10a2 2 0 01-2 2H3a2 2 0 01-2-2V5a2 2 0 012-2h1V3a1 1 0 011-1zm0 5a1 1 0 000 2h6a1 1 0 100-2H7z" clip-rule="evenodd"></svg>
                            </button>
                            <div id="lang-menu" class="hidden absolute right-0 mt-2 w-36 bg-[var(--surface-light)] rounded-md shadow-lg z-20 border border-[var(--border-light)]">
                                <ul class="py-1">
                                    <li><button data-lang="en" class="lang-option w-full text-left px-4 py-2 text-sm text-[var(--text-primary-light)] hover:bg-[var(--bg-light)]">English</button></li>
                                    <li><button data-lang="fr" class="lang-option w-full text-left px-4 py-2 text-sm text-[var(--text-primary-light)] hover:bg-[var(--bg-light)]">Fran√ßais</button></li>
                                    <li><button data-lang="es" class="lang-option w-full text-left px-4 py-2 text-sm text-[var(--text-primary-light)] hover:bg-[var(--bg-light)]">Espa√±ol</button></li>
                                    <li><button data-lang="de" class="lang-option w-full text-left px-4 py-2 text-sm text-[var(--text-primary-light)] hover:bg-[var(--bg-light)]">Deutsch</button></li>
                                    <li><button data-lang="zh" class="lang-option w-full text-left px-4 py-2 text-sm text-[var(--text-primary-light)] hover:bg-[var(--bg-light)]">‰∏≠Êñá</button></li>
                                </ul>
                            </div>
                        </div>
                        <button id="help-button" class="p-2 rounded-full text-[var(--text-secondary-light)] hover:bg-[var(--border-light)] transition-all" aria-label="Help">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0110 4a3 3 0 013 3c0 1.054-.5 2.003-1.373 2.622a.999.999 0 01-1.43 0A1.999 1.999 0 0010 8a1 1 0 100 2.001v.001a1 1 0 100 2 1 1 0 100-2v-.001a.999.999 0 01.293-.708A2.001 2.001 0 0012 9a1 1 0 10-2 0 1 1 0 00-1 1v1a1 1 0 102 0v-1a1 1 0 00-1-1z" clip-rule="evenodd"></svg>
                        </button>
                        <button id="dark-mode-toggle" class="p-2 rounded-full text-[var(--text-secondary-light)] hover:bg-[var(--border-light)] transition-all" aria-label="Toggle Dark Mode">
                            <svg id="sun-icon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.706-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 14.464A1 1 0 106.465 13.05l-.707-.707a1 1 0 00-1.414 1.414l.707.707zm-1.414-2.12a1 1 0 011.414 0l.707.707a1 1 0 11-1.414 1.414l-.707-.707a1 1 0 010-1.414zM4 11a1 1 0 100-2H3a1 1 0 100 2h1z"></path></svg>
                            <svg id="moon-icon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
                        </button>
                    </div>
                </div>
                
                <!-- Calculator Content -->
                <div class="p-6 sm:p-8">
        
                    <div class="text-center mb-8">
                        <h1 data-i18n="title" class="text-2xl sm:text-3xl font-bold text-[var(--text-primary-light)]">Calculateur de taille de position</h1>
                        <p data-i18n="subtitle" class="text-[var(--text-secondary-light)] mt-1">Calculez votre taille de position et votre ratio risque/r√©compense.</p>
                    </div>
        
                    <div class="grid grid-cols-2 gap-3 mb-6">
                        <button id="long-button" class="trade-type-btn font-semibold py-3 rounded-lg transition-all text-sm">
                            <span data-i18n="long">LONG</span>
                        </button>
                        <button id="short-button" class="trade-type-btn font-semibold py-3 rounded-lg transition-all text-sm">
                            <span data-i18n="short">SHORT</span>
                        </button>
                    </div>
        
                    <div class="space-y-4">
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label for="capital" data-i18n="capitalLabel" class="block text-sm font-medium text-[var(--text-secondary-light)] mb-1">Capital ($)</label>
                                <input type="number" id="capital" data-i18n-placeholder="capitalPlaceholder" class="input-field w-full px-3 py-2 rounded-md" placeholder="10000" />
                            </div>
                            <div>
                                <label for="risk" data-i18n="riskLabel" class="block text-sm font-medium text-[var(--text-secondary-light)] mb-1">Risque (%)</label>
                                <input type="number" id="risk" data-i18n-placeholder="riskPlaceholder" class="input-field w-full px-3 py-2 rounded-md" placeholder="1" />
                            </div>
                        </div>
                        <div>
                            <label for="entry" data-i18n="entryLabel" class="block text-sm font-medium text-[var(--text-secondary-light)] mb-1">Prix d'Entr√©e ($)</label>
                            <input type="number" id="entry" data-i18n-placeholder="entryPlaceholder" class="input-field w-full px-3 py-2 rounded-md" placeholder="50.25" />
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label for="stoploss" data-i18n="stopLossLabel" class="block text-sm font-medium text-[var(--text-secondary-light)] mb-1">Stop-Loss ($)</label>
                                <input type="number" id="stoploss" data-i18n-placeholder="stopLossPlaceholder" class="input-field w-full px-3 py-2 rounded-md" placeholder="49.50" />
                            </div>
                            <div>
                                <label for="takeprofit" data-i18n="takeProfitLabel" class="block text-sm font-medium text-[var(--text-secondary-light)] mb-1">Take-Profit ($)</label>
                                <input type="number" id="takeprofit" data-i18n-placeholder="takeProfitPlaceholder" class="input-field w-full px-3 py-2 rounded-md" placeholder="52.00" />
                            </div>
                        </div>
                         <div>
                            <label for="rr-input" data-i18n="rrInputLabel" class="block text-sm font-medium text-[var(--text-secondary-light)] mb-1">Ratio Risque/R√©compense (1:X)</label>
                            <input type="number" id="rr-input" data-i18n-placeholder="rrInputPlaceholder" class="input-field w-full px-3 py-2 rounded-md" placeholder="2" />
                        </div>
                    </div>
        
                    <div id="error-container" class="hidden mt-6 p-3 bg-red-500/10 text-red-500 dark:text-red-400 rounded-lg">
                        <p id="error-message" class="text-center font-medium text-sm"></p>
                    </div>
    
                    <div id="results-container" class="hidden mt-6 pt-6 border-t border-[var(--border-light)]">
                        <div class="flex justify-center items-center mb-4">
                            <h2 data-i18n="resultsTitle" class="text-lg font-semibold text-[var(--text-primary-light)]">R√©sultats</h2>
                            <button id="copy-results-button" class="ml-3 p-2 rounded-full text-[var(--text-secondary-light)] hover:bg-[var(--border-light)] transition-all" aria-label="Copier les r√©sultats">
                                <svg class="h-5 w-5 pointer-events-none" id="copy-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                  <path d="M7 3a1 1 0 000 2h6a1 1 0 100-2H7zM4 7a1 1 0 011-1h10a1 1 0 110 2H5a1 1 0 01-1-1zM5 11a1 1 0 00-1 1v2a1 1 0 001 1h10a1 1 0 001-1v-2a1 1 0 10-2 0v1H6v-1a1 1 0 00-1-1z" />
                                </svg>
                                <svg class="h-5 w-5 pointer-events-none hidden" id="check-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                  <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                                </svg>
                            </button>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-[var(--bg-light)] p-4 rounded-lg text-center">
                                <span data-i18n="monetaryRisk" class="text-sm text-[var(--text-secondary-light)] block">Risque Mon√©taire</span>
                                <span id="risk-amount" class="text-xl font-bold text-[var(--danger-light)] block mt-1"></span>
                            </div>
                            <div class="bg-[var(--bg-light)] p-4 rounded-lg text-center">
                                <span data-i18n="monetaryGain" class="text-sm text-[var(--text-secondary-light)] block">Gain Mon√©taire</span>
                                <span id="gain-amount" class="text-xl font-bold text-[var(--success-light)] block mt-1"></span>
                            </div>
                            <div class="bg-[var(--bg-light)] p-4 rounded-lg text-center col-span-2">
                                <span data-i18n="positionSize" class="text-sm text-[var(--text-secondary-light)] block">Taille de Position</span>
                                <span id="position-size" class="text-xl font-bold text-[var(--text-primary-light)] block mt-1"></span>
                            </div>
                            <div class="bg-[var(--bg-light)] p-4 rounded-lg text-center col-span-2">
                                <span data-i18n="riskRewardRatio" class="text-sm text-[var(--text-secondary-light)] block">Ratio Risque/R√©compense</span>
                                <span id="rr-ratio" class="text-xl font-bold text-[var(--text-primary-light)] block mt-1"></span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6">
                        <button id="reset-button" data-i18n="reset" class="w-full py-2.5 px-4 rounded-md text-sm font-medium text-[var(--text-secondary-light)] bg-[var(--bg-light)] hover:bg-[var(--border-light)] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-[var(--surface-light)] focus:ring-[var(--accent-light)] transition-all">R√©initialiser</button>
                    </div>
                </div>
            </div>
        </main>
        
        <footer class="text-center p-4">
            <p class="text-sm text-[var(--text-secondary-light)]">
                D√©velopp√© par <a href="https://leonce-equity.com/" target="_blank" rel="noopener noreferrer" class="underline hover:text-[var(--text-primary-light)]">Leonce Equity</a>
            </p>
        </footer>
    </div>


    <div id="help-modal" class="hidden fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50">
        <div class="bg-[var(--surface-light)] border border-[var(--border-light)] rounded-lg shadow-xl w-full max-w-lg p-6 sm:p-8 relative">
            <button id="close-help-modal" class="absolute top-3 right-3 text-[var(--text-secondary-light)] hover:text-[var(--text-primary-light)]">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
            <h2 data-i18n="helpTitle" class="text-xl sm:text-2xl font-bold mb-4 text-[var(--text-primary-light)]">Fonctionnement du Calculateur</h2>
            <div class="space-y-4 text-[var(--text-secondary-light)] text-sm sm:text-base">
                 <div>
                    <h3 data-i18n="helpObjectiveTitle" class="font-semibold text-[var(--text-primary-light)] mb-1">Objectif</h3>
                    <p data-i18n="helpObjectiveText">Cet outil vous aide √† g√©rer votre risque en trading en calculant la taille de position optimale en fonction de votre capital, de votre pourcentage de risque et de votre configuration de trade (prix d'entr√©e, de stop-loss et de take-profit).</p>
                </div>
                <div>
                    <h3 data-i18n="helpHowToTitle" class="font-semibold text-[var(--text-primary-light)] mb-1">Comment l'utiliser</h3>
                    <ul class="space-y-2 list-inside list-disc">
                        <li data-i18n="helpHowToText1">**S√©lectionnez le type de trade :** Choisissez 'LONG' si vous achetez ou 'SHORT' si vous vendez.</li>
                        <li data-i18n="helpHowToText2">**Entrez votre Capital :** Le montant total de votre compte de trading.</li>
                        <li data-i18n="helpHowToText3">**D√©finissez votre Risque :** Le pourcentage de votre capital que vous √™tes pr√™t √† risquer sur ce trade (ex: 1% ou 2%).</li>
                        <li data-i18n="helpHowToText4">**Fixez vos Prix :** Entrez votre prix d'entr√©e, votre prix de stop-loss (o√π vous sortirez si le trade va contre vous) et votre prix de take-profit.</li>
                        <li data-i18n="helpHowToText5" class="pt-2 text-[var(--text-primary-light)] font-medium">Les r√©sultats afficheront automatiquement le montant risqu√©, la taille de position exacte √† prendre et le ratio risque/r√©compense de votre trade.</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- DICTIONNAIRE DE TRADUCTIONS (i18n) ---
        const translations = {
            en: { title: "Position Size Calculator", subtitle: "Calculate your position size and risk/reward ratio.", long: "LONG", short: "SHORT", capitalLabel: "Capital ($)", capitalPlaceholder: "10000", riskLabel: "Risk (%)", riskPlaceholder: "1", entryLabel: "Entry Price ($)", entryPlaceholder: "50.25", stopLossLabel: "Stop-Loss ($)", stopLossPlaceholder: "49.50", takeProfitLabel: "Take-Profit ($)", takeProfitPlaceholder: "52.00", rrInputLabel: "Risk/Reward Ratio (1:X)", rrInputPlaceholder: "2", resultsTitle: "Results", monetaryRisk: "Monetary Risk", monetaryGain: "Monetary Gain", positionSize: "Position Size", riskRewardRatio: "Risk/Reward Ratio", units: "Units", reset: "Reset", errorFillAllFields: "Please fill in all fields to perform the calculation.", errorInvalidNumbers: "Please enter valid numbers for all fields.", errorPositiveValues: "Capital and risk percentage must be greater than zero.", errorPositiveRR: "Risk/Reward ratio must be a positive number.", errorEntryStopSame: "Entry price cannot be the same as the stop-loss price.", errorLongStopLoss: "For a Long trade, stop-loss must be below the entry price.", errorLongTakeProfit: "For a Long trade, take-profit must be above the entry price.", errorShortStopLoss: "For a Short trade, stop-loss must be above the entry price.", errorShortTakeProfit: "For a Short trade, take-profit must be below the entry price.", errorCalculation: "An error occurred during calculation.", helpTitle: "How the Calculator Works", helpObjectiveTitle: "Objective", helpObjectiveText: "This tool helps you manage your risk in trading by calculating the optimal position size based on your capital, risk percentage, and trade setup (entry, stop-loss, and take-profit prices).", helpHowToTitle: "How to Use", helpHowToText1: "**Select Trade Type:** Choose 'LONG' if you are buying or 'SHORT' if you are selling.", helpHowToText2: "**Enter your Capital:** The total amount of money in your trading account.", helpHowToText3: "**Define your Risk:** The percentage of your capital you are willing to risk on this single trade (e.g., 1% or 2%).", helpHowToText4: "**Set your Prices:** Enter your entry price, your stop-loss price (where you will exit if the trade goes against you), and your take-profit price.", helpHowToText5: "The results will automatically show you the amount of money at risk, the exact position size to take, and the risk/reward ratio of your trade.", },
            fr: { title: "Calculateur de taille de position", subtitle: "Calculez votre taille de position et votre ratio risque/r√©compense.", long: "LONG", short: "SHORT", capitalLabel: "Capital ($)", capitalPlaceholder: "10000", riskLabel: "Risque (%)", riskPlaceholder: "1", entryLabel: "Prix d'Entr√©e ($)", entryPlaceholder: "50.25", stopLossLabel: "Stop-Loss ($)", stopLossPlaceholder: "49.50", takeProfitLabel: "Take-Profit ($)", takeProfitPlaceholder: "52.00", rrInputLabel: "Ratio Risque/R√©compense (1:X)", rrInputPlaceholder: "2", resultsTitle: "R√©sultats", monetaryRisk: "Risque Mon√©taire", monetaryGain: "Gain Mon√©taire", positionSize: "Taille de Position", riskRewardRatio: "Ratio Risque/R√©compense", units: "Unit√©s", reset: "R√©initialiser", errorFillAllFields: "Veuillez remplir tous les champs pour effectuer le calcul.", errorInvalidNumbers: "Veuillez entrer des nombres valides pour tous les champs.", errorPositiveValues: "Le capital et le pourcentage de risque doivent √™tre sup√©rieurs √† z√©ro.", errorPositiveRR: "Le ratio Risque/R√©compense doit √™tre un nombre positif.", errorEntryStopSame: "Le prix d'entr√©e ne peut pas √™tre le m√™me que le prix du stop-loss.", errorLongStopLoss: "Pour un achat (Long), le stop-loss doit √™tre inf√©rieur au prix d'entr√©e.", errorLongTakeProfit: "Pour un achat (Long), le take-profit doit √™tre sup√©rieur au prix d'entr√©e.", errorShortStopLoss: "Pour une vente (Short), le stop-loss doit √™tre sup√©rieur au prix d'entr√©e.", errorShortTakeProfit: "Pour une vente (Short), le take-profit doit √™tre inf√©rieur au prix d'entr√©e.", errorCalculation: "Une erreur est survenue lors du calcul.", helpTitle: "Fonctionnement du Calculateur", helpObjectiveTitle: "Objectif", helpObjectiveText: "Cet outil vous aide √† g√©rer votre risque en trading en calculant la taille de position optimale en fonction de votre capital, de votre pourcentage de risque et de votre configuration de trade (prix d'entr√©e, de stop-loss et de take-profit).", helpHowToTitle: "Comment l'utiliser", helpHowToText1: "**S√©lectionnez le type de trade :** Choisissez 'LONG' si vous achetez ou 'SHORT' si vous vendez.", helpHowToText2: "**Entrez votre Capital :** Le montant total de votre compte de trading.", helpHowToText3: "**D√©finissez votre Risque :** Le pourcentage de votre capital que vous √™tes pr√™t √† risquer sur ce trade (ex: 1% ou 2%).", helpHowToText4: "**Fixez vos Prix :** Entrez votre prix d'entr√©e, votre prix de stop-loss (o√π vous sortirez si le trade va contre vous) et votre prix de take-profit.", helpHowToText5: "Les r√©sultats afficheront automatiquement le montant risqu√©, la taille de position exacte √† prendre et le ratio risque/r√©compense de votre trade.", },
            es: { title: "Calculadora de Tama√±o de Posici√≥n", subtitle: "Calcule el tama√±o de su posici√≥n y la relaci√≥n riesgo/recompensa.", long: "COMPRA", short: "VENTA", capitalLabel: "Capital ($)", capitalPlaceholder: "10000", riskLabel: "Riesgo (%)", riskPlaceholder: "1", entryLabel: "Precio de Entrada ($)", entryPlaceholder: "50.25", stopLossLabel: "Stop-Loss ($)", stopLossPlaceholder: "49.50", takeProfitLabel: "Take-Profit ($)", takeProfitPlaceholder: "52.00", rrInputLabel: "Relaci√≥n Riesgo/Recompensa (1:X)", rrInputPlaceholder: "2", resultsTitle: "Resultados", monetaryRisk: "Riesgo Monetario", monetaryGain: "Ganancia Monetaria", positionSize: "Tama√±o de Posici√≥n", riskRewardRatio: "Relaci√≥n Riesgo/Recompensa", units: "Unidades", reset: "Reiniciar", errorFillAllFields: "Por favor, rellene todos los campos para realizar el c√°lculo.", errorInvalidNumbers: "Por favor, introduzca n√∫meros v√°lidos en todos los campos.", errorPositiveValues: "El capital y el porcentaje de riesgo deben ser mayores que cero.", errorPositiveRR: "La relaci√≥n Riesgo/Recompensa debe ser un n√∫mero positivo.", errorEntryStopSame: "El precio de entrada no puede ser el mismo que el stop-loss.", errorLongStopLoss: "Para una compra (Long), el stop-loss debe ser inferior al precio de entrada.", errorLongTakeProfit: "Para una compra (Long), el take-profit debe ser superior al precio de entrada.", errorShortStopLoss: "Para una venta (Short), el stop-loss debe ser superior al precio de entrada.", errorShortTakeProfit: "Para una venta (Short), el take-profit debe ser inferior al precio de entrada.", errorCalculation: "Se ha producido un error durante el c√°lculo.", helpTitle: "C√≥mo Funciona la Calculadora", helpObjectiveTitle: "Objetivo", helpObjectiveText: "Esta herramienta le ayuda a gestionar su riesgo en el trading calculando el tama√±o de posici√≥n √≥ptimo en funci√≥n de su capital, porcentaje de riesgo y configuraci√≥n de la operaci√≥n (precios de entrada, stop-loss y take-profit).", helpHowToTitle: "C√≥mo Usar", helpHowToText1: "**Seleccione el tipo de operaci√≥n:** Elija 'COMPRA' si va a comprar o 'VENTA' si va a vender.", helpHowToText2: "**Introduzca su Capital:** La cantidad total de dinero en su cuenta de trading.", helpHowToText3: "**Defina su Riesgo:** El porcentaje de su capital que est√° dispuesto a arriesgar en esta operaci√≥n (ej: 1% o 2%).", helpHowToText4: "**Establezca sus Precios:** Introduzca su precio de entrada, su precio de stop-loss (donde saldr√° si la operaci√≥n va en su contra) y su precio de take-profit.", helpHowToText5: "Los resultados mostrar√°n autom√°ticamente la cantidad de dinero en riesgo, el tama√±o exacto de la posici√≥n a tomar y la relaci√≥n riesgo/recompensa de su operaci√≥n.", },
            de: { title: "Positionsgr√∂√üen-Rechner", subtitle: "Berechnen Sie Ihre Positionsgr√∂√üe und Ihr Chance-Risiko-Verh√§ltnis.", long: "KAUFEN", short: "VERKAUFEN", capitalLabel: "Kapital ($)", capitalPlaceholder: "10000", riskLabel: "Risiko (%)", riskPlaceholder: "1", entryLabel: "Einstiegspreis ($)", entryPlaceholder: "50.25", stopLossLabel: "Stop-Loss ($)", stopLossPlaceholder: "49.50", takeProfitLabel: "Take-Profit ($)", takeProfitPlaceholder: "52.00", rrInputLabel: "Chance-Risiko-Verh√§ltnis (1:X)", rrInputPlaceholder: "2", resultsTitle: "Ergebnisse", monetaryRisk: "Monet√§res Risiko", monetaryGain: "Monet√§rer Gewinn", positionSize: "Positionsgr√∂√üe", riskRewardRatio: "Chance-Risiko-Verh√§ltnis", units: "Einheiten", reset: "Zur√ºcksetzen", errorFillAllFields: "Bitte f√ºllen Sie alle Felder aus, um die Berechnung durchzuf√ºhren.", errorInvalidNumbers: "Bitte geben Sie f√ºr alle Felder g√ºltige Zahlen ein.", errorPositiveValues: "Kapital und Risikoprozentsatz m√ºssen gr√∂√üer als Null sein.", errorPositiveRR: "Das Chance-Risiko-Verh√§ltnis muss eine positive Zahl sein.", errorEntryStopSame: "Der Einstiegspreis darf nicht mit dem Stop-Loss-Preis identisch sein.", errorLongStopLoss: "Bei einem Kauf (Long) muss der Stop-Loss unter dem Einstiegspreis liegen.", errorLongTakeProfit: "Bei einem Kauf (Long) muss der Take-Profit √ºber dem Einstiegspreis liegen.", errorShortStopLoss: "Bei einem Verkauf (Short) muss der Stop-Loss √ºber dem Einstiegspreis liegen.", errorShortTakeProfit: "Bei einem Verkauf (Short) muss der Take-Profit unter dem Einstiegspreis liegen.", errorCalculation: "Bei der Berechnung ist ein Fehler aufgetreten.", helpTitle: "So Funktioniert der Rechner", helpObjectiveTitle: "Ziel", helpObjectiveText: "Dieses Tool hilft Ihnen, Ihr Risiko beim Trading zu managen, indem es die optimale Positionsgr√∂√üe basierend auf Ihrem Kapital, Ihrem Risikoprozentsatz und Ihrem Trade-Setup (Einstiegs-, Stop-Loss- und Take-Profit-Preise) berechnet.", helpHowToTitle: "Anwendung", helpHowToText1: "**Trade-Typ ausw√§hlen:** W√§hlen Sie 'KAUFEN', wenn Sie kaufen, oder 'VERKAUFEN', wenn Sie verkaufen.", helpHowToText2: "**Ihr Kapital eingeben:** Der Gesamtbetrag auf Ihrem Handelskonto.", helpHowToText3: "**Ihr Risiko definieren:** Der Prozentsatz Ihres Kapitals, den Sie bereit sind, bei diesem einen Trade zu riskieren (z.B. 1% oder 2%).", helpHowToText4: "**Ihre Preise festlegen:** Geben Sie Ihren Einstiegspreis, Ihren Stop-Loss-Preis (wo Sie aussteigen, wenn der Trade gegen Sie l√§uft) und Ihren Take-Profit-Preis ein.", helpHowToText5: "Die Ergebnisse zeigen Ihnen automatisch den riskierten Geldbetrag, die exakte Positionsgr√∂√üe und das Chance-Risiko-Verh√§ltnis Ihres Trades an.", },
            zh: { title: "Â§¥ÂØ∏ËßÑÊ®°ËÆ°ÁÆóÂô®", subtitle: "ËÆ°ÁÆóÊÇ®ÁöÑÂ§¥ÂØ∏ËßÑÊ®°ÂíåÈ£éÈô©/ÂõûÊä•Áéá„ÄÇ", long: "ÂÅöÂ§ö", short: "ÂÅöÁ©∫", capitalLabel: "ËµÑÈáë ($)", capitalPlaceholder: "10000", riskLabel: "È£éÈô© (%)", riskPlaceholder: "1", entryLabel: "ÂÖ•Âú∫‰ª∑ ($)", entryPlaceholder: "50.25", stopLossLabel: "Ê≠¢Êçü‰ª∑ ($)", stopLossPlaceholder: "49.50", takeProfitLabel: "Ê≠¢Áõà‰ª∑ ($)", takeProfitPlaceholder: "52.00", rrInputLabel: "È£éÈô©/ÂõûÊä•Áéá (1:X)", rrInputPlaceholder: "2", resultsTitle: "ÁªìÊûú", monetaryRisk: "È£éÈô©ÈáëÈ¢ù", monetaryGain: "ÊΩúÂú®Êî∂Áõä", positionSize: "Â§¥ÂØ∏ËßÑÊ®°", riskRewardRatio: "È£éÈô©/ÂõûÊä•Áéá", units: "Âçï‰Ωç", reset: "ÈáçÁΩÆ", errorFillAllFields: "ËØ∑Â°´ÂÜôÊâÄÊúâÂ≠óÊÆµ‰ª•ÊâßË°åËÆ°ÁÆó„ÄÇ", errorInvalidNumbers: "ËØ∑ËæìÂÖ•ÊâÄÊúâÂ≠óÊÆµÁöÑÊúâÊïàÊï∞Â≠ó„ÄÇ", errorPositiveValues: "ËµÑÈáëÂíåÈ£éÈô©ÁôæÂàÜÊØîÂøÖÈ°ªÂ§ß‰∫éÈõ∂„ÄÇ", errorPositiveRR: "È£éÈô©/ÂõûÊä•ÁéáÂøÖÈ°ªÊòØÊ≠£Êï∞„ÄÇ", errorEntryStopSame: "ÂÖ•Âú∫‰ª∑‰∏çËÉΩ‰∏éÊ≠¢Êçü‰ª∑Áõ∏Âêå„ÄÇ", errorLongStopLoss: "ÂÅöÂ§ö‰∫§ÊòìÔºåÊ≠¢Êçü‰ª∑ÂøÖÈ°ª‰Ωé‰∫éÂÖ•Âú∫‰ª∑„ÄÇ", errorLongTakeProfit: "ÂÅöÂ§ö‰∫§ÊòìÔºåÁõà‰ª∑ÂøÖÈ°ªÈ´ò‰∫éÂÖ•Âú∫‰ª∑„ÄÇ", errorShortStopLoss: "ÂÅöÁ©∫‰∫§ÊòìÔºåÊ≠¢Êçü‰ª∑ÂøÖÈ°ªÈ´ò‰∫éÂÖ•Âú∫‰ª∑„ÄÇ", errorShortTakeProfit: "ÂÅöÁ©∫‰∫§ÊòìÔºåÊ≠¢Áõà‰ª∑ÂøÖÈ°ª‰Ωé‰∫éÂÖ•Âú∫‰ª∑„ÄÇ", errorCalculation: "ËÆ°ÁÆóËøáÁ®ã‰∏≠ÂèëÁîüÈîôËØØ„ÄÇ", helpTitle: "ËÆ°ÁÆóÂô®Â¶Ç‰ΩïÂ∑•‰Ωú", helpObjectiveTitle: "ÁõÆÊ†á", helpObjectiveText: "ËØ•Â∑•ÂÖ∑ÈÄöËøáÊ†πÊçÆÊÇ®ÁöÑËµÑÈáë„ÄÅÈ£éÈô©ÁôæÂàÜÊØîÂíå‰∫§ÊòìËÆæÁΩÆÔºàÂÖ•Âú∫‰ª∑„ÄÅÊ≠¢Êçü‰ª∑ÂíåÊ≠¢Áõà‰ª∑ÔºâËÆ°ÁÆóÊúÄ‰Ω≥Â§¥ÂØ∏ËßÑÊ®°ÔºåÂ∏ÆÂä©ÊÇ®ÁÆ°ÁêÜ‰∫§ÊòìÈ£éÈô©„ÄÇ", helpHowToTitle: "Â¶Ç‰Ωï‰ΩøÁî®", helpHowToText1: "**ÈÄâÊã©‰∫§ÊòìÁ±ªÂûãÔºö** Â¶ÇÊûúÊÇ®ÊòØ‰π∞ÂÖ•ÔºåËØ∑ÈÄâÊã©‚ÄúÂÅöÂ§ö‚ÄùÔºõÂ¶ÇÊûúÊÇ®ÊòØÂçñÂá∫ÔºåËØ∑ÈÄâÊã©‚ÄúÂÅöÁ©∫‚Äù„ÄÇ", helpHowToText2: "**ËæìÂÖ•ÊÇ®ÁöÑËµÑÈáëÔºö** ÊÇ®‰∫§ÊòìË¥¶Êà∑‰∏≠ÁöÑÊÄªÈáëÈ¢ù„ÄÇ", helpHowToText3: "**ÂÆö‰πâÊÇ®ÁöÑÈ£éÈô©Ôºö** ÊÇ®ÊÑøÊÑèÂú®Ê≠§Ê¨°‰∫§Êòì‰∏≠ÊâøÊãÖÁöÑËµÑÈáëÁôæÂàÜÊØîÔºà‰æãÂ¶Ç1%Êàñ2%Ôºâ„ÄÇ", helpHowToText4: "**ËÆæÁΩÆÊÇ®ÁöÑ‰ª∑Ê†ºÔºö** ËæìÂÖ•ÊÇ®ÁöÑÂÖ•Âú∫‰ª∑„ÄÅÊ≠¢Êçü‰ª∑ÔºàÂ¶ÇÊûú‰∫§ÊòìÂØπÊÇ®‰∏çÂà©ÔºåÊÇ®Â∞ÜÂú®Ê≠§ÈÄÄÂá∫ÔºâÂíåÊ≠¢Áõà‰ª∑„ÄÇ", helpHowToText5: "ÁªìÊûúÂ∞ÜËá™Âä®ÊòæÁ§∫ÊÇ®ÁöÑÈ£éÈô©ÈáëÈ¢ù„ÄÅÂ∫îÊåÅÊúâÁöÑÁ°ÆÂàáÂ§¥ÂØ∏ËßÑÊ®°‰ª•Âèä‰∫§ÊòìÁöÑÈ£éÈô©/ÂõûÊä•Áéá„ÄÇ", },
        };
    
        document.addEventListener('DOMContentLoaded', () => {
            let isDarkMode = false, language, tradeType = 'long', lastEdited = 'tp', lastValidResults = null;
    
            const docHtml = document.documentElement;
            const darkModeToggle = document.getElementById('dark-mode-toggle');
            const sunIcon = document.getElementById('sun-icon');
            const moonIcon = document.getElementById('moon-icon');
            const longButton = document.getElementById('long-button');
            const shortButton = document.getElementById('short-button');
            const helpButton = document.getElementById('help-button');
            const helpModal = document.getElementById('help-modal');
            const closeHelpModal = document.getElementById('close-help-modal');
            const langToggle = document.getElementById('lang-toggle');
            const langMenu = document.getElementById('lang-menu');
            const copyResultsButton = document.getElementById('copy-results-button');
            const copyIcon = document.getElementById('copy-icon');
            const checkIcon = document.getElementById('check-icon');
            
            const inputs = {
                capital: document.getElementById('capital'), risk: document.getElementById('risk'),
                entry: document.getElementById('entry'), stoploss: document.getElementById('stoploss'),
                takeprofit: document.getElementById('takeprofit'), rr_input: document.getElementById('rr-input'),
            };
            const containers = { error: document.getElementById('error-container'), results: document.getElementById('results-container') };
            const displays = {
                errorMessage: document.getElementById('error-message'), riskAmount: document.getElementById('risk-amount'),
                gainAmount: document.getElementById('gain-amount'), positionSize: document.getElementById('position-size'),
                rrRatio: document.getElementById('rr-ratio'),
            };
            
            const saveParameters = () => {
                try {
                    const params = {
                        ...Object.fromEntries(Object.entries(inputs).map(([k, v]) => [k, v.value])),
                        tradeType, language, isDarkMode, lastEdited
                    };
                    localStorage.setItem('tradingCalcParams', JSON.stringify(params));
                } catch (e) { console.error("Could not save parameters:", e); }
            };
    
            const loadParameters = () => {
                try {
                    const savedParamsJSON = localStorage.getItem('tradingCalcParams');
                    let savedParams = savedParamsJSON ? JSON.parse(savedParamsJSON) : null;

                    if (savedParams) {
                        Object.keys(inputs).forEach(key => { inputs[key].value = savedParams[key] || ''; });
                        lastEdited = savedParams.lastEdited || 'tp';
                        toggleDarkMode(savedParams.isDarkMode || false, true);
                        setTradeType(savedParams.tradeType || 'long', true);
                        updateLanguage(savedParams.language || 'fr', true);
                    } else {
                        const browserLang = navigator.language.split('-')[0];
                        const supportedLangs = Object.keys(translations);
                        const initialLang = supportedLangs.includes(browserLang) ? browserLang : 'fr';
                        updateLanguage(initialLang);
                        setTradeType('long');
                        toggleDarkMode(window.matchMedia?.('(prefers-color-scheme: dark)').matches);
                    }
                } catch (e) { console.error("Could not load parameters:", e); }
            };
    
            const updateLanguage = (lang, skipSave = false) => {
                language = lang;
                docHtml.lang = lang;
                const t = translations[lang];
                document.querySelectorAll('[data-i18n]').forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    if (t[key]) el.innerHTML = t[key];
                });
                document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                    const key = el.getAttribute('data-i18n-placeholder');
                    if (t[key]) el.placeholder = t[key];
                });
                calculatePosition();
                if (!skipSave) saveParameters();
            };
    
            const toggleDarkMode = (isDark, skipSave = false) => {
                isDarkMode = isDark;
                docHtml.classList.toggle('dark', isDarkMode);
                sunIcon.style.display = isDarkMode ? 'none' : 'block';
                moonIcon.style.display = isDarkMode ? 'block' : 'none';
                if(!skipSave) saveParameters();
            };
    
            const setTradeType = (type, skipCalculation = false) => {
                tradeType = type;
                if (type === 'long') {
                    longButton.style.backgroundColor = 'var(--success-light)';
                    longButton.style.color = '#fff';
                    shortButton.style.backgroundColor = 'transparent';
                    shortButton.style.color = 'var(--text-secondary-light)';
                } else {
                    shortButton.style.backgroundColor = 'var(--danger-light)';
                    shortButton.style.color = '#fff';
                    longButton.style.backgroundColor = 'transparent';
                    longButton.style.color = 'var(--text-secondary-light)';
                }
                if (!skipCalculation) calculatePosition();
                saveParameters();
            };
            
            const setError = (key) => {
                containers.results.classList.add('hidden');
                containers.error.classList.toggle('hidden', !key);
                if (key) displays.errorMessage.innerText = translations[language][key];
            };
    
            const setResults = (results) => {
                setError(null);
                containers.results.classList.remove('hidden');
                const t = translations[language];
                displays.riskAmount.innerText = `$${results.riskAmount}`;
                displays.gainAmount.innerText = `$${results.gainAmount}`;
                displays.positionSize.innerText = `${results.positionSize} ${t.units}`;
                displays.rrRatio.innerText = `1 : ${results.riskRewardRatio}`;
                lastValidResults = results;
            };
            
            const calculatePosition = () => {
                const requiredFields = ['capital', 'risk', 'entry', 'stoploss'];
                if (requiredFields.some(k => !inputs[k].value)) return setError(null);
                if ((lastEdited === 'tp' && !inputs.takeprofit.value) || (lastEdited === 'rr' && !inputs.rr_input.value)) return setError(null);
                
                const v = Object.fromEntries(Object.entries(inputs).map(([k, v]) => [k, parseFloat(v.value)]));
                if (requiredFields.some(k => isNaN(v[k]))) return setError('errorInvalidNumbers');
                if (v.capital <= 0 || v.risk <= 0) return setError('errorPositiveValues');
                if (v.entry === v.stoploss) return setError('errorEntryStopSame');

                try {
                    const slDiff = tradeType === 'long' ? v.entry - v.stoploss : v.stoploss - v.entry;
                    if (slDiff <= 0) return setError(tradeType === 'long' ? 'errorLongStopLoss' : 'errorShortStopLoss');

                    if (lastEdited === 'rr') {
                        if (isNaN(v.rr_input) || v.rr_input <= 0) return setError('errorPositiveRR');
                        const tpDiff = slDiff * v.rr_input;
                        v.takeprofit = tradeType === 'long' ? (v.entry + tpDiff) : (v.entry - tpDiff);
                        inputs.takeprofit.value = v.takeprofit.toFixed(4).replace(/(\.0+|0+)$/, '');
                    } else {
                        if (isNaN(v.takeprofit)) return;
                        const tpDiff = tradeType === 'long' ? v.takeprofit - v.entry : v.entry - v.takeprofit;
                        if (tpDiff <= 0) return setError(tradeType === 'long' ? 'errorLongTakeProfit' : 'errorShortTakeProfit');
                        v.rr_input = tpDiff / slDiff;
                        inputs.rr_input.value = v.rr_input.toFixed(2);
                    }

                    if (isNaN(v.rr_input) || !isFinite(v.rr_input)) return setError(null);
                    
                    const riskAmount = v.capital * (v.risk / 100);
                    const gainAmount = riskAmount * v.rr_input;
                    const positionSize = riskAmount / slDiff;
                    
                    const resultsData = {
                        riskAmount: riskAmount.toFixed(2), gainAmount: gainAmount.toFixed(2),
                        positionSize: positionSize.toFixed(4), riskRewardRatio: v.rr_input.toFixed(2)
                    };
                    setResults(resultsData);
                } catch { setError('errorCalculation'); }
            };
            
            const handleInputChange = () => { calculatePosition(); saveParameters(); };
            
            document.getElementById('reset-button').addEventListener('click', () => {
                Object.values(inputs).forEach(i => i.value = '');
                setError(null);
                lastValidResults = null;
                localStorage.removeItem('tradingCalcParams');
                setTradeType('long'); 
            });

            copyResultsButton.addEventListener('click', () => {
                if (!lastValidResults) return;

                const t = translations[language];
                const v = Object.fromEntries(Object.entries(inputs).map(([k, val]) => [k, val.value]));

                const textToCopy = [
                    `-- Calcul de Position --`,
                    `${t.long}/${t.short}: ${tradeType.toUpperCase()}`,
                    `------------------------`,
                    `${t.capitalLabel}: $${v.capital}`,
                    `${t.riskLabel}: ${v.risk}%`,
                    `${t.entryLabel}: $${v.entry}`,
                    `${t.stopLossLabel}: $${v.stoploss}`,
                    `${t.takeProfitLabel}: $${v.takeprofit}`,
                    `------------------------`,
                    `${t.monetaryRisk}: $${lastValidResults.riskAmount}`,
                    `${t.monetaryGain}: $${lastValidResults.gainAmount}`,
                    `${t.positionSize}: ${lastValidResults.positionSize} ${t.units}`,
                    `${t.riskRewardRatio}: 1 : ${lastValidResults.riskRewardRatio}`
                ].join('\n');

                const textArea = document.createElement("textarea");
                textArea.value = textToCopy;
                textArea.style.position = "fixed";
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                try {
                    document.execCommand('copy');
                    copyIcon.classList.add('hidden');
                    checkIcon.classList.remove('hidden');
                    setTimeout(() => {
                        copyIcon.classList.remove('hidden');
                        checkIcon.classList.add('hidden');
                    }, 2000);
                } catch (err) {
                    console.error('Impossible de copier', err);
                }
                document.body.removeChild(textArea);
            });
            
            Object.values(inputs).forEach(i => i.addEventListener('input', handleInputChange));
            inputs.takeprofit.addEventListener('focus', () => lastEdited = 'tp');
            inputs.rr_input.addEventListener('focus', () => lastEdited = 'rr');

            longButton.addEventListener('click', () => setTradeType('long'));
            shortButton.addEventListener('click', () => setTradeType('short'));
            darkModeToggle.addEventListener('click', () => toggleDarkMode(!isDarkMode));
            helpButton.addEventListener('click', () => helpModal.classList.remove('hidden'));
            closeHelpModal.addEventListener('click', () => helpModal.classList.add('hidden'));
            helpModal.addEventListener('click', (e) => { if (e.target === helpModal) helpModal.classList.add('hidden'); });
            langToggle.addEventListener('click', () => langMenu.classList.toggle('hidden'));
            document.querySelectorAll('.lang-option').forEach(o => o.addEventListener('click', (e) => {
                updateLanguage(e.target.dataset.lang);
                langMenu.classList.add('hidden');
            }));
            document.addEventListener('click', (e) => { if (!langToggle.contains(e.target) && !langMenu.contains(e.target)) langMenu.classList.add('hidden'); });
    
            // --- Drag and Drop Logic ---
            const calculatorWindow = document.getElementById('calculator-window');
            const titleBar = document.getElementById('window-title-bar');
            let isDragging = false;
            let offsetX, offsetY;

            const startDrag = (e) => {
                isDragging = true;
                const clientX = e.clientX || e.touches[0].clientX;
                const clientY = e.clientY || e.touches[0].clientY;

                offsetX = clientX - calculatorWindow.getBoundingClientRect().left;
                offsetY = clientY - calculatorWindow.getBoundingClientRect().top;
                
                calculatorWindow.style.transition = 'none'; // Disable transition during drag
                document.body.style.userSelect = 'none'; // Prevent text selection

                document.addEventListener('mousemove', onDrag);
                document.addEventListener('mouseup', stopDrag);
                document.addEventListener('touchmove', onDrag, { passive: false });
                document.addEventListener('touchend', stopDrag);
            };

            const onDrag = (e) => {
                if (!isDragging) return;
                e.preventDefault();

                const clientX = e.clientX || e.touches[0].clientX;
                const clientY = e.clientY || e.touches[0].clientY;

                let newX = clientX - offsetX;
                let newY = clientY - offsetY;

                // Boundary collision detection
                const windowRect = calculatorWindow.getBoundingClientRect();
                newX = Math.max(0, Math.min(newX, window.innerWidth - windowRect.width));
                newY = Math.max(0, Math.min(newY, window.innerHeight - windowRect.height));

                calculatorWindow.style.left = `${newX}px`;
                calculatorWindow.style.top = `${newY}px`;
                calculatorWindow.style.transform = 'none'; // Remove initial centering transform
            };

            const stopDrag = () => {
                isDragging = false;
                calculatorWindow.style.transition = 'all 0.3s ease-in-out';
                document.body.style.userSelect = '';

                document.removeEventListener('mousemove', onDrag);
                document.removeEventListener('mouseup', stopDrag);
                document.removeEventListener('touchmove', onDrag);
                document.removeEventListener('touchend', stopDrag);
            };

            titleBar.addEventListener('mousedown', startDrag);
            titleBar.addEventListener('touchstart', startDrag, { passive: false });
            
            loadParameters();
        });
    </script>
</body>
</html>

