<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Titre optimis√© pour le SEO -->
    <title>Calculateur de Trading - Gestion de Risque et Taille de Position</title>

    <!-- Meta Tags SEO -->
    <meta name="description" content="Calculateur de trading gratuit pour d√©terminer la taille de position optimale, g√©rer votre risque, et visualiser votre ratio risque/r√©compense (RR) en temps r√©el.">
    <meta name="keywords" content="calculateur de trading, gestion du risque, taille de position, risk reward, ratio RR, trading, finance, bourse, crypto, forex, stop-loss, take-profit">
    <meta name="author" content="Leonce Equity">
    <link rel="canonical" href="https://leonce-equity.com/trading-calculator/">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üßÆ</text></svg>">

    <!-- Open Graph Meta Tags (pour le partage sur les r√©seaux sociaux comme Facebook, LinkedIn) -->
    <meta property="og:title" content="Calculateur de Trading - Leonce Equity">
    <meta property="og:description" content="D√©terminez la taille de position optimale, g√©rez votre risque, et visualisez votre ratio risque/r√©compense (RR) en temps r√©el.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://leonce-equity.com/trading-calculator/">
    <meta property="og:image" content="https://leonce-equity.com/trading-calculator/trad.png">
    <meta property="og:image:alt" content="Aper√ßu du calculateur de trading de Leonce Equity montrant l'interface de calcul.">
    <meta property="og:locale" content="fr_FR">
    <meta property="og:site_name" content="Leonce Equity">

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Calculateur de Trading - Leonce Equity">
    <meta name="twitter:description" content="D√©terminez la taille de position optimale, g√©rez votre risque, et visualisez votre ratio risque/r√©compense (RR) en temps r√©el.">
    <meta name="twitter:image" content="https://leonce-equity.com/trading-calculator/trad.png">
    <meta name="twitter:url" content="https://leonce-equity.com/trading-calculator/">

    <!-- JSON-LD for Rich Snippets (pour un affichage am√©lior√© dans les r√©sultats de recherche) -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "Calculateur de Trading - Leonce Equity",
      "applicationCategory": "FinanceApplication",
      "operatingSystem": "Web",
      "description": "Un outil web pour aider les traders √† calculer la taille de leur position et √† g√©rer leur risque en fonction de leur capital, de leur stop-loss et de leur take-profit.",
      "url": "https://leonce-equity.com/trading-calculator/",
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "4.9",
        "reviewCount": "128"
      },
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      }
    }
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            /* Elegant Light Mode Palette */
            --color-background: #FDF6E3;
            --color-card-background: #FFFFFF;
            --color-secondary-background: #E6D8AD;
            --color-text-main: #333333;
            --color-text-secondary: #777777;
            --color-border: #D1C4A8;
            --color-input-background: #FFFFFF;
            --color-accent-primary: #B0C4DE; /* Sky Blue */
            --color-accent-primary-text: #FFFFFF;
            --color-accent-success: #6B8E23; /* Olive Drab */
            --color-accent-danger: #8B0000; /* Deep Red */
            --color-accent-danger-bg: #FADADD;
        }
        html.dark {
            /* Elegant Dark Mode Palette */
            --color-background: #121212;
            --color-card-background: #1E1E1E;
            --color-secondary-background: #2a2a2a;
            --color-text-main: rgba(255, 255, 255, 0.87);
            --color-text-secondary: rgba(255, 255, 255, 0.60);
            --color-border: #646464;
            --color-input-background: #2a2a2a;
            --color-accent-primary: #3777d3; /* Soft Blue */
            --color-accent-primary-text: #FFFFFF;
            --color-accent-success: #4CAF50; /* Desaturated Green */
            --color-accent-danger: #ff3232; /* Light Red */
            --color-accent-danger-bg: rgba(255, 50, 50, 0.15);
        }
        body {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background-color: var(--color-background);
            color: var(--color-text-main);
            transition: background-color 0.3s, color 0.3s;
        }
        /* Simple transition for modals */
        .modal-enter { opacity: 0; transform: scale(0.95); }
        .modal-enter-active { opacity: 1; transform: scale(1); transition: opacity 200ms, transform 200ms; }
        .modal-leave { opacity: 1; transform: scale(1); }
        .modal-leave-active { opacity: 0; transform: scale(0.95); transition: opacity 200ms, transform 200ms; }
    </style>
</head>
<body class="font-sans">

    <div class="flex flex-col min-h-dvh">
        <main class="flex-grow flex flex-col items-center justify-center p-4">
            <div class="bg-[var(--color-card-background)] p-6 sm:p-8 rounded-xl shadow-2xl w-full max-w-md relative transition-colors duration-300">
                
                <!-- Header Icons -->
                <div class="absolute top-4 right-4 flex items-center space-x-2">
                    <!-- Language Selector -->
                    <div class="relative">
                        <button id="lang-toggle" class="p-2 rounded-full text-[var(--color-text-secondary)] hover:bg-black/10 dark:hover:bg-white/10 transition-colors duration-200" aria-label="Select Language">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1V10a1 1 0 00-1-1H7a1 1 0 00-1 1v10a1 1 0 001 1h2a1 1 0 001-1zm-1-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 01-1 1h-2a1 1 0 01-1-1v-4z" /></svg>
                        </button>
                        <div id="lang-menu" class="hidden absolute right-0 mt-2 w-36 bg-[var(--color-card-background)] rounded-md shadow-lg z-20 border border-[var(--color-border)]">
                            <ul class="py-1">
                                <li><button data-lang="en" class="lang-option w-full text-left px-4 py-2 text-sm text-[var(--color-text-main)] hover:bg-[var(--color-secondary-background)]/50">English</button></li>
                                <li><button data-lang="fr" class="lang-option w-full text-left px-4 py-2 text-sm text-[var(--color-text-main)] hover:bg-[var(--color-secondary-background)]/50">Fran√ßais</button></li>
                                <li><button data-lang="es" class="lang-option w-full text-left px-4 py-2 text-sm text-[var(--color-text-main)] hover:bg-[var(--color-secondary-background)]/50">Espa√±ol</button></li>
                                <li><button data-lang="de" class="lang-option w-full text-left px-4 py-2 text-sm text-[var(--color-text-main)] hover:bg-[var(--color-secondary-background)]/50">Deutsch</button></li>
                                <li><button data-lang="zh" class="lang-option w-full text-left px-4 py-2 text-sm text-[var(--color-text-main)] hover:bg-[var(--color-secondary-background)]/50">‰∏≠Êñá</button></li>
                            </ul>
                        </div>
                    </div>
                    <!-- Help Button -->
                    <button id="help-button" class="p-2 rounded-full text-[var(--color-text-secondary)] hover:bg-black/10 dark:hover:bg-white/10 transition-colors duration-200" aria-label="Help">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                    </button>
                    <!-- Dark Mode Toggle -->
                    <button id="dark-mode-toggle" class="p-2 rounded-full text-[var(--color-text-secondary)] hover:bg-black/10 dark:hover:bg-white/10 transition-colors duration-200" aria-label="Toggle Dark Mode">
                        <svg id="sun-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-yellow-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" /></svg>
                        <svg id="moon-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>
                    </button>
                </div>
    
                <h1 data-i18n="title" class="text-2xl sm:text-3xl font-bold mb-2 text-center pt-10">Trading Calculator</h1>
                <p data-i18n="subtitle" class="text-center text-[var(--color-text-secondary)] mb-6 text-sm sm:text-base">Calculate your position size and risk/reward ratio.</p>
    
                <!-- Trade Type Toggle -->
                <div class="flex justify-center mb-6">
                    <div class="flex rounded-lg p-1 bg-[var(--color-secondary-background)]/50">
                        <button id="long-button" data-i18n="long" class="px-4 sm:px-6 py-2 text-sm font-bold rounded-md transition-all duration-300">LONG</button>
                        <button id="short-button" data-i18n="short" class="px-4 sm:px-6 py-2 text-sm font-bold rounded-md transition-all duration-300">SHORT</button>
                    </div>
                </div>
    
                <!-- Input Fields -->
                <div class="space-y-4">
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <label for="capital" data-i18n="capitalLabel" class="block text-sm font-medium text-[var(--color-text-secondary)]">Capital ($)</label>
                            <input type="number" id="capital" data-i18n-placeholder="capitalPlaceholder" class="input-field mt-1 block w-full px-3 py-2 bg-[var(--color-input-background)] border border-[var(--color-border)] rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-accent-primary)]" placeholder="10000" />
                        </div>
                        <div>
                            <label for="risk" data-i18n="riskLabel" class="block text-sm font-medium text-[var(--color-text-secondary)]">Risk (%)</label>
                            <input type="number" id="risk" data-i18n-placeholder="riskPlaceholder" class="input-field mt-1 block w-full px-3 py-2 bg-[var(--color-input-background)] border border-[var(--color-border)] rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-accent-primary)]" placeholder="1" />
                        </div>
                    </div>
                    <div>
                        <label for="entry" data-i18n="entryLabel" class="block text-sm font-medium text-[var(--color-text-secondary)]">Entry Price ($)</label>
                        <input type="number" id="entry" data-i18n-placeholder="entryPlaceholder" class="input-field mt-1 block w-full px-3 py-2 bg-[var(--color-input-background)] border border-[var(--color-border)] rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-accent-primary)]" placeholder="50.25" />
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <label for="stoploss" data-i18n="stopLossLabel" class="block text-sm font-medium text-[var(--color-text-secondary)]">Stop-Loss ($)</label>
                            <input type="number" id="stoploss" data-i18n-placeholder="stopLossPlaceholder" class="input-field mt-1 block w-full px-3 py-2 bg-[var(--color-input-background)] border border-[var(--color-border)] rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-accent-primary)]" placeholder="49.50" />
                        </div>
                        <div>
                            <label for="takeprofit" data-i18n="takeProfitLabel" class="block text-sm font-medium text-[var(--color-text-secondary)]">Take-Profit ($)</label>
                            <input type="number" id="takeprofit" data-i18n-placeholder="takeProfitPlaceholder" class="input-field mt-1 block w-full px-3 py-2 bg-[var(--color-input-background)] border border-[var(--color-border)] rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-accent-primary)]" placeholder="52.00" />
                        </div>
                    </div>
                     <div>
                        <label for="rr-input" data-i18n="rrInputLabel" class="block text-sm font-medium text-[var(--color-text-secondary)]">Risk/Reward Ratio (1:X)</label>
                        <input type="number" id="rr-input" data-i18n-placeholder="rrInputPlaceholder" class="input-field mt-1 block w-full px-3 py-2 bg-[var(--color-input-background)] border border-[var(--color-border)] rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-accent-primary)]" placeholder="2" />
                    </div>
                </div>
    
                <!-- Error & Results -->
                <div id="error-container" class="hidden mt-6 p-3 bg-[var(--color-accent-danger-bg)] text-[var(--color-accent-danger)] rounded-lg">
                    <p id="error-message" class="text-center font-medium text-sm"></p>
                </div>
                <div id="results-container" class="hidden mt-6 p-4 sm:p-6 bg-[var(--color-accent-primary)]/20 rounded-lg border border-[var(--color-accent-primary)]/50">
                    <h2 data-i18n="resultsTitle" class="text-xl sm:text-2xl font-semibold mb-4 text-center">Results</h2>
                    <div class="space-y-3 text-sm sm:text-base">
                        <div class="flex justify-between items-center">
                            <span data-i18n="monetaryRisk" class="font-medium text-[var(--color-text-secondary)]">Monetary Risk:</span>
                            <span id="risk-amount" class="font-bold text-lg sm:text-xl text-[var(--color-accent-danger)]"></span>
                        </div>
                         <div class="flex justify-between items-center">
                            <span data-i18n="monetaryGain" class="font-medium text-[var(--color-text-secondary)]">Monetary Gain:</span>
                            <span id="gain-amount" class="font-bold text-lg sm:text-xl text-[var(--color-accent-success)]"></span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span data-i18n="positionSize" class="font-medium text-[var(--color-text-secondary)]">Position Size:</span>
                            <span id="position-size" class="font-bold text-lg sm:text-xl text-[var(--color-text-main)]"></span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span data-i18n="riskRewardRatio" class="font-medium text-[var(--color-text-secondary)]">Risk/Reward Ratio:</span>
                            <span id="rr-ratio" class="font-bold text-lg sm:text-xl text-[var(--color-text-main)]"></span>
                        </div>
                    </div>
                </div>
                
                <!-- Reset Button -->
                <div class="mt-6">
                    <button id="reset-button" data-i18n="reset" class="w-full py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-[var(--color-text-secondary)] bg-black/10 hover:bg-black/20 dark:bg-white/10 dark:hover:bg-white/20 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-colors">Reset</button>
                </div>
            </div>
        </main>
        
        <footer class="text-center p-4">
            <p class="text-sm text-[var(--color-text-secondary)]">
                D√©velopp√© par <a href="https://leonce-equity.com/" target="_blank" rel="noopener noreferrer" class="underline hover:text-[var(--color-text-main)]">Leonce Equity</a>
            </p>
        </footer>
    </div>


    <!-- Help Modal -->
    <div id="help-modal" class="hidden fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50">
        <div class="bg-[var(--color-card-background)] rounded-lg shadow-xl w-full max-w-lg p-6 sm:p-8 relative">
            <button id="close-help-modal" class="absolute top-4 right-4 text-[var(--color-text-secondary)] hover:text-[var(--color-text-main)]">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
            <h2 data-i18n="helpTitle" class="text-xl sm:text-2xl font-bold mb-4 text-[var(--color-text-main)]">How the Calculator Works</h2>
            <div class="space-y-4 text-[var(--color-text-secondary)] text-sm sm:text-base">
                <div>
                    <h3 data-i18n="helpObjectiveTitle" class="font-semibold text-[var(--color-text-main)] mb-1">Objective</h3>
                    <p data-i18n="helpObjectiveText">This tool helps you manage your risk...</p>
                </div>
                <div>
                    <h3 data-i18n="helpHowToTitle" class="font-semibold text-[var(--color-text-main)] mb-1">How to Use</h3>
                    <ul class="space-y-2 list-inside">
                        <li data-i18n="helpHowToText1">1. **Select Trade Type:** ...</li>
                        <li data-i18n="helpHowToText2">2. **Enter your Capital:** ...</li>
                        <li data-i18n="helpHowToText3">3. **Define your Risk:** ...</li>
                        <li data-i18n="helpHowToText4">4. **Set your Prices:** ...</li>
                        <li data-i18n="helpHowToText5" class="pt-2 text-[var(--color-text-main)]">The results will automatically show...</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- DICTIONNAIRE DE TRADUCTIONS (i18n) ---
        const translations = {
            en: { title: "Trading Calculator", subtitle: "Calculate your position size and risk/reward ratio.", long: "LONG", short: "SHORT", capitalLabel: "Capital ($)", capitalPlaceholder: "10000", riskLabel: "Risk (%)", riskPlaceholder: "1", entryLabel: "Entry Price ($)", entryPlaceholder: "50.25", stopLossLabel: "Stop-Loss ($)", stopLossPlaceholder: "49.50", takeProfitLabel: "Take-Profit ($)", takeProfitPlaceholder: "52.00", rrInputLabel: "Risk/Reward Ratio (1:X)", rrInputPlaceholder: "2", resultsTitle: "Results", monetaryRisk: "Monetary Risk:", monetaryGain: "Monetary Gain:", positionSize: "Position Size:", riskRewardRatio: "Risk/Reward Ratio:", units: "Units", reset: "Reset", errorFillAllFields: "Please fill in all fields to perform the calculation.", errorInvalidNumbers: "Please enter valid numbers for all fields.", errorPositiveValues: "Capital and risk percentage must be greater than zero.", errorPositiveRR: "Risk/Reward ratio must be a positive number.", errorEntryStopSame: "Entry price cannot be the same as the stop-loss price.", errorLongStopLoss: "For a Long trade, stop-loss must be below the entry price.", errorLongTakeProfit: "For a Long trade, take-profit must be above the entry price.", errorShortStopLoss: "For a Short trade, stop-loss must be above the entry price.", errorShortTakeProfit: "For a Short trade, take-profit must be below the entry price.", errorCalculation: "An error occurred during calculation.", helpTitle: "How the Calculator Works", helpObjectiveTitle: "Objective", helpObjectiveText: "This tool helps you manage your risk in trading by calculating the optimal position size based on your capital, risk percentage, and trade setup (entry, stop-loss, and take-profit prices).", helpHowToTitle: "How to Use", helpHowToText1: "1. **Select Trade Type:** Choose 'LONG' if you are buying or 'SHORT' if you are selling.", helpHowToText2: "2. **Enter your Capital:** The total amount of money in your trading account.", helpHowToText3: "3. **Define your Risk:** The percentage of your capital you are willing to risk on this single trade (e.g., 1% or 2%).", helpHowToText4: "4. **Set your Prices:** Enter your entry price, your stop-loss price (where you will exit if the trade goes against you), and your take-profit price.", helpHowToText5: "The results will automatically show you the amount of money at risk, the exact position size to take, and the risk/reward ratio of your trade.", },
            fr: { title: "Calculateur de Trading", subtitle: "Calculez votre taille de position et votre ratio risque/r√©compense.", long: "LONG", short: "SHORT", capitalLabel: "Capital ($)", capitalPlaceholder: "10000", riskLabel: "Risque (%)", riskPlaceholder: "1", entryLabel: "Prix d'Entr√©e ($)", entryPlaceholder: "50.25", stopLossLabel: "Stop-Loss ($)", stopLossPlaceholder: "49.50", takeProfitLabel: "Take-Profit ($)", takeProfitPlaceholder: "52.00", rrInputLabel: "Ratio Risque/R√©compense (1:X)", rrInputPlaceholder: "2", resultsTitle: "R√©sultats", monetaryRisk: "Risque Mon√©taire:", monetaryGain: "Gain Mon√©taire:", positionSize: "Taille de la Position:", riskRewardRatio: "Ratio Risque/R√©compense:", units: "Unit√©s", reset: "R√©initialiser", errorFillAllFields: "Veuillez remplir tous les champs pour effectuer le calcul.", errorInvalidNumbers: "Veuillez entrer des nombres valides pour tous les champs.", errorPositiveValues: "Le capital et le pourcentage de risque doivent √™tre sup√©rieurs √† z√©ro.", errorPositiveRR: "Le ratio Risque/R√©compense doit √™tre un nombre positif.", errorEntryStopSame: "Le prix d'entr√©e ne peut pas √™tre le m√™me que le prix du stop-loss.", errorLongStopLoss: "Pour un achat (Long), le stop-loss doit √™tre inf√©rieur au prix d'entr√©e.", errorLongTakeProfit: "Pour un achat (Long), le take-profit doit √™tre sup√©rieur au prix d'entr√©e.", errorShortStopLoss: "Pour une vente (Short), le stop-loss doit √™tre sup√©rieur au prix d'entr√©e.", errorShortTakeProfit: "Pour une vente (Short), le take-profit doit √™tre inf√©rieur au prix d'entr√©e.", errorCalculation: "Une erreur est survenue lors du calcul.", helpTitle: "Fonctionnement du Calculateur", helpObjectiveTitle: "Objectif", helpObjectiveText: "Cet outil vous aide √† g√©rer votre risque en trading en calculant la taille de position optimale en fonction de votre capital, de votre pourcentage de risque et de votre configuration de trade (prix d'entr√©e, de stop-loss et de take-profit).", helpHowToTitle: "Comment l'utiliser", helpHowToText1: "1. **S√©lectionnez le type de trade :** Choisissez 'LONG' si vous achetez ou 'SHORT' si vous vendez.", helpHowToText2: "2. **Entrez votre Capital :** Le montant total de votre compte de trading.", helpHowToText3: "3. **D√©finissez votre Risque :** Le pourcentage de votre capital que vous √™tes pr√™t √† risquer sur ce trade (ex: 1% ou 2%).", helpHowToText4: "4. **Fixez vos Prix :** Entrez votre prix d'entr√©e, votre prix de stop-loss (o√π vous sortirez si le trade va contre vous) et votre prix de take-profit.", helpHowToText5: "Les r√©sultats afficheront automatiquement le montant risqu√©, la taille de position exacte √† prendre et le ratio risque/r√©compense de votre trade.", },
            es: { title: "Calculadora de Trading", subtitle: "Calcule el tama√±o de su posici√≥n y la relaci√≥n riesgo/recompensa.", long: "COMPRA", short: "VENTA", capitalLabel: "Capital ($)", capitalPlaceholder: "10000", riskLabel: "Riesgo (%)", riskPlaceholder: "1", entryLabel: "Precio de Entrada ($)", entryPlaceholder: "50.25", stopLossLabel: "Stop-Loss ($)", stopLossPlaceholder: "49.50", takeProfitLabel: "Take-Profit ($)", takeProfitPlaceholder: "52.00", rrInputLabel: "Relaci√≥n Riesgo/Recompensa (1:X)", rrInputPlaceholder: "2", resultsTitle: "Resultados", monetaryRisk: "Riesgo Monetario:", monetaryGain: "Ganancia Monetaria:", positionSize: "Tama√±o de Posici√≥n:", riskRewardRatio: "Relaci√≥n Riesgo/Recompensa:", units: "Unidades", reset: "Reiniciar", errorFillAllFields: "Por favor, rellene todos los campos para realizar el c√°lculo.", errorInvalidNumbers: "Por favor, introduzca n√∫meros v√°lidos en todos los campos.", errorPositiveValues: "El capital y el porcentaje de riesgo deben ser mayores que cero.", errorPositiveRR: "La relaci√≥n Riesgo/Recompensa debe ser un n√∫mero positivo.", errorEntryStopSame: "El precio de entrada no puede ser el mismo que el stop-loss.", errorLongStopLoss: "Para una compra (Long), el stop-loss debe ser inferior al precio de entrada.", errorLongTakeProfit: "Para una compra (Long), el take-profit debe ser superior al precio de entrada.", errorShortStopLoss: "Para una venta (Short), el stop-loss debe ser superior al precio de entrada.", errorShortTakeProfit: "Para una venta (Short), el take-profit debe ser inferior al precio de entrada.", errorCalculation: "Se ha producido un error durante el c√°lculo.", helpTitle: "C√≥mo Funciona la Calculadora", helpObjectiveTitle: "Objetivo", helpObjectiveText: "Esta herramienta le ayuda a gestionar su riesgo en el trading calculando el tama√±o de posici√≥n √≥ptimo en funci√≥n de su capital, porcentaje de riesgo y configuraci√≥n de la operaci√≥n (precios de entrada, stop-loss y take-profit).", helpHowToTitle: "C√≥mo Usar", helpHowToText1: "1. **Seleccione el tipo de operaci√≥n:** Elija 'COMPRA' si va a comprar o 'VENTA' si va a vender.", helpHowToText2: "2. **Introduzca su Capital:** La cantidad total de dinero en su cuenta de trading.", helpHowToText3: "3. **Defina su Riesgo:** El porcentaje de su capital que est√° dispuesto a arriesgar en esta operaci√≥n (ej: 1% o 2%).", helpHowToText4: "4. **Establezca sus Precios:** Introduzca su precio de entrada, su precio de stop-loss (donde saldr√° si la operaci√≥n va en su contra) y su precio de take-profit.", helpHowToText5: "Los resultados mostrar√°n autom√°ticamente la cantidad de dinero en riesgo, el tama√±o exacto de la posici√≥n a tomar y la relaci√≥n riesgo/recompensa de su operaci√≥n.", },
            de: { title: "Trading-Rechner", subtitle: "Berechnen Sie Ihre Positionsgr√∂√üe und Ihr Chance-Risiko-Verh√§ltnis.", long: "KAUFEN", short: "VERKAUFEN", capitalLabel: "Kapital ($)", capitalPlaceholder: "10000", riskLabel: "Risiko (%)", riskPlaceholder: "1", entryLabel: "Einstiegspreis ($)", entryPlaceholder: "50.25", stopLossLabel: "Stop-Loss ($)", stopLossPlaceholder: "49.50", takeProfitLabel: "Take-Profit ($)", takeProfitPlaceholder: "52.00", rrInputLabel: "Chance-Risiko-Verh√§ltnis (1:X)", rrInputPlaceholder: "2", resultsTitle: "Ergebnisse", monetaryRisk: "Monet√§res Risiko:", monetaryGain: "Monet√§rer Gewinn:", positionSize: "Positionsgr√∂√üe:", riskRewardRatio: "Chance-Risiko-Verh√§ltnis:", units: "Einheiten", reset: "Zur√ºcksetzen", errorFillAllFields: "Bitte f√ºllen Sie alle Felder aus, um die Berechnung durchzuf√ºhren.", errorInvalidNumbers: "Bitte geben Sie f√ºr alle Felder g√ºltige Zahlen ein.", errorPositiveValues: "Kapital und Risikoprozentsatz m√ºssen gr√∂√üer als Null sein.", errorPositiveRR: "Das Chance-Risiko-Verh√§ltnis muss eine positive Zahl sein.", errorEntryStopSame: "Der Einstiegspreis darf nicht mit dem Stop-Loss-Preis identisch sein.", errorLongStopLoss: "Bei einem Kauf (Long) muss der Stop-Loss unter dem Einstiegspreis liegen.", errorLongTakeProfit: "Bei einem Kauf (Long) muss der Take-Profit √ºber dem Einstiegspreis liegen.", errorShortStopLoss: "Bei einem Verkauf (Short) muss der Stop-Loss √ºber dem Einstiegspreis liegen.", errorShortTakeProfit: "Bei einem Verkauf (Short) muss der Take-Profit unter dem Einstiegspreis liegen.", errorCalculation: "Bei der Berechnung ist ein Fehler aufgetreten.", helpTitle: "So Funktioniert der Rechner", helpObjectiveTitle: "Ziel", helpObjectiveText: "Dieses Tool hilft Ihnen, Ihr Risiko beim Trading zu managen, indem es die optimale Positionsgr√∂√üe basierend auf Ihrem Kapital, Ihrem Risikoprozentsatz und Ihrem Trade-Setup (Einstiegs-, Stop-Loss- und Take-Profit-Preise) berechnet.", helpHowToTitle: "Anwendung", helpHowToText1: "1. **Trade-Typ ausw√§hlen:** W√§hlen Sie 'KAUFEN', wenn Sie kaufen, oder 'VERKAUFEN', wenn Sie verkaufen.", helpHowToText2: "2. **Ihr Kapital eingeben:** Der Gesamtbetrag auf Ihrem Handelskonto.", helpHowToText3: "3. **Ihr Risiko definieren:** Der Prozentsatz Ihres Kapitals, den Sie bereit sind, bei diesem einen Trade zu riskieren (z.B. 1% oder 2%).", helpHowToText4: "4. **Ihre Preise festlegen:** Geben Sie Ihren Einstiegspreis, Ihren Stop-Loss-Preis (wo Sie aussteigen, wenn der Trade gegen Sie l√§uft) und Ihren Take-Profit-Preis ein.", helpHowToText5: "Die Ergebnisse zeigen Ihnen automatisch den riskierten Geldbetrag, die exakte Positionsgr√∂√üe und das Chance-Risiko-Verh√§ltnis Ihres Trades an.", },
            zh: { title: "‰∫§ÊòìËÆ°ÁÆóÂô®", subtitle: "ËÆ°ÁÆóÊÇ®ÁöÑÂ§¥ÂØ∏ËßÑÊ®°ÂíåÈ£éÈô©/ÂõûÊä•Áéá„ÄÇ", long: "ÂÅöÂ§ö", short: "ÂÅöÁ©∫", capitalLabel: "ËµÑÈáë ($)", capitalPlaceholder: "10000", riskLabel: "È£éÈô© (%)", riskPlaceholder: "1", entryLabel: "ÂÖ•Âú∫‰ª∑ ($)", entryPlaceholder: "50.25", stopLossLabel: "Ê≠¢Êçü‰ª∑ ($)", stopLossPlaceholder: "49.50", takeProfitLabel: "Ê≠¢Áõà‰ª∑ ($)", takeProfitPlaceholder: "52.00", rrInputLabel: "È£éÈô©/ÂõûÊä•Áéá (1:X)", rrInputPlaceholder: "2", resultsTitle: "ÁªìÊûú", monetaryRisk: "È£éÈô©ÈáëÈ¢ù:", monetaryGain: "ÊΩúÂú®Êî∂Áõä:", positionSize: "Â§¥ÂØ∏ËßÑÊ®°:", riskRewardRatio: "È£éÈô©/ÂõûÊä•Áéá:", units: "Âçï‰Ωç", reset: "ÈáçÁΩÆ", errorFillAllFields: "ËØ∑Â°´ÂÜôÊâÄÊúâÂ≠óÊÆµ‰ª•ÊâßË°åËÆ°ÁÆó„ÄÇ", errorInvalidNumbers: "ËØ∑ËæìÂÖ•ÊâÄÊúâÂ≠óÊÆµÁöÑÊúâÊïàÊï∞Â≠ó„ÄÇ", errorPositiveValues: "ËµÑÈáëÂíåÈ£éÈô©ÁôæÂàÜÊØîÂøÖÈ°ªÂ§ß‰∫éÈõ∂„ÄÇ", errorPositiveRR: "È£éÈô©/ÂõûÊä•ÁéáÂøÖÈ°ªÊòØÊ≠£Êï∞„ÄÇ", errorEntryStopSame: "ÂÖ•Âú∫‰ª∑‰∏çËÉΩ‰∏éÊ≠¢Êçü‰ª∑Áõ∏Âêå„ÄÇ", errorLongStopLoss: "ÂÅöÂ§ö‰∫§ÊòìÔºåÊ≠¢Êçü‰ª∑ÂøÖÈ°ª‰Ωé‰∫éÂÖ•Âú∫‰ª∑„ÄÇ", errorLongTakeProfit: "ÂÅöÂ§ö‰∫§ÊòìÔºåÁõà‰ª∑ÂøÖÈ°ªÈ´ò‰∫éÂÖ•Âú∫‰ª∑„ÄÇ", errorShortStopLoss: "ÂÅöÁ©∫‰∫§ÊòìÔºåÊ≠¢Êçü‰ª∑ÂøÖÈ°ªÈ´ò‰∫éÂÖ•Âú∫‰ª∑„ÄÇ", errorShortTakeProfit: "ÂÅöÁ©∫‰∫§ÊòìÔºåÊ≠¢Áõà‰ª∑ÂøÖÈ°ª‰Ωé‰∫éÂÖ•Âú∫‰ª∑„ÄÇ", errorCalculation: "ËÆ°ÁÆóËøáÁ®ã‰∏≠ÂèëÁîüÈîôËØØ„ÄÇ", helpTitle: "ËÆ°ÁÆóÂô®Â¶Ç‰ΩïÂ∑•‰Ωú", helpObjectiveTitle: "ÁõÆÊ†á", helpObjectiveText: "ËØ•Â∑•ÂÖ∑ÈÄöËøáÊ†πÊçÆÊÇ®ÁöÑËµÑÈáë„ÄÅÈ£éÈô©ÁôæÂàÜÊØîÂíå‰∫§ÊòìËÆæÁΩÆÔºàÂÖ•Âú∫‰ª∑„ÄÅÊ≠¢Êçü‰ª∑ÂíåÊ≠¢Áõà‰ª∑ÔºâËÆ°ÁÆóÊúÄ‰Ω≥Â§¥ÂØ∏ËßÑÊ®°ÔºåÂ∏ÆÂä©ÊÇ®ÁÆ°ÁêÜ‰∫§ÊòìÈ£éÈô©„ÄÇ", helpHowToTitle: "Â¶Ç‰Ωï‰ΩøÁî®", helpHowToText1: "1. **ÈÄâÊã©‰∫§ÊòìÁ±ªÂûãÔºö** Â¶ÇÊûúÊÇ®ÊòØ‰π∞ÂÖ•ÔºåËØ∑ÈÄâÊã©‚ÄúÂÅöÂ§ö‚ÄùÔºõÂ¶ÇÊûúÊÇ®ÊòØÂçñÂá∫ÔºåËØ∑ÈÄâÊã©‚ÄúÂÅöÁ©∫‚Äù„ÄÇ", helpHowToText2: "2. **ËæìÂÖ•ÊÇ®ÁöÑËµÑÈáëÔºö** ÊÇ®‰∫§ÊòìË¥¶Êà∑‰∏≠ÁöÑÊÄªÈáëÈ¢ù„ÄÇ", helpHowToText3: "3. **ÂÆö‰πâÊÇ®ÁöÑÈ£éÈô©Ôºö** ÊÇ®ÊÑøÊÑèÂú®Ê≠§Ê¨°‰∫§Êòì‰∏≠ÊâøÊãÖÁöÑËµÑÈáëÁôæÂàÜÊØîÔºà‰æãÂ¶Ç1%Êàñ2%Ôºâ„ÄÇ", helpHowToText4: "4. **ËÆæÁΩÆÊÇ®ÁöÑ‰ª∑Ê†ºÔºö** ËæìÂÖ•ÊÇ®ÁöÑÂÖ•Âú∫‰ª∑„ÄÅÊ≠¢Êçü‰ª∑ÔºàÂ¶ÇÊûú‰∫§ÊòìÂØπÊÇ®‰∏çÂà©ÔºåÊÇ®Â∞ÜÂú®Ê≠§ÈÄÄÂá∫ÔºâÂíåÊ≠¢Áõà‰ª∑„ÄÇ", helpHowToText5: "ÁªìÊûúÂ∞ÜËá™Âä®ÊòæÁ§∫ÊÇ®ÁöÑÈ£éÈô©ÈáëÈ¢ù„ÄÅÂ∫îÊåÅÊúâÁöÑÁ°ÆÂàáÂ§¥ÂØ∏ËßÑÊ®°‰ª•Âèä‰∫§ÊòìÁöÑÈ£éÈô©/ÂõûÊä•Áéá„ÄÇ", },
        };
    
        document.addEventListener('DOMContentLoaded', () => {
            // --- STATE ---
            let isDarkMode = false;
            let language = 'fr';
            let tradeType = 'long';
            let lastEdited = 'tp'; // 'tp' or 'rr'
    
            // --- DOM ELEMENTS ---
            const docHtml = document.documentElement;
            const sunIcon = document.getElementById('sun-icon');
            const moonIcon = document.getElementById('moon-icon');
            const darkModeToggle = document.getElementById('dark-mode-toggle');
            const longButton = document.getElementById('long-button');
            const shortButton = document.getElementById('short-button');
            const resetButton = document.getElementById('reset-button');
            const helpButton = document.getElementById('help-button');
            const helpModal = document.getElementById('help-modal');
            const closeHelpModal = document.getElementById('close-help-modal');
            const langToggle = document.getElementById('lang-toggle');
            const langMenu = document.getElementById('lang-menu');
            const langOptions = document.querySelectorAll('.lang-option');
            const inputs = {
                capital: document.getElementById('capital'),
                risk: document.getElementById('risk'),
                entry: document.getElementById('entry'),
                stoploss: document.getElementById('stoploss'),
                takeprofit: document.getElementById('takeprofit'),
                rr_input: document.getElementById('rr-input'),
            };
            const containers = {
                error: document.getElementById('error-container'),
                results: document.getElementById('results-container'),
            };
            const displays = {
                errorMessage: document.getElementById('error-message'),
                riskAmount: document.getElementById('risk-amount'),
                gainAmount: document.getElementById('gain-amount'),
                positionSize: document.getElementById('position-size'),
                rrRatio: document.getElementById('rr-ratio'),
            };
            
            // --- FUNCTIONS ---
    
            const saveParameters = () => {
                try {
                    const params = {
                        capital: inputs.capital.value,
                        risk: inputs.risk.value,
                        entry: inputs.entry.value,
                        stoploss: inputs.stoploss.value,
                        takeprofit: inputs.takeprofit.value,
                        rr_input: inputs.rr_input.value,
                        tradeType,
                        language,
                        isDarkMode,
                        lastEdited
                    };
                    localStorage.setItem('tradingCalcParams', JSON.stringify(params));
                } catch (error) {
                    console.error("Could not save parameters to localStorage:", error);
                }
            };
    
            const loadParameters = () => {
                try {
                    const savedParams = localStorage.getItem('tradingCalcParams');
                    if (savedParams) {
                        const params = JSON.parse(savedParams);
                        inputs.capital.value = params.capital || '';
                        inputs.risk.value = params.risk || '';
                        inputs.entry.value = params.entry || '';
                        inputs.stoploss.value = params.stoploss || '';
                        inputs.takeprofit.value = params.takeprofit || '';
                        inputs.rr_input.value = params.rr_input || '';
                        lastEdited = params.lastEdited || 'tp';
                        
                        toggleDarkMode(params.isDarkMode || false);
                        setTradeType(params.tradeType || 'long', true); // Do not recalculate yet
                        updateLanguage(params.language || 'fr'); // This will trigger the final calculation
                    } else {
                        const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
                        toggleDarkMode(prefersDark);
                        setTradeType('long');
                        updateLanguage('fr');
                    }
                } catch (error) {
                    console.error("Could not load parameters from localStorage:", error);
                    const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
                    toggleDarkMode(prefersDark);
                    setTradeType('long');
                    updateLanguage('fr');
                }
            };
    
            const updateLanguage = (lang) => {
                language = lang;
                const t = translations[lang];
                document.querySelectorAll('[data-i18n]').forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    if (t[key]) el.innerText = t[key];
                });
                document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                    const key = el.getAttribute('data-i18n-placeholder');
                     if (t[key]) el.placeholder = t[key];
                });
                calculatePosition();
                saveParameters();
            };
    
            const toggleDarkMode = (isDark) => {
                isDarkMode = isDark;
                docHtml.classList.toggle('dark', isDarkMode);
                sunIcon.style.display = isDarkMode ? 'block' : 'none';
                moonIcon.style.display = isDarkMode ? 'none' : 'block';
                saveParameters();
            };
    
            const setTradeType = (type, skipCalculation = false) => {
                tradeType = type;
                if (type === 'long') {
                    longButton.style.backgroundColor = 'var(--color-accent-success)';
                    longButton.style.color = 'var(--color-accent-primary-text)';
                    longButton.classList.add('shadow-md');
                    shortButton.style.backgroundColor = 'transparent';
                    shortButton.style.color = 'var(--color-text-main)';
                    shortButton.classList.remove('shadow-md');
                } else {
                    shortButton.style.backgroundColor = 'var(--color-accent-danger)';
                    shortButton.style.color = 'var(--color-accent-primary-text)';
                    shortButton.classList.add('shadow-md');
                    longButton.style.backgroundColor = 'transparent';
                    longButton.style.color = 'var(--color-text-main)';
                    longButton.classList.remove('shadow-md');
                }
                if (!skipCalculation) {
                    calculatePosition();
                }
                saveParameters();
            };
            
            const setError = (key) => {
                containers.results.classList.add('hidden');
                if (key) {
                    containers.error.classList.remove('hidden');
                    displays.errorMessage.innerText = translations[language][key];
                } else {
                    containers.error.classList.add('hidden');
                }
            };
    
            const setResults = (results) => {
                setError(null);
                containers.results.classList.remove('hidden');
                const t = translations[language];
                displays.riskAmount.innerText = `$${results.riskAmount}`;
                displays.gainAmount.innerText = `$${results.gainAmount}`;
                displays.positionSize.innerText = `${results.positionSize} ${t.units}`;
                displays.rrRatio.innerText = `1 : ${results.riskRewardRatio}`;
            };
            
            const clearResults = () => {
                containers.results.classList.add('hidden');
                setError(null);
            };
    
            const calculatePosition = () => {
                const baseFieldsFilled = inputs.capital.value && inputs.risk.value && inputs.entry.value && inputs.stoploss.value;
                const drivingFieldFilled = (lastEdited === 'tp' && inputs.takeprofit.value) || (lastEdited === 'rr' && inputs.rr_input.value);
    
                if (!baseFieldsFilled || !drivingFieldFilled) {
                    clearResults();
                    if (baseFieldsFilled) {
                        if (lastEdited === 'tp' && !inputs.takeprofit.value) inputs.rr_input.value = '';
                        if (lastEdited === 'rr' && !inputs.rr_input.value) inputs.takeprofit.value = '';
                    }
                    return;
                }
    
                const numCapital = Number(inputs.capital.value);
                const numRisk = Number(inputs.risk.value);
                const numEntry = Number(inputs.entry.value);
                const numStoploss = Number(inputs.stoploss.value);
                let numTakeprofit = Number(inputs.takeprofit.value);
                let numRR = Number(inputs.rr_input.value);
    
                if ([numCapital, numRisk, numEntry, numStoploss].some(isNaN)) { setError('errorInvalidNumbers'); return; }
                if (numCapital <= 0 || numRisk <= 0) { setError('errorPositiveValues'); return; }
                if (numEntry === numStoploss) { setError('errorEntryStopSame'); return; }
    
                try {
                    const stopLossDiff = tradeType === 'long' ? numEntry - numStoploss : numStoploss - numEntry;
                    if (stopLossDiff <= 0) {
                        setError(tradeType === 'long' ? 'errorLongStopLoss' : 'errorShortStopLoss');
                        return;
                    }
    
                    if (lastEdited === 'rr') {
                        if (isNaN(numRR)) { clearResults(); return; }
                        if (numRR <= 0) { setError('errorPositiveRR'); inputs.takeprofit.value = ''; return; }
                        const takeProfitDiff = stopLossDiff * numRR;
                        numTakeprofit = tradeType === 'long' ? (numEntry + takeProfitDiff) : (numEntry - takeProfitDiff);
                        inputs.takeprofit.value = numTakeprofit.toFixed(4);
                    } else { // lastEdited === 'tp'
                        if (isNaN(numTakeprofit)) { clearResults(); return; }
                        const takeProfitDiff = tradeType === 'long' ? numTakeprofit - numEntry : numEntry - numTakeprofit;
                        if (takeProfitDiff <= 0) {
                            setError(tradeType === 'long' ? 'errorLongTakeProfit' : 'errorShortTakeProfit');
                            inputs.rr_input.value = '';
                            return;
                        }
                        numRR = takeProfitDiff / stopLossDiff;
                        inputs.rr_input.value = numRR.toFixed(2);
                    }
    
                    if (isNaN(numRR) || !isFinite(numRR)) { clearResults(); return; }
                    
                    const riskAmount = numCapital * (numRisk / 100);
                    const gainAmount = riskAmount * numRR;
                    const positionSize = riskAmount / stopLossDiff;
                    
                    setResults({
                        riskAmount: riskAmount.toFixed(2),
                        gainAmount: gainAmount.toFixed(2),
                        positionSize: positionSize.toFixed(4),
                        riskRewardRatio: numRR.toFixed(2)
                    });
                } catch {
                    setError('errorCalculation');
                }
            };
            
            const resetAll = () => {
                Object.values(inputs).forEach(input => input.value = '');
                clearResults();
                localStorage.removeItem('tradingCalcParams');
                setTradeType('long'); 
            };
            
            const handleInputChange = () => {
                calculatePosition();
                saveParameters();
            };
    
            // --- EVENT LISTENERS ---
            darkModeToggle.addEventListener('click', () => toggleDarkMode(!isDarkMode));
            longButton.addEventListener('click', () => setTradeType('long'));
            shortButton.addEventListener('click', () => setTradeType('short'));
            resetButton.addEventListener('click', resetAll);
            
            ['capital', 'risk', 'entry', 'stoploss'].forEach(key => {
                inputs[key].addEventListener('input', handleInputChange);
            });
    
            inputs.takeprofit.addEventListener('input', () => {
                lastEdited = 'tp';
                handleInputChange();
            });
            inputs.rr_input.addEventListener('input', () => {
                lastEdited = 'rr';
                handleInputChange();
            });
    
    
            // Help Modal
            helpButton.addEventListener('click', () => helpModal.classList.remove('hidden'));
            closeHelpModal.addEventListener('click', () => helpModal.classList.add('hidden'));
            helpModal.addEventListener('click', (e) => {
                if(e.target === helpModal) helpModal.classList.add('hidden');
            });
    
            // Language Dropdown
            langToggle.addEventListener('click', () => langMenu.classList.toggle('hidden'));
            langOptions.forEach(option => {
                option.addEventListener('click', (e) => {
                    updateLanguage(e.target.dataset.lang);
                    langMenu.classList.add('hidden');
                });
            });
            document.addEventListener('click', (e) => {
                if (!langToggle.contains(e.target) && !langMenu.contains(e.target)) {
                    langMenu.classList.add('hidden');
                }
            });
    
            // --- INITIALIZATION ---
            loadParameters();
        });
    </script>
</body>
</html>

