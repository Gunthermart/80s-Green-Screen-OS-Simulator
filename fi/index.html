<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculateur Financier Avanc√© - Planifiez votre Avenir Financier</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- jsPDF for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <style>
        * {
            font-family: -webkit-system-font, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
        }
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .dark body {
            background: linear-gradient(135deg, #1e3a8a 0%, #312e81 100%);
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .dark .glass-card {
            background: rgba(30, 41, 59, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .tab-active {
            color: #f59e0b;
            border-color: #f59e0b;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: white;
            border-radius: 0.5rem;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(245, 158, 11, 0.3);
        }
        .result-card {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            border-radius: 1rem;
            box-shadow: 0 20px 40px -10px rgba(59, 130, 246, 0.4);
        }
        .dark .result-card {
            background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%);
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        .fade-in {
            animation: fadeIn 0.6s ease-out forwards;
        }
        .slide-in {
            animation: slideIn 0.4s ease-out forwards;
        }
        .bounce-in {
            animation: bounce 0.8s ease-out forwards;
        }
        .switch-label {
            cursor: pointer;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            transition: all 0.3s ease-in-out;
            background: rgba(255, 255, 255, 0.1);
        }
        .switch-radio:checked + .switch-label {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            font-weight: 600;
            transform: scale(1.05);
            box-shadow: 0 10px 20px -5px rgba(59, 130, 246, 0.3);
        }
        .has-tooltip .tooltip {
            visibility: hidden;
            opacity: 0;
            transition: all 0.3s ease-in-out;
            transform: translateY(10px);
        }
        .has-tooltip:hover .tooltip {
            visibility: visible;
            opacity: 1;
            transform: translateY(0);
        }
        .input-field {
            transition: all 0.3s ease-in-out;
            border: 2px solid transparent;
        }
        .input-field:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            transform: translateY(-2px);
        }
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            transition: all 0.3s ease-in-out;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 30px -5px rgba(59, 130, 246, 0.4);
        }
        .hero-icon {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .feature-card {
            transition: all 0.3s ease-in-out;
        }
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.2);
        }
        .chart-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .progress-bar {
            background: linear-gradient(90deg, #3b82f6 0%, #1d4ed8 50%, #fbbf24 100%);
            height: 6px;
            border-radius: 3px;
            animation: progress 2s ease-in-out infinite;
        }
        @keyframes progress {
            0% { width: 0%; }
            100% { width: 100%; }
        }
        .details-tab {
            cursor: pointer;
        }
        .details-tab.active {
            background-color: white;
            color: #3b82f6;
            font-weight: 600;
        }
    </style>
</head>
<body class="p-4">
    <div class="max-w-7xl mx-auto">
        <!-- Header Section -->
        <div class="text-center mb-8 fade-in">
            <div class="inline-flex items-center justify-center w-20 h-20 bg-white rounded-full shadow-lg mb-4 bounce-in">
                <svg class="w-10 h-10 hero-icon" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M4 4a2 2 0 00-2 2v4a2 2 0 002 2V6h10a2 2 0 00-2-2H4zm2 6a2 2 0 012-2h8a2 2 0 012 2v4a2 2 0 01-2 2H8a2 2 0 01-2-2v-4zm6 4a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"/>
                </svg>
            </div>
            <h1 class="text-4xl md:text-5xl font-bold text-white mb-4 slide-in">
                Calculateur Financier Avanc√©
            </h1>
            <p class="text-xl text-white/80 max-w-2xl mx-auto slide-in" style="animation-delay: 0.2s;">
                Planifiez votre avenir financier avec pr√©cision. Calculez vos pr√™ts, √©pargne, retraite et bien plus encore.
            </p>
            <div class="mt-6 flex justify-center slide-in" style="animation-delay: 0.4s;">
                <div class="bg-white/20 backdrop-blur-sm rounded-full px-6 py-3 text-white font-medium">
                    ‚ú® Outils professionnels ‚Ä¢ üìä Analyses d√©taill√©es ‚Ä¢ üì± 100% Gratuit
                </div>
            </div>
        </div>

        <!-- Main Calculator Section -->
        <div class="glass-card rounded-3xl shadow-2xl overflow-hidden">
            <div class="grid lg:grid-cols-2 gap-0">
                
                <!-- Left Column: Forms -->
                <div class="p-6 md:p-8 lg:p-10">
                    <div class="flex justify-between items-center mb-6">
                        <div>
                            <h2 class="text-2xl font-bold text-slate-800 dark:text-white mb-2">Calculateurs</h2>
                            <p class="text-slate-600 dark:text-slate-400">Choisissez votre outil de calcul</p>
                        </div>
                        <!-- Dark Mode Toggle -->
                        <button id="theme-toggle" class="p-3 rounded-full text-slate-500 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700 focus:outline-none transition-all duration-300 hover:scale-110">
                            <svg id="theme-toggle-dark-icon" class="w-6 h-6 hidden" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>
                            </svg>
                            <svg id="theme-toggle-light-icon" class="w-6 h-6 hidden" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm-.464 9.092a1 1 0 010-1.414l.707-.707a1 1 0 111.414 1.414l-.707.707a1 1 0 01-1.414 0zM11 17a1 1 0 100-2H9a1 1 0 100 2h2zm-7-4a1 1 0 100-2H3a1 1 0 100 2h1z" fill-rule="evenodd" clip-rule="evenodd"></path>
                            </svg>
                        </button>
                    </div>
                    
                    <!-- Tabs Navigation -->
                    <div class="border-b border-slate-200 dark:border-slate-700 mb-8">
                        <nav class="flex flex-wrap gap-2" aria-label="Tabs">
                            <button id="tab-loan" data-tab-id="loan" class="tab tab-active px-4 py-3 font-medium text-sm rounded-lg transition-all duration-300">
                                üí∞ Pr√™t
                            </button>
                            <button id="tab-fv" data-tab-id="fv" class="tab text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200 px-4 py-3 font-medium text-sm rounded-lg transition-all duration-300">
                                üìà √âpargne
                            </button>
                            <button id="tab-ret" data-tab-id="ret" class="tab text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200 px-4 py-3 font-medium text-sm rounded-lg transition-all duration-300">
                                üèñÔ∏è Retraite
                            </button>
                            <button id="tab-inf" data-tab-id="inf" class="tab text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200 px-4 py-3 font-medium text-sm rounded-lg transition-all duration-300">
                                üìä Inflation
                            </button>
                            <button id="tab-dep" data-tab-id="dep" class="tab text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200 px-4 py-3 font-medium text-sm rounded-lg transition-all duration-300">
                                üìâ D√©pr√©ciation
                            </button>
                        </nav>
                    </div>

                    <!-- Calculator Content -->
                    <div class="calculator-content">
                        <!-- Loan Calculator Content -->
                        <div id="loan-calculator-content" class="fade-in">
                            <div class="bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-slate-800 dark:to-slate-700 rounded-2xl p-6 mb-6">
                                <h3 class="text-lg font-semibold text-slate-800 dark:text-white mb-2">üìã Calculateur de Pr√™t</h3>
                                <p class="text-slate-600 dark:text-slate-300 text-sm">Calculez votre mensualit√© ou le montant que vous pouvez emprunter selon vos capacit√©s de remboursement.</p>
                            </div>
                            
                            <div class="flex items-center justify-center bg-slate-100 dark:bg-slate-700 rounded-2xl p-2 mb-6 text-sm text-slate-600 dark:text-slate-300">
                                <input type="radio" id="loan-mode-normal" name="loan-mode" value="normal" class="switch-radio sr-only" checked>
                                <label for="loan-mode-normal" class="switch-label">Calculer la mensualit√©</label>
                                <input type="radio" id="loan-mode-reverse" name="loan-mode" value="reverse" class="switch-radio sr-only">
                                <label for="loan-mode-reverse" class="switch-label">Calculer le capital</label>
                            </div>
                            
                            <form id="loan-form" class="space-y-6">
                                <div id="loan-amount-field">
                                    <label for="amount" class="flex items-center text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                                        Montant du pr√™t 
                                        <span class="has-tooltip ml-2 relative">
                                            <svg class="w-4 h-4 text-slate-400 hover:text-blue-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                            </svg>
                                            <span class="tooltip absolute bottom-full mb-2 w-56 bg-slate-800 text-white text-xs rounded-lg py-2 px-3 left-1/2 -translate-x-1/2 shadow-lg">
                                                Le capital total que vous souhaitez emprunter pour votre projet.
                                            </span>
                                        </span>
                                    </label>
                                    <div class="relative">
                                        <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-4">
                                            <span class="text-slate-500 font-medium">‚Ç¨</span>
                                        </div>
                                        <input type="number" id="amount" class="input-field block w-full rounded-xl border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 text-slate-900 dark:text-white pl-8 pr-4 py-4 focus:border-blue-500 focus:ring-blue-500" placeholder="150 000">
                                    </div>
                                </div>
                                
                                <div id="loan-monthly-payment-field" class="hidden">
                                    <label for="monthly-payment-input" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                                        Mensualit√© souhait√©e
                                    </label>
                                    <div class="relative">
                                        <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-4">
                                            <span class="text-slate-500 font-medium">‚Ç¨</span>
                                        </div>
                                        <input type="number" id="monthly-payment-input" class="input-field block w-full rounded-xl border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 text-slate-900 dark:text-white pl-8 pr-4 py-4 focus:border-blue-500 focus:ring-blue-500" placeholder="850">
                                    </div>
                                </div>
                                
                                <div class="grid md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="interest" class="flex items-center text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                                            Taux d'int√©r√™t 
                                            <span class="has-tooltip ml-2 relative">
                                                <svg class="w-4 h-4 text-slate-400 hover:text-blue-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                </svg>
                                                <span class="tooltip absolute bottom-full mb-2 w-56 bg-slate-800 text-white text-xs rounded-lg py-2 px-3 left-1/2 -translate-x-1/2 shadow-lg">
                                                    Le taux d'int√©r√™t nominal annuel propos√© par votre banque.
                                                </span>
                                            </span>
                                        </label>
                                        <div class="relative">
                                            <input type="number" step="0.01" id="interest" class="input-field block w-full rounded-xl border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 text-slate-900 dark:text-white pr-8 pl-4 py-4 focus:border-blue-500 focus:ring-blue-500" placeholder="3.5">
                                            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-4">
                                                <span class="text-slate-500 font-medium">%</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label for="years" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                                            Dur√©e (ann√©es)
                                        </label>
                                        <input type="number" id="years" class="input-field block w-full rounded-xl border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 text-slate-900 dark:text-white py-4 px-4 focus:border-blue-500 focus:ring-blue-500" placeholder="20">
                                    </div>
                                </div>
                                
                                <button type="submit" id="loan-submit-button" class="btn-primary w-full py-4 px-6 border border-transparent rounded-xl shadow-lg text-base font-semibold text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                    üßÆ Calculer la mensualit√©
                                </button>
                            </form>
                        </div>
                        
                        <!-- Savings Calculator Content -->
                        <div id="fv-calculator-content" class="hidden fade-in">
                            <div class="bg-gradient-to-r from-green-50 to-emerald-50 dark:from-slate-800 dark:to-slate-700 rounded-2xl p-6 mb-6">
                                <h3 class="text-lg font-semibold text-slate-800 dark:text-white mb-2">üìà Calculateur d'√âpargne</h3>
                                <p class="text-slate-600 dark:text-slate-300 text-sm">Calculez la valeur future de votre √©pargne avec des versements r√©guliers et les int√©r√™ts compos√©s.</p>
                            </div>
                            
                            <div class="flex items-center justify-center bg-slate-100 dark:bg-slate-700 rounded-2xl p-2 mb-6 text-sm text-slate-600 dark:text-slate-300">
                                <input type="radio" id="fv-mode-normal" name="fv-mode" value="normal" class="switch-radio sr-only" checked>
                                <label for="fv-mode-normal" class="switch-label">Calculer le capital</label>
                                <input type="radio" id="fv-mode-reverse" name="fv-mode" value="reverse" class="switch-radio sr-only">
                                <label for="fv-mode-reverse" class="switch-label">Calculer le versement</label>
                            </div>
                            
                            <form id="fv-form" class="space-y-6">
                                <div>
                                    <label for="initial-amount" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                                        Montant initial
                                    </label>
                                    <div class="relative">
                                        <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-4">
                                            <span class="text-slate-500 font-medium">‚Ç¨</span>
                                        </div>
                                        <input type="number" id="initial-amount" class="input-field block w-full rounded-xl border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 text-slate-900 dark:text-white pl-8 pr-4 py-4 focus:border-green-500 focus:ring-green-500" placeholder="10 000">
                                    </div>
                                </div>
                                
                                <div id="fv-monthly-contribution-field">
                                    <label for="monthly-contribution" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                                        Versement mensuel
                                    </label>
                                    <div class="relative">
                                        <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-4">
                                            <span class="text-slate-500 font-medium">‚Ç¨</span>
                                        </div>
                                        <input type="number" id="monthly-contribution" class="input-field block w-full rounded-xl border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 text-slate-900 dark:text-white pl-8 pr-4 py-4 focus:border-green-500 focus:ring-green-500" placeholder="200">
                                    </div>
                                </div>
                                
                                <div id="fv-target-amount-field" class="hidden">
                                    <label for="target-amount" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                                        Objectif de capital
                                    </label>
                                    <div class="relative">
                                        <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-4">
                                            <span class="text-slate-500 font-medium">‚Ç¨</span>
                                        </div>
                                        <input type="number" id="target-amount" class="input-field block w-full rounded-xl border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 text-slate-900 dark:text-white pl-8 pr-4 py-4 focus:border-green-500 focus:ring-green-500" placeholder="100 000">
                                    </div>
                                </div>
                                
                                <div class="grid md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="fv-interest" class="flex items-center text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                                            Taux de rendement 
                                            <span class="has-tooltip ml-2 relative">
                                                <svg class="w-4 h-4 text-slate-400 hover:text-green-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                </svg>
                                                <span class="tooltip absolute bottom-full mb-2 w-56 bg-slate-800 text-white text-xs rounded-lg py-2 px-3 left-1/2 -translate-x-1/2 shadow-lg">
                                                    Le rendement annuel moyen de votre placement (livret A: 3%, assurance-vie: 3-5%).
                                                </span>
                                            </span>
                                        </label>
                                        <div class="relative">
                                            <input type="number" step="0.01" id="fv-interest" class="input-field block w-full rounded-xl border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 text-slate-900 dark:text-white pr-8 pl-4 py-4 focus:border-green-500 focus:ring-green-500" placeholder="5">
                                            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-4">
                                                <span class="text-slate-500 font-medium">%</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label for="fv-years" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                                            Dur√©e (ann√©es)
                                        </label>
                                        <input type="number" id="fv-years" class="input-field block w-full rounded-xl border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 text-slate-900 dark:text-white py-4 px-4 focus:border-green-500 focus:ring-green-500" placeholder="10">
                                    </div>
                                </div>
                                
                                <div>
                                    <label for="fv-inflation" class="flex items-center text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                                        Taux d'inflation estim√©
                                        <span class="has-tooltip ml-2 relative">
                                            <svg class="w-4 h-4 text-slate-400 hover:text-green-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                            </svg>
                                            <span class="tooltip absolute bottom-full mb-2 w-56 bg-slate-800 text-white text-xs rounded-lg py-2 px-3 left-1/2 -translate-x-1/2 shadow-lg">
                                                Optionnel. Permet de calculer le pouvoir d'achat r√©el de votre capital futur.
                                            </span>
                                        </span>
                                    </label>
                                    <div class="relative">
                                        <input type="number" step="0.01" id="fv-inflation" class="input-field block w-full rounded-xl border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 text-slate-900 dark:text-white pr-8 pl-4 py-4 focus:border-green-500 focus:ring-green-500" placeholder="2">
                                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-4">
                                            <span class="text-slate-500 font-medium">%</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <button type="submit" id="fv-submit-button" class="btn-primary w-full py-4 px-6 border border-transparent rounded-xl shadow-lg text-base font-semibold text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                                    üìä Calculer le capital
                                </button>
                            </form>
                        </div>
                        
                        <!-- Retirement Calculator Content -->
                        <div id="ret-calculator-content" class="hidden fade-in">
                            <div class="bg-gradient-to-r from-purple-50 to-indigo-50 dark:from-slate-800 dark:to-slate-700 rounded-2xl p-6 mb-6">
                                <h3 class="text-lg font-semibold text-slate-800 dark:text-white mb-2">üèñÔ∏è Calculateur de Retraite</h3>
                                <p class="text-slate-600 dark:text-slate-300 text-sm">Planifiez votre retraite en calculant l'√©pargne n√©cessaire pour votre rente souhait√©e.</p>
                            </div>
                            
                            <form id="ret-form" class="space-y-6">
                                <div>
                                    <label for="ret-monthly-income" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                                        Rente mensuelle souhait√©e
                                    </label>
                                    <div class="relative">
                                        <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-4">
                                            <span class="text-slate-500 font-medium">‚Ç¨</span>
                                        </div>
                                        <input type="number" id="ret-monthly-income" class="input-field block w-full rounded-xl border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 text-slate-900 dark:text-white pl-8 pr-4 py-4 focus:border-purple-500 focus:ring-purple-500" placeholder="1 500">
                                    </div>
                                </div>
                                
                                <div>
                                    <label for="ret-initial-capital" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                                        Capital de d√©part
                                    </label>
                                    <div class="relative">
                                        <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-4">
                                            <span class="text-slate-500 font-medium">‚Ç¨</span>
                                        </div>
                                        <input type="number" id="ret-initial-capital" class="input-field block w-full rounded-xl border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 text-slate-900 dark:text-white pl-8 pr-4 py-4 focus:border-purple-500 focus:ring-purple-500" placeholder="20 000">
                                    </div>
                                </div>
                                
                                <div class="grid md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="ret-current-age" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                                            √Çge actuel
                                        </label>
                                        <input type="number" id="ret-current-age" class="input-field block w-full rounded-xl border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 text-slate-900 dark:text-white py-4 px-4 focus:border-purple-500 focus:ring-purple-500" placeholder="30">
                                    </div>
                                    
                                    <div>
                                        <label for="ret-retirement-age" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                                            √Çge de retraite
                                        </label>
                                        <input type="number" id="ret-retirement-age" class="input-field block w-full rounded-xl border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 text-slate-900 dark:text-white py-4 px-4 focus:border-purple-500 focus:ring-purple-500" placeholder="65">
                                    </div>
                                </div>
                                
                                <div>
                                    <label for="ret-life-expectancy" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                                        Esp√©rance de vie
                                    </label>
                                    <input type="number" id="ret-life-expectancy" class="input-field block w-full rounded-xl border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 text-slate-900 dark:text-white py-4 px-4 focus:border-purple-500 focus:ring-purple-500" placeholder="85">
                                </div>
                                
                                <div class="grid md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="ret-growth-rate-pre" class="flex items-center text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                                            Rendement avant retraite
                                            <span class="has-tooltip ml-2 relative">
                                                <svg class="w-4 h-4 text-slate-400 hover:text-purple-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                </svg>
                                                <span class="tooltip absolute bottom-full mb-2 w-56 bg-slate-800 text-white text-xs rounded-lg py-2 px-3 left-1/2 -translate-x-1/2 shadow-lg">
                                                    Taux de rendement de vos placements pendant la phase d'√©pargne.
                                                </span>
                                            </span>
                                        </label>
                                        <div class="relative">
                                            <input type="number" step="0.01" id="ret-growth-rate-pre" class="input-field block w-full rounded-xl border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 text-slate-900 dark:text-white pr-8 pl-4 py-4 focus:border-purple-500 focus:ring-purple-500" placeholder="5">
                                            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-4">
                                                <span class="text-slate-500 font-medium">%</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label for="ret-growth-rate-post" class="flex items-center text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                                            Rendement √† la retraite
                                            <span class="has-tooltip ml-2 relative">
                                                <svg class="w-4 h-4 text-slate-400 hover:text-purple-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                </svg>
                                                <span class="tooltip absolute bottom-full mb-2 w-56 bg-slate-800 text-white text-xs rounded-lg py-2 px-3 left-1/2 -translate-x-1/2 shadow-lg">
                                                    Rendement plus conservateur pendant la retraite (g√©n√©ralement plus faible).
                                                </span>
                                            </span>
                                        </label>
                                        <div class="relative">
                                            <input type="number" step="0.01" id="ret-growth-rate-post" class="input-field block w-full rounded-xl border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 text-slate-900 dark:text-white pr-8 pl-4 py-4 focus:border-purple-500 focus:ring-purple-500" placeholder="3">
                                            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-4">
                                                <span class="text-slate-500 font-medium">%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <button type="submit" class="btn-primary w-full py-4 px-6 border border-transparent rounded-xl shadow-lg text-base font-semibold text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);">
                                    üéØ Calculer l'√©pargne n√©cessaire
                                </button>
                            </form>
                        </div>
                        
                        <!-- Inflation Calculator Content -->
                        <div id="inf-calculator-content" class="hidden fade-in">
                            <div class="bg-gradient-to-r from-orange-50 to-red-50 dark:from-slate-800 dark:to-slate-700 rounded-2xl p-6 mb-6">
                                <h3 class="text-lg font-semibold text-slate-800 dark:text-white mb-2">üìä Calculateur de Pouvoir d'Achat</h3>
                                <p class="text-slate-600 dark:text-slate-300 text-sm">Mesurez l'√©volution du pouvoir d'achat d'une somme d'argent entre deux dates, bas√© sur l'inflation historique en France.</p>
                            </div>
                            
                            <form id="inf-form" class="space-y-6">
                                <div>
                                    <label for="inf-amount" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                                        Montant
                                    </label>
                                    <div class="relative">
                                        <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-4">
                                            <span class="text-slate-500 font-medium">‚Ç¨</span>
                                        </div>
                                        <input type="number" id="inf-amount" class="input-field block w-full rounded-xl border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 text-slate-900 dark:text-white pl-8 pr-4 py-4 focus:border-orange-500 focus:ring-orange-500" placeholder="1000">
                                    </div>
                                </div>
                                
                                <div class="grid md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="inf-start-year" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                                            Ann√©e du montant
                                        </label>
                                        <select id="inf-start-year" class="input-field block w-full rounded-xl border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 text-slate-900 dark:text-white py-4 px-4 focus:border-orange-500 focus:ring-orange-500"></select>
                                    </div>
                                    
                                    <div>
                                        <label for="inf-end-year" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                                            Ann√©e de conversion
                                        </label>
                                        <select id="inf-end-year" class="input-field block w-full rounded-xl border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 text-slate-900 dark:text-white py-4 px-4 focus:border-orange-500 focus:ring-orange-500"></select>
                                    </div>
                                </div>
                                
                                <button type="submit" class="btn-primary w-full py-4 px-6 border border-transparent rounded-xl shadow-lg text-base font-semibold text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500" style="background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);">
                                    ‚öñÔ∏è Calculer le pouvoir d'achat
                                </button>
                            </form>
                        </div>
                        
                        <!-- Depreciation Calculator Content -->
                        <div id="dep-calculator-content" class="hidden fade-in">
                            <div class="bg-gradient-to-r from-red-50 to-pink-50 dark:from-slate-800 dark:to-slate-700 rounded-2xl p-6 mb-6">
                                <h3 class="text-lg font-semibold text-slate-800 dark:text-white mb-2">üìâ Calculateur de D√©pr√©ciation</h3>
                                <p class="text-slate-600 dark:text-slate-300 text-sm">Calculez la d√©pr√©ciation d'un bien (v√©hicule, √©quipement) selon diff√©rentes m√©thodes.</p>
                            </div>
                            
                            <div class="flex items-center justify-center bg-slate-100 dark:bg-slate-700 rounded-2xl p-2 mb-6 text-sm text-slate-600 dark:text-slate-300">
                                <input type="radio" id="dep-linear" name="dep-method" value="linear" class="switch-radio sr-only" checked>
                                <label for="dep-linear" class="switch-label">Lin√©aire</label>
                                <input type="radio" id="dep-declining" name="dep-method" value="declining" class="switch-radio sr-only">
                                <label for="dep-declining" class="switch-label">D√©gressive</label>
                            </div>
                            
                            <form id="dep-form" class="space-y-6">
                                <div>
                                    <label for="dep-initial-value" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                                        Valeur initiale du bien
                                    </label>
                                    <div class="relative">
                                        <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-4">
                                            <span class="text-slate-500 font-medium">‚Ç¨</span>
                                        </div>
                                        <input type="number" id="dep-initial-value" class="input-field block w-full rounded-xl border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 text-slate-900 dark:text-white pl-8 pr-4 py-4 focus:border-red-500 focus:ring-red-500" placeholder="25 000">
                                    </div>
                                </div>
                                
                                <div>
                                    <label for="dep-salvage-value" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                                        Valeur r√©siduelle (optionnel)
                                    </label>
                                    <div class="relative">
                                        <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-4">
                                            <span class="text-slate-500 font-medium">‚Ç¨</span>
                                        </div>
                                        <input type="number" id="dep-salvage-value" class="input-field block w-full rounded-xl border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 text-slate-900 dark:text-white pl-8 pr-4 py-4 focus:border-red-500 focus:ring-red-500" placeholder="2 000">
                                    </div>
                                </div>
                                
                                <div class="grid md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="dep-rate" class="flex items-center text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                                            Taux de d√©pr√©ciation annuel
                                            <span class="has-tooltip ml-2 relative">
                                                <svg class="w-4 h-4 text-slate-400 hover:text-red-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                </svg>
                                                <span class="tooltip absolute bottom-full mb-2 w-56 bg-slate-800 text-white text-xs rounded-lg py-2 px-3 left-1/2 -translate-x-1/2 shadow-lg">
                                                    Pourcentage de d√©pr√©ciation par an (voiture: 15-20%, √©quipement informatique: 20-33%).
                                                </span>
                                            </span>
                                        </label>
                                        <div class="relative">
                                            <input type="number" step="0.01" id="dep-rate" class="input-field block w-full rounded-xl border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 text-slate-900 dark:text-white pr-8 pl-4 py-4 focus:border-red-500 focus:ring-red-500" placeholder="20">
                                            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-4">
                                                <span class="text-slate-500 font-medium">%</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label for="dep-years" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                                            Dur√©e de vie (ann√©es)
                                        </label>
                                        <input type="number" id="dep-years" class="input-field block w-full rounded-xl border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 text-slate-900 dark:text-white py-4 px-4 focus:border-red-500 focus:ring-red-500" placeholder="5">
                                    </div>
                                </div>
                                
                                <button type="submit" class="btn-primary w-full py-4 px-6 border border-transparent rounded-xl shadow-lg text-base font-semibold text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                                    üìä Calculer la d√©pr√©ciation
                                </button>
                            </form>
                        </div>
                        
                    </div>
                </div>
                
                <!-- Right Column: Results and Visualization -->
                <div class="bg-gradient-to-br from-slate-50 to-blue-50 dark:from-slate-800 dark:to-slate-900 p-6 md:p-8 lg:p-10">
                    <div id="results-section">
                        <!-- Default Welcome State -->
                        <div id="welcome-state" class="text-center py-12">
                            <div class="mb-6">
                                <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full shadow-lg bounce-in">
                                    <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M9 12a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3z"/>
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a4 4 0 00-2 7.5V15a1 1 0 01-2 0v-1.5a4 4 0 102-7z" clip-rule="evenodd"/>
                                    </svg>
                                </div>
                            </div>
                            <h3 class="text-2xl font-bold text-slate-800 dark:text-white mb-4">
                                Vos r√©sultats s'afficheront ici
                            </h3>
                            <p class="text-slate-600 dark:text-slate-400 mb-8 max-w-md mx-auto">
                                Remplissez le formulaire √† gauche pour voir vos calculs d√©taill√©s et visualisations financi√®res.
                            </p>
                            
                            <!-- Sample Benefits Cards -->
                            <div class="space-y-4">
                                <div class="feature-card bg-white dark:bg-slate-700 rounded-xl p-4 shadow-md">
                                    <div class="flex items-center">
                                        <div class="w-10 h-10 bg-gradient-to-br from-green-400 to-green-600 rounded-lg flex items-center justify-center mr-3">
                                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                                            </svg>
                                        </div>
                                        <div class="text-left">
                                            <h4 class="font-semibold text-slate-800 dark:text-white">Calculs Pr√©cis</h4>
                                            <p class="text-sm text-slate-600 dark:text-slate-400">Algorithmes financiers professionnels</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="feature-card bg-white dark:bg-slate-700 rounded-xl p-4 shadow-md">
                                    <div class="flex items-center">
                                        <div class="w-10 h-10 bg-gradient-to-br from-blue-400 to-blue-600 rounded-lg flex items-center justify-center mr-3">
                                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
                                            </svg>
                                        </div>
                                        <div class="text-left">
                                            <h4 class="font-semibold text-slate-800 dark:text-white">Graphiques Interactifs</h4>
                                            <p class="text-sm text-slate-600 dark:text-slate-400">Visualisez vos projections financi√®res</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="feature-card bg-white dark:bg-slate-700 rounded-xl p-4 shadow-md">
                                    <div class="flex items-center">
                                        <div class="w-10 h-10 bg-gradient-to-br from-purple-400 to-purple-600 rounded-lg flex items-center justify-center mr-3">
                                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M3 17a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2zM3.447 7.276A1 1 0 014 6h12a1 1 0 01.707 1.707l-6 6a1 1 0 01-1.414 0l-6-6a1 1 0 01-.153-.724z"/>
                                            </svg>
                                        </div>
                                        <div class="text-left">
                                            <h4 class="font-semibold text-slate-800 dark:text-white">Export PDF</h4>
                                            <p class="text-sm text-slate-600 dark:text-slate-400">Sauvegardez vos analyses</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Results will be shown here -->
                        <div id="calculation-results" class="hidden">
                            <!-- Results content will be dynamically inserted -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer Section -->
        <div class="mt-12 text-center text-white/60 fade-in" style="animation-delay: 0.6s;">
            <p class="text-sm">
                ¬© 2024 Calculateur Financier Avanc√© ‚Ä¢ Outil gratuit pour vos d√©cisions financi√®res ‚Ä¢ 
                <span class="text-white/80 font-medium">Planifiez. Calculez. R√©ussissez.</span>
            </p>
        </div>
    </div>

    <script>
        // --- GLOBAL DATA ---
        // Source: INSEE, via france-inflation.com. 2024 is an estimate.
        const INFLATION_RATES_FRANCE = {
            1973: 7.3, 1974: 13.7, 1975: 11.8, 1976: 9.6, 1977: 9.4, 1978: 9.1, 1979: 10.8,
            1980: 13.6, 1981: 13.4, 1982: 11.8, 1983: 9.6, 1984: 7.4, 1985: 5.8, 1986: 2.7,
            1987: 3.1, 1988: 2.7, 1989: 3.6, 1990: 3.4, 1991: 3.2, 1992: 2.4, 1993: 2.1,
            1994: 1.6, 1995: 1.8, 1996: 2.0, 1997: 1.2, 1998: 0.7, 1999: 0.5, 2000: 1.7,
            2001: 1.6, 2002: 1.9, 2003: 2.1, 2004: 2.1, 2005: 1.8, 2006: 1.6, 2007: 1.5,
            2008: 2.8, 2009: 0.1, 2010: 1.5, 2011: 2.1, 2012: 2.0, 2013: 0.9, 2014: 0.5,
            2015: 0.0, 2016: 0.2, 2017: 1.0, 2018: 1.8, 2019: 1.1, 2020: 0.5, 2021: 1.6,
            2022: 5.2, 2023: 4.9, 2024: 2.2 
        };
        let lastCalculationData = {}; // To store data for PDF export

        // --- CORE UI ---
        const themeToggle = document.getElementById('theme-toggle');
        const darkIcon = document.getElementById('theme-toggle-dark-icon');
        const lightIcon = document.getElementById('theme-toggle-light-icon');
        const resultsDiv = document.getElementById('calculation-results');
        const welcomeState = document.getElementById('welcome-state');

        // Dark mode toggle functionality
        if (localStorage.getItem('color-theme') === 'dark' || 
            (!localStorage.getItem('color-theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
            lightIcon.classList.remove('hidden');
        } else {
            darkIcon.classList.remove('hidden');
        }

        themeToggle.addEventListener('click', function() {
            darkIcon.classList.toggle('hidden');
            lightIcon.classList.toggle('hidden');
            document.documentElement.classList.toggle('dark');
            localStorage.setItem('color-theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');
        });

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', function() {
            setupTabs();
            setupLoanCalculator();
            setupSavingsCalculator();
            setupRetirementCalculator();
            setupInflationCalculator();
            setupDepreciationCalculator();
            setupAnimations();
        });

        function setupTabs() {
            const tabs = document.querySelectorAll('.tab');
            const calculatorContents = document.querySelectorAll('[id$="-calculator-content"]');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    resultsDiv.classList.add('hidden');
                    welcomeState.classList.remove('hidden');
                    lastCalculationData = {}; 

                    tabs.forEach(t => {
                        t.classList.remove('tab-active');
                        t.classList.add('text-slate-500', 'dark:text-slate-400');
                    });
                    this.classList.add('tab-active');
                    this.classList.remove('text-slate-500', 'dark:text-slate-400');

                    calculatorContents.forEach(content => content.classList.add('hidden'));
                    const targetContent = document.getElementById(this.dataset.tabId + '-calculator-content');
                    if (targetContent) {
                        targetContent.classList.remove('hidden');
                        targetContent.classList.add('fade-in');
                    }
                });
            });
        }

        function showMessage(text) {
            let messageBox = document.getElementById('message-box');
            if (!messageBox) {
                messageBox = document.createElement('div');
                messageBox.id = 'message-box';
                messageBox.className = 'fixed top-5 right-5 bg-red-500 text-white py-2 px-4 rounded-lg shadow-lg transition-opacity duration-300 z-50';
                document.body.appendChild(messageBox);
            }
            messageBox.textContent = text;
            messageBox.style.opacity = 1;
            setTimeout(() => { messageBox.style.opacity = 0; }, 3000);
        }

        // --- CALCULATOR MODULES ---

        // LOAN CALCULATOR
        function setupLoanCalculator() {
            document.getElementById('loan-form').addEventListener('submit', e => { e.preventDefault(); calculateLoan(); });
            const loanModeRadios = document.querySelectorAll('input[name="loan-mode"]');
            loanModeRadios.forEach(radio => radio.addEventListener('change', handleLoanModeChange));
        }

        function handleLoanModeChange() {
            const isNormalMode = this.value === 'normal';
            document.getElementById('loan-amount-field').classList.toggle('hidden', !isNormalMode);
            document.getElementById('loan-monthly-payment-field').classList.toggle('hidden', isNormalMode);
            document.getElementById('loan-submit-button').textContent = isNormalMode ? 'üßÆ Calculer la mensualit√©' : 'üßÆ Calculer le capital';
        }

        function calculateLoan() {
            const mode = document.querySelector('input[name="loan-mode"]:checked').value;
            let amount, monthlyPayment, interest, years;
            
            if (mode === 'normal') {
                amount = parseFloat(document.getElementById('amount').value);
                interest = parseFloat(document.getElementById('interest').value) / 100 / 12;
                years = parseInt(document.getElementById('years').value);
                
                if (isNaN(amount) || isNaN(interest) || isNaN(years) || amount <= 0 || interest <= 0 || years <= 0) {
                    showMessage('Veuillez remplir tous les champs avec des valeurs valides.');
                    return;
                }
                
                const months = years * 12;
                monthlyPayment = (amount * interest * Math.pow(1 + interest, months)) / (Math.pow(1 + interest, months) - 1);
                const totalPayment = monthlyPayment * months;
                const totalInterest = totalPayment - amount;

                let remainingBalance = amount;
                let schedule = [];
                for (let i = 1; i <= months; i++) {
                    const interestMonth = remainingBalance * interest;
                    const principalMonth = monthlyPayment - interestMonth;
                    remainingBalance -= principalMonth;
                    schedule.push({ month: i, interest: interestMonth, principal: principalMonth, balance: remainingBalance > 0 ? remainingBalance : 0 });
                }

                lastCalculationData = {
                    type: 'loan',
                    title: 'Analyse de Pr√™t',
                    summary: {
                        "Mode": "Calcul de la mensualit√©",
                        "Montant du pr√™t": `${amount.toLocaleString('fr-FR')} ‚Ç¨`,
                        "Taux d'int√©r√™t": `${(interest * 12 * 100).toFixed(2)} %`,
                        "Dur√©e": `${years} ans`,
                        "Mensualit√©": `${monthlyPayment.toLocaleString('fr-FR', {maximumFractionDigits: 2})} ‚Ç¨`,
                        "Co√ªt total du cr√©dit": `${totalInterest.toLocaleString('fr-FR', {maximumFractionDigits: 2})} ‚Ç¨`
                    },
                    details: schedule
                };
                showLoanResults(amount, monthlyPayment, 'normal', schedule);

            } else {
                monthlyPayment = parseFloat(document.getElementById('monthly-payment-input').value);
                interest = parseFloat(document.getElementById('interest').value) / 100 / 12;
                years = parseInt(document.getElementById('years').value);
                
                if (isNaN(monthlyPayment) || isNaN(interest) || isNaN(years) || monthlyPayment <= 0 || interest <= 0 || years <= 0) {
                    showMessage('Veuillez remplir tous les champs avec des valeurs valides.');
                    return;
                }
                
                const months = years * 12;
                amount = monthlyPayment * (Math.pow(1 + interest, months) - 1) / (interest * Math.pow(1 + interest, months));
                const totalPayment = monthlyPayment * months;
                const totalInterest = totalPayment - amount;

                let remainingBalance = amount;
                let schedule = [];
                 for (let i = 1; i <= months; i++) {
                    const interestMonth = remainingBalance * interest;
                    const principalMonth = monthlyPayment - interestMonth;
                    remainingBalance -= principalMonth;
                    schedule.push({ month: i, interest: interestMonth, principal: principalMonth, balance: remainingBalance > 0 ? remainingBalance : 0 });
                }

                lastCalculationData = {
                    type: 'loan',
                    title: 'Analyse de Capacit√© d\'Emprunt',
                    summary: {
                        "Mode": "Calcul du capital",
                        "Mensualit√© souhait√©e": `${monthlyPayment.toLocaleString('fr-FR')} ‚Ç¨`,
                        "Taux d'int√©r√™t": `${(interest * 12 * 100).toFixed(2)} %`,
                        "Dur√©e": `${years} ans`,
                        "Capital empruntable": `${amount.toLocaleString('fr-FR', {maximumFractionDigits: 2})} ‚Ç¨`,
                        "Co√ªt total du cr√©dit": `${totalInterest.toLocaleString('fr-FR', {maximumFractionDigits: 2})} ‚Ç¨`
                    },
                    details: schedule
                };
                showLoanResults(amount, monthlyPayment, 'reverse', schedule);
            }
        }

        function showLoanResults(amount, monthlyPayment, mode, schedule) {
            const totalPayment = monthlyPayment * schedule.length;
            const totalInterest = totalPayment - amount;
            
            const scheduleHTML = schedule.map(item => `
                <div class="grid grid-cols-4 gap-2 py-2 border-b border-slate-200 dark:border-slate-700 last:border-b-0 text-sm">
                    <span class="text-slate-600 dark:text-slate-400 text-center">${item.month}</span>
                    <span class="font-medium text-center text-green-600">${item.principal.toLocaleString('fr-FR', {maximumFractionDigits: 2})} ‚Ç¨</span>
                    <span class="font-medium text-center text-red-500">${item.interest.toLocaleString('fr-FR', {maximumFractionDigits: 2})} ‚Ç¨</span>
                    <span class="font-semibold text-slate-800 dark:text-white text-right">${item.balance.toLocaleString('fr-FR', {maximumFractionDigits: 2})} ‚Ç¨</span>
                </div>
            `).join('');

            welcomeState.classList.add('hidden');
            resultsDiv.classList.remove('hidden');
            
            resultsDiv.innerHTML = `
                <div class="fade-in">
                    <div class="text-center mb-6">
                        <h3 class="text-2xl font-bold text-slate-800 dark:text-white mb-2">
                            ${mode === 'normal' ? 'üí∞ Votre Mensualit√©' : 'üè† Capital Disponible'}
                        </h3>
                        <div class="result-card text-white p-6 rounded-2xl">
                            <div class="text-4xl font-bold mb-2">
                                ${mode === 'normal' ? 
                                    `${monthlyPayment.toLocaleString('fr-FR', {minimumFractionDigits: 2, maximumFractionDigits: 2})} ‚Ç¨` :
                                    `${amount.toLocaleString('fr-FR', {minimumFractionDigits: 0, maximumFractionDigits: 0})} ‚Ç¨`
                                }
                            </div>
                            <div class="text-blue-100">
                                ${mode === 'normal' ? 'par mois' : 'capital maximal'}
                            </div>
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="bg-white dark:bg-slate-700 rounded-xl p-4 shadow-sm">
                            <div class="flex justify-between items-center">
                                <span class="text-slate-600 dark:text-slate-400">Capital emprunt√©</span>
                                <span class="font-semibold text-slate-800 dark:text-white">${amount.toLocaleString('fr-FR', {minimumFractionDigits: 0, maximumFractionDigits: 0})} ‚Ç¨</span>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-slate-700 rounded-xl p-4 shadow-sm">
                            <div class="flex justify-between items-center">
                                <span class="text-slate-600 dark:text-slate-400">Co√ªt total du cr√©dit</span>
                                <span class="font-semibold text-red-600 dark:text-red-400">${totalInterest.toLocaleString('fr-FR', {minimumFractionDigits: 0, maximumFractionDigits: 0})} ‚Ç¨</span>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-slate-700 rounded-xl p-4 shadow-sm">
                            <h4 class="font-semibold text-slate-800 dark:text-white mb-3">üìÖ Tableau d'Amortissement Mensuel</h4>
                            <div class="grid grid-cols-4 gap-2 py-2 border-b-2 border-slate-300 dark:border-slate-600 font-bold text-sm text-slate-700 dark:text-slate-200">
                                <span class="text-center">Mois</span>
                                <span class="text-center">Capital</span>
                                <span class="text-center">Int√©r√™ts</span>
                                <span class="text-right">Solde Restant</span>
                            </div>
                            <div class="max-h-60 overflow-y-auto pr-2">${scheduleHTML}</div>
                        </div>
                        <button onclick="exportToPDF()" class="w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-semibold py-3 px-6 rounded-xl shadow-lg transition-all duration-300 hover:scale-105">
                            üìÑ Exporter en PDF
                        </button>
                    </div>
                </div>
            `;
        }

        // SAVINGS CALCULATOR
        function setupSavingsCalculator() {
            document.getElementById('fv-form').addEventListener('submit', e => { e.preventDefault(); calculateSavings(); });
            const fvModeRadios = document.querySelectorAll('input[name="fv-mode"]');
            fvModeRadios.forEach(radio => radio.addEventListener('change', handleSavingsModeChange));
        }
        
        function handleSavingsModeChange() {
             const isNormalMode = this.value === 'normal';
             document.getElementById('fv-monthly-contribution-field').classList.toggle('hidden', !isNormalMode);
             document.getElementById('fv-target-amount-field').classList.toggle('hidden', isNormalMode);
             document.getElementById('fv-submit-button').innerHTML = isNormalMode ? 'üìä Calculer le capital' : 'üí∞ Calculer le versement';
        }

        function calculateSavings() {
            const mode = document.querySelector('input[name="fv-mode"]:checked').value;
            const initialAmount = parseFloat(document.getElementById('initial-amount').value) || 0;
            const interestRate = parseFloat(document.getElementById('fv-interest').value) / 100;
            const years = parseInt(document.getElementById('fv-years').value);
            const inflationRate = parseFloat(document.getElementById('fv-inflation').value) / 100 || 0;
            
            if (isNaN(interestRate) || isNaN(years) || interestRate <= 0 || years <= 0) {
                showMessage('Veuillez remplir le taux et la dur√©e avec des valeurs valides.');
                return;
            }
            
            const months = years * 12;
            const monthlyRate = interestRate / 12;

            if (mode === 'normal') {
                const monthlyContribution = parseFloat(document.getElementById('monthly-contribution').value) || 0;
                
                let currentBalance = initialAmount;
                let schedule = [];
                for (let i = 1; i <= months; i++) {
                    const interestForMonth = currentBalance * monthlyRate;
                    currentBalance += interestForMonth + monthlyContribution;
                    schedule.push({ month: i, contribution: monthlyContribution, interest: interestForMonth, balance: currentBalance });
                }

                const totalFutureValue = currentBalance;
                const totalContributions = initialAmount + (monthlyContribution * months);
                const totalInterest = totalFutureValue - totalContributions;
                const realValue = totalFutureValue / Math.pow(1 + inflationRate, years);

                lastCalculationData = {
                    type: 'savings',
                    title: 'Projection d\'√âpargne',
                    summary: {
                        "Mode": "Calcul du capital futur",
                        "Capital initial": `${initialAmount.toLocaleString('fr-FR')} ‚Ç¨`,
                        "Versement mensuel": `${monthlyContribution.toLocaleString('fr-FR')} ‚Ç¨`,
                        "Dur√©e": `${years} ans`,
                        "Taux de rendement": `${(interestRate * 100).toFixed(2)} %`,
                        "Capital final": `${totalFutureValue.toLocaleString('fr-FR', {maximumFractionDigits: 2})} ‚Ç¨`,
                        "Gain total": `${totalInterest.toLocaleString('fr-FR', {maximumFractionDigits: 2})} ‚Ç¨`
                    },
                    details: schedule
                };
                showSavingsResults(totalFutureValue, realValue, totalContributions, totalInterest, years, schedule, monthlyContribution);
            } else {
                const targetAmount = parseFloat(document.getElementById('target-amount').value);
                if (isNaN(targetAmount) || targetAmount <= initialAmount) {
                    showMessage('L\'objectif de capital doit √™tre sup√©rieur au montant initial.');
                    return;
                }
                const futureValueInitial = initialAmount * Math.pow(1 + monthlyRate, months);
                const remainingAmount = targetAmount - futureValueInitial;
                if(remainingAmount < 0) {
                     showMessage('Le montant initial seul d√©passera votre objectif. Aucun versement n\'est n√©cessaire.');
                     showSavingsResults(targetAmount, targetAmount / Math.pow(1 + inflationRate, years), initialAmount, targetAmount - initialAmount, years, [], 0);
                     return;
                }
                const requiredMonthlyContribution = (remainingAmount * monthlyRate) / (Math.pow(1 + monthlyRate, months) - 1);
                
                lastCalculationData = {
                    type: 'savings',
                    title: 'Objectif d\'√âpargne',
                    summary: {
                        "Mode": "Calcul du versement requis",
                        "Objectif de capital": `${targetAmount.toLocaleString('fr-FR')} ‚Ç¨`,
                        "Capital initial": `${initialAmount.toLocaleString('fr-FR')} ‚Ç¨`,
                        "Dur√©e": `${years} ans`,
                        "Taux de rendement": `${(interestRate * 100).toFixed(2)} %`,
                        "Versement mensuel requis": `${requiredMonthlyContribution.toLocaleString('fr-FR', {maximumFractionDigits: 2})} ‚Ç¨`
                    },
                    details: []
                };
                showSavingsResults(targetAmount, targetAmount / Math.pow(1 + inflationRate, years), initialAmount + (requiredMonthlyContribution * months), targetAmount - (initialAmount + (requiredMonthlyContribution * months)), years, [], requiredMonthlyContribution);
            }
        }
        
        function showSavingsResults(futureValue, realValue, totalContributions, totalInterest, years, schedule, monthlyContribution = null) {
            const isNormalMode = monthlyContribution !== null;
            const scheduleHTML = schedule.map(item => `
                <div class="grid grid-cols-4 gap-2 py-2 border-b border-slate-200 dark:border-slate-700 last:border-b-0 text-sm">
                    <span class="text-slate-600 dark:text-slate-400 text-center">${item.month}</span>
                    <span class="font-medium text-center">${item.contribution.toLocaleString('fr-FR', {maximumFractionDigits: 2})} ‚Ç¨</span>
                    <span class="font-medium text-center text-green-600">${item.interest.toLocaleString('fr-FR', {maximumFractionDigits: 2})} ‚Ç¨</span>
                    <span class="font-semibold text-slate-800 dark:text-white text-right">${item.balance.toLocaleString('fr-FR', {maximumFractionDigits: 2})} ‚Ç¨</span>
                </div>
            `).join('');

            welcomeState.classList.add('hidden');
            resultsDiv.classList.remove('hidden');
            
            resultsDiv.innerHTML = `
                <div class="fade-in">
                    <div class="text-center mb-6">
                        <h3 class="text-2xl font-bold text-slate-800 dark:text-white mb-2">
                            ${isNormalMode ? 'üí∞ Votre Capital Futur' : 'üí∏ Versement Mensuel Requis'}
                        </h3>
                        <div class="result-card text-white p-6 rounded-2xl" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                            <div class="text-4xl font-bold mb-2">
                                ${isNormalMode ? 
                                    `${futureValue.toLocaleString('fr-FR', {minimumFractionDigits: 0, maximumFractionDigits: 0})} ‚Ç¨` :
                                    `${monthlyContribution.toLocaleString('fr-FR', {minimumFractionDigits: 2, maximumFractionDigits: 2})} ‚Ç¨`
                                }
                            </div>
                            <div class="text-green-100">
                                ${isNormalMode ? `dans ${years} ans` : 'par mois'}
                            </div>
                        </div>
                    </div>
                    <div class="space-y-4">
                         <div class="bg-white dark:bg-slate-700 rounded-xl p-4 shadow-sm">
                            <div class="flex justify-between items-center">
                                <span class="text-slate-600 dark:text-slate-400">Total vers√©</span>
                                <span class="font-semibold text-slate-800 dark:text-white">${totalContributions.toLocaleString('fr-FR', {minimumFractionDigits: 0, maximumFractionDigits: 0})} ‚Ç¨</span>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-slate-700 rounded-xl p-4 shadow-sm">
                            <div class="flex justify-between items-center">
                                <span class="text-slate-600 dark:text-slate-400">Gain total (int√©r√™ts)</span>
                                <span class="font-semibold text-green-600 dark:text-green-400">+${totalInterest.toLocaleString('fr-FR', {minimumFractionDigits: 0, maximumFractionDigits: 0})} ‚Ç¨</span>
                            </div>
                        </div>
                        ${schedule.length > 0 ? `
                        <div class="bg-white dark:bg-slate-700 rounded-xl p-4 shadow-sm">
                            <h4 class="font-semibold text-slate-800 dark:text-white mb-3">üìÖ √âvolution Mensuelle du Capital</h4>
                            <div class="grid grid-cols-4 gap-2 py-2 border-b-2 border-slate-300 dark:border-slate-600 font-bold text-sm text-slate-700 dark:text-slate-200">
                                <span class="text-center">Mois</span>
                                <span class="text-center">Versement</span>
                                <span class="text-center">Int√©r√™ts</span>
                                <span class="text-right">Solde Final</span>
                            </div>
                            <div class="max-h-60 overflow-y-auto pr-2">${scheduleHTML}</div>
                        </div>` : ''}
                        <button onclick="exportToPDF()" class="w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-semibold py-3 px-6 rounded-xl shadow-lg transition-all duration-300 hover:scale-105">
                            üìÑ Exporter en PDF
                        </button>
                    </div>
                </div>
            `;
        }
        
        // RETIREMENT CALCULATOR
        function setupRetirementCalculator() {
             document.getElementById('ret-form').addEventListener('submit', e => { e.preventDefault(); calculateRetirement(); });
        }

        function calculateRetirement() {
            const monthlyIncome = parseFloat(document.getElementById('ret-monthly-income').value);
            const initialCapital = parseFloat(document.getElementById('ret-initial-capital').value) || 0;
            const currentAge = parseInt(document.getElementById('ret-current-age').value);
            const retirementAge = parseInt(document.getElementById('ret-retirement-age').value);
            const lifeExpectancy = parseInt(document.getElementById('ret-life-expectancy').value);
            const growthRatePre = parseFloat(document.getElementById('ret-growth-rate-pre').value) / 100;
            const growthRatePost = parseFloat(document.getElementById('ret-growth-rate-post').value) / 100;
            
            if (isNaN(monthlyIncome) || isNaN(currentAge) || isNaN(retirementAge) || isNaN(lifeExpectancy) || isNaN(growthRatePre) || isNaN(growthRatePost) || retirementAge <= currentAge || lifeExpectancy <= retirementAge) {
                showMessage('Veuillez v√©rifier les √¢ges et les taux saisis.');
                return;
            }
            
            const yearsToRetirement = retirementAge - currentAge;
            const yearsInRetirement = lifeExpectancy - retirementAge;
            const monthlyRatePost = growthRatePost / 12;
            const monthsInRetirement = yearsInRetirement * 12;
            const capitalNeededAtRetirement = monthlyIncome * (1 - Math.pow(1 + monthlyRatePost, -monthsInRetirement)) / monthlyRatePost;
            const monthlyRatePre = growthRatePre / 12;
            const monthsToRetirement = yearsToRetirement * 12;
            const futureValueInitial = initialCapital * Math.pow(1 + monthlyRatePre, monthsToRetirement);
            const additionalCapitalNeeded = capitalNeededAtRetirement - futureValueInitial;
            
            if(additionalCapitalNeeded < 0) {
                 showMessage('Votre capital initial est suffisant pour votre retraite. Aucune √©pargne suppl√©mentaire n\'est requise.');
                 showRetirementResults(capitalNeededAtRetirement, 0, yearsToRetirement, monthlyIncome, yearsInRetirement, [], retirementAge);
                 return;
            }

            const requiredMonthlySavings = (additionalCapitalNeeded * monthlyRatePre) / (Math.pow(1 + monthlyRatePre, monthsToRetirement) - 1);
            
            let schedule = [];
            let currentBalance = initialCapital;
            for (let i = 1; i <= yearsToRetirement; i++) {
                const interestForYear = currentBalance * growthRatePre;
                const contributionForYear = requiredMonthlySavings * 12;
                currentBalance += interestForYear + contributionForYear;
                schedule.push({ year: i, age: currentAge + i, interest: interestForYear, balance: currentBalance });
            }

            lastCalculationData = {
                type: 'retirement',
                title: 'Plan de Retraite',
                summary: {
                    "Rente mensuelle souhait√©e": `${monthlyIncome.toLocaleString('fr-FR')} ‚Ç¨`,
                    "Capital n√©cessaire √† la retraite": `${capitalNeededAtRetirement.toLocaleString('fr-FR', {maximumFractionDigits: 2})} ‚Ç¨`,
                    "√Çge de d√©part": `${retirementAge} ans`,
                    "Dur√©e d'√©pargne": `${yearsToRetirement} ans`,
                    "√âpargne mensuelle requise": `${requiredMonthlySavings.toLocaleString('fr-FR', {maximumFractionDigits: 2})} ‚Ç¨`
                },
                details: schedule
            };
            showRetirementResults(capitalNeededAtRetirement, requiredMonthlySavings, yearsToRetirement, monthlyIncome, yearsInRetirement, schedule, retirementAge);
        }
        
        function showRetirementResults(capitalNeeded, monthlySavings, yearsToRetirement, monthlyIncome, yearsInRetirement, schedule, retirementAge) {
            const scheduleHTML = schedule.map(item => `
                <div class="grid grid-cols-3 gap-2 py-2 border-b border-slate-200 dark:border-slate-700 last:border-b-0 text-sm">
                    <span class="text-slate-600 dark:text-slate-400 text-center">${item.age} ans</span>
                    <span class="font-medium text-center text-green-600">${item.interest.toLocaleString('fr-FR', {maximumFractionDigits: 0})} ‚Ç¨</span>
                    <span class="font-semibold text-slate-800 dark:text-white text-right">${item.balance.toLocaleString('fr-FR', {maximumFractionDigits: 0})} ‚Ç¨</span>
                </div>
            `).join('');

            welcomeState.classList.add('hidden');
            resultsDiv.classList.remove('hidden');
            
            resultsDiv.innerHTML = `
                <div class="fade-in">
                    <div class="text-center mb-6">
                        <h3 class="text-2xl font-bold text-slate-800 dark:text-white mb-2">
                            üéØ Plan de Retraite
                        </h3>
                        <div class="result-card text-white p-6 rounded-2xl" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);">
                            <div class="text-4xl font-bold mb-2">
                                ${monthlySavings.toLocaleString('fr-FR', {minimumFractionDigits: 2, maximumFractionDigits: 2})} ‚Ç¨
                            </div>
                            <div class="text-purple-100">
                                √©pargne mensuelle requise
                            </div>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <div class="bg-white dark:bg-slate-700 rounded-xl p-4 shadow-sm">
                            <div class="flex justify-between items-center">
                                <span class="text-slate-600 dark:text-slate-400">Capital n√©cessaire √† ${retirementAge} ans</span>
                                <span class="font-semibold text-slate-800 dark:text-white">${capitalNeeded.toLocaleString('fr-FR', {minimumFractionDigits: 0, maximumFractionDigits: 0})} ‚Ç¨</span>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-slate-700 rounded-xl p-4 shadow-sm">
                            <h4 class="font-semibold text-slate-800 dark:text-white mb-3">üìÖ Croissance du Capital (Phase d'√âpargne)</h4>
                             <div class="grid grid-cols-3 gap-2 py-2 border-b-2 border-slate-300 dark:border-slate-600 font-bold text-sm text-slate-700 dark:text-slate-200">
                                <span class="text-center">√Çge</span>
                                <span class="text-center">Int√©r√™ts Annuels</span>
                                <span class="text-right">Solde Final</span>
                            </div>
                            <div class="max-h-60 overflow-y-auto pr-2">${scheduleHTML}</div>
                        </div>
                        <button onclick="exportToPDF()" class="w-full bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white font-semibold py-3 px-6 rounded-xl shadow-lg transition-all duration-300 hover:scale-105">
                            üìÑ Exporter en PDF
                        </button>
                    </div>
                </div>
            `;
        }

        // INFLATION CALCULATOR
        function setupInflationCalculator() {
            const startYearSelect = document.getElementById('inf-start-year');
            const endYearSelect = document.getElementById('inf-end-year');
            const years = Object.keys(INFLATION_RATES_FRANCE).sort((a, b) => b - a);
            
            years.forEach(year => {
                startYearSelect.add(new Option(year, year));
                endYearSelect.add(new Option(year, year));
            });
            startYearSelect.value = 1985;
            endYearSelect.value = new Date().getFullYear();

            document.getElementById('inf-form').addEventListener('submit', e => {
                e.preventDefault();
                calculateHistoricalInflation();
            });
        }

        function calculateHistoricalInflation() {
            const amount = parseFloat(document.getElementById('inf-amount').value);
            const startYear = parseInt(document.getElementById('inf-start-year').value);
            const endYear = parseInt(document.getElementById('inf-end-year').value);

            if (isNaN(amount) || amount <= 0) {
                showMessage("Veuillez saisir un montant valide.");
                return;
            }
            if (startYear === endYear) {
                showMessage("Les ann√©es de d√©but et de fin doivent √™tre diff√©rentes.");
                return;
            }

            let currentValue = amount;
            let calculationDetails = [];
            const isInflation = endYear > startYear;

            if (isInflation) {
                for (let year = startYear; year < endYear; year++) {
                    const rate = INFLATION_RATES_FRANCE[year + 1];
                    if (rate === undefined) continue;
                    const multiplier = 1 + (rate / 100);
                    currentValue *= multiplier;
                    calculationDetails.push({ year: year + 1, rate: rate, value: currentValue });
                }
            } else { // Deflation
                for (let year = startYear; year > endYear; year--) {
                    const rate = INFLATION_RATES_FRANCE[year];
                    if (rate === undefined) continue;
                    const divisor = 1 + (rate / 100);
                    currentValue /= divisor;
                    calculationDetails.push({ year: year, rate: -rate, value: currentValue });
                }
            }
            
            lastCalculationData = {
                type: 'inflation',
                title: `√âvolution du Pouvoir d'Achat`,
                summary: {
                    "Montant initial": `${amount.toLocaleString('fr-FR')} ‚Ç¨ en ${startYear}`,
                    "Valeur √©quivalente": `${currentValue.toLocaleString('fr-FR', {maximumFractionDigits: 2})} ‚Ç¨ en ${endYear}`,
                    "Variation totale": `${(((currentValue / amount) - 1) * 100).toFixed(2)} %`
                },
                details: calculationDetails,
                isInflation: isInflation
            };

            showHistoricalInflationResults(amount, currentValue, startYear, endYear, calculationDetails);
        }

        function showHistoricalInflationResults(initialAmount, finalAmount, startYear, endYear, details) {
            welcomeState.classList.add('hidden');
            resultsDiv.classList.remove('hidden');
            
            const detailsHTML = details.map(item => `
                <div class="grid grid-cols-3 gap-2 py-2 border-b border-slate-200 dark:border-slate-700 last:border-b-0 text-sm">
                    <span class="text-slate-600 dark:text-slate-400 text-center">${item.year}</span>
                    <span class="font-medium text-center ${item.rate > 0 ? 'text-red-500' : 'text-green-500'}">${item.rate.toFixed(2)} %</span>
                    <span class="font-semibold text-slate-800 dark:text-white text-right">${item.value.toLocaleString('fr-FR', {maximumFractionDigits: 2})} ‚Ç¨</span>
                </div>
            `).join('');

            resultsDiv.innerHTML = `
                <div class="fade-in">
                    <div class="text-center mb-6">
                        <h3 class="text-2xl font-bold text-slate-800 dark:text-white mb-2">Pouvoir d'Achat √âquivalent</h3>
                        <div class="result-card text-white p-6 rounded-2xl" style="background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);">
                            <p class="text-orange-100 text-lg">${initialAmount.toLocaleString('fr-FR')} ‚Ç¨ de ${startYear}</p>
                            <p class="text-2xl font-bold my-2">valent</p>
                            <p class="text-4xl font-bold">${finalAmount.toLocaleString('fr-FR', {maximumFractionDigits: 2})} ‚Ç¨</p>
                            <p class="text-orange-100 text-lg">en ${endYear}</p>
                        </div>
                    </div>
                    
                    <div class="bg-white dark:bg-slate-700 rounded-xl p-4 shadow-sm">
                        <h4 class="font-semibold text-slate-800 dark:text-white mb-3">üìÖ D√©tail Annuel de l'√âvolution</h4>
                        <div class="grid grid-cols-3 gap-2 py-2 border-b-2 border-slate-300 dark:border-slate-600 font-bold text-sm text-slate-700 dark:text-slate-200">
                            <span class="text-center">Ann√©e</span>
                            <span class="text-center">Taux Inflation</span>
                            <span class="text-right">Valeur</span>
                        </div>
                        <div class="max-h-60 overflow-y-auto pr-2">
                            ${detailsHTML}
                        </div>
                    </div>
                    
                    <button onclick="exportToPDF()" class="mt-4 w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-semibold py-3 px-6 rounded-xl shadow-lg transition-all duration-300 hover:scale-105">
                        üìÑ Exporter le rapport complet en PDF
                    </button>
                </div>
            `;
        }


        // DEPRECIATION CALCULATOR
        function setupDepreciationCalculator() {
             document.getElementById('dep-form').addEventListener('submit', e => { e.preventDefault(); calculateDepreciation(); });
        }
        
        function calculateDepreciation() {
            const method = document.querySelector('input[name="dep-method"]:checked').value;
            const initialValue = parseFloat(document.getElementById('dep-initial-value').value);
            const salvageValue = parseFloat(document.getElementById('dep-salvage-value').value) || 0;
            const depreciationRate = parseFloat(document.getElementById('dep-rate').value) / 100;
            const years = parseInt(document.getElementById('dep-years').value);
            
            if (isNaN(initialValue) || isNaN(depreciationRate) || isNaN(years) || initialValue <= 0 || depreciationRate <= 0 || years <= 0) {
                showMessage('Veuillez remplir tous les champs avec des valeurs valides.');
                return;
            }
            
            let depreciationSchedule = [];
            let currentValue = initialValue;
            
            if (method === 'linear') {
                const annualDepreciation = (initialValue - salvageValue) / years;
                for (let year = 1; year <= years; year++) {
                    let depAmount = annualDepreciation;
                    if(currentValue - depAmount < salvageValue){
                        depAmount = currentValue - salvageValue;
                    }
                    currentValue -= depAmount;
                    depreciationSchedule.push({ year: year, depreciation: depAmount, value: currentValue });
                }
            } else { // declining method
                for (let year = 1; year <= years; year++) {
                    let depreciation = currentValue * depreciationRate;
                    if(currentValue - depreciation < salvageValue){
                        depreciation = currentValue - salvageValue;
                    }
                    currentValue -= depreciation;
                    depreciationSchedule.push({ year: year, depreciation: depreciation, value: currentValue });
                }
            }
            
            const totalDepreciation = initialValue - currentValue;
            const depreciationPercent = (totalDepreciation / initialValue) * 100;

            lastCalculationData = {
                type: 'depreciation',
                title: `Calcul de D√©pr√©ciation (${method})`,
                summary: {
                    "Valeur initiale": `${initialValue.toLocaleString('fr-FR')} ‚Ç¨`,
                    "Valeur r√©siduelle": `${salvageValue.toLocaleString('fr-FR')} ‚Ç¨`,
                    "Dur√©e de vie": `${years} ans`,
                    "Valeur finale": `${currentValue.toLocaleString('fr-FR', {maximumFractionDigits: 2})} ‚Ç¨`,
                    "D√©pr√©ciation totale": `${totalDepreciation.toLocaleString('fr-FR', {maximumFractionDigits: 2})} ‚Ç¨`
                },
                details: depreciationSchedule
            };
            showDepreciationResults(initialValue, currentValue, totalDepreciation, depreciationPercent, depreciationSchedule, method);
        }

        function showDepreciationResults(initialValue, finalValue, totalDepreciation, depreciationPercent, schedule, method) {
            welcomeState.classList.add('hidden');
            resultsDiv.classList.remove('hidden');
            
            const scheduleHTML = schedule.map(item => `
                <div class="flex justify-between items-center py-2 border-b border-slate-200 dark:border-slate-600 last:border-b-0">
                    <span class="text-slate-600 dark:text-slate-400">Ann√©e ${item.year}</span>
                    <div class="text-right">
                        <div class="font-medium text-slate-800 dark:text-white">${item.value.toLocaleString('fr-FR', {minimumFractionDigits: 0, maximumFractionDigits: 0})} ‚Ç¨</div>
                        <div class="text-xs text-red-600 dark:text-red-400">-${item.depreciation.toLocaleString('fr-FR', {minimumFractionDigits: 0, maximumFractionDigits: 0})} ‚Ç¨</div>
                    </div>
                </div>
            `).join('');
            
            resultsDiv.innerHTML = `
                <div class="fade-in">
                    <div class="text-center mb-6">
                        <h3 class="text-2xl font-bold text-slate-800 dark:text-white mb-2">
                            üìâ D√©pr√©ciation ${method === 'linear' ? 'Lin√©aire' : 'D√©gressive'}
                        </h3>
                        <div class="result-card text-white p-6 rounded-2xl" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                            <div class="text-4xl font-bold mb-2">${finalValue.toLocaleString('fr-FR', {minimumFractionDigits: 0, maximumFractionDigits: 0})} ‚Ç¨</div>
                            <div class="text-red-100">valeur apr√®s ${schedule.length} ans</div>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <div class="bg-white dark:bg-slate-700 rounded-xl p-4 shadow-sm">
                            <div class="flex justify-between items-center">
                                <span class="text-slate-600 dark:text-slate-400">Valeur initiale</span>
                                <span class="font-semibold text-slate-800 dark:text-white">${initialValue.toLocaleString('fr-FR', {minimumFractionDigits: 0, maximumFractionDigits: 0})} ‚Ç¨</span>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-slate-700 rounded-xl p-4 shadow-sm">
                            <div class="flex justify-between items-center">
                                <span class="text-slate-600 dark:text-slate-400">D√©pr√©ciation totale</span>
                                <span class="font-semibold text-red-600 dark:text-red-400">-${totalDepreciation.toLocaleString('fr-FR', {minimumFractionDigits: 0, maximumFractionDigits: 0})} ‚Ç¨ (-${depreciationPercent.toFixed(1)}%)</span>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-slate-700 rounded-xl p-4 shadow-sm">
                            <h4 class="font-semibold text-slate-800 dark:text-white mb-3">üìÖ √âvolution Annuelle</h4>
                            <div class="max-h-48 overflow-y-auto">${scheduleHTML}</div>
                        </div>
                        <div class="bg-gradient-to-r from-red-50 to-pink-50 dark:from-slate-800 dark:to-slate-700 rounded-xl p-4">
                            <h4 class="font-semibold text-slate-800 dark:text-white mb-2">üí° Informations</h4>
                            <div class="text-sm text-slate-600 dark:text-slate-400">
                                <p><strong>D√©pr√©ciation ${method === 'linear' ? 'lin√©aire' : 'd√©gressive'} :</strong></p>
                                <p class="mt-1">${method === 'linear' ? 'Montant constant chaque ann√©e, r√©partition √©gale sur la dur√©e de vie.' : 'Pourcentage fixe appliqu√© sur la valeur r√©siduelle, d√©pr√©ciation plus forte au d√©but.'}</p>
                            </div>
                        </div>
                        <button onclick="exportToPDF()" class="w-full bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-semibold py-3 px-6 rounded-xl shadow-lg transition-all duration-300 hover:scale-105">
                            üìÑ Exporter en PDF
                        </button>
                    </div>
                </div>
            `;
        }

        // --- GLOBAL FUNCTIONS ---
        
        function exportToPDF() {
            const { jsPDF } = window.jspdf;
            if (typeof jsPDF === 'undefined') {
                showMessage('La librairie PDF n\'a pas pu √™tre charg√©e.');
                return;
            }
            if (!lastCalculationData.type) {
                showMessage("Veuillez d'abord effectuer un calcul pour l'exporter.");
                return;
            }

            const doc = new jsPDF();
            const title = lastCalculationData.title;
            const summary = lastCalculationData.summary;
            
            doc.setFontSize(20);
            doc.setTextColor(40);
            doc.text(title, 14, 22);

            const summaryBody = Object.entries(summary).map(([key, value]) => [key, value]);
            
            doc.autoTable({
                startY: 30,
                head: [['Description', 'Valeur']],
                body: summaryBody,
                theme: 'striped',
                headStyles: { fillColor: [30, 64, 175] },
                columnStyles: { 1: { halign: 'right' } }
            });

            if (lastCalculationData.details && lastCalculationData.details.length > 0) {
                doc.addPage();
                let detailsBody, head, headStyles, columnStyles;

                switch(lastCalculationData.type) {
                    case 'loan':
                        doc.text("Tableau d'Amortissement Mensuel", 14, 22);
                        head = [['Mois', 'Capital Rembours√©', 'Int√©r√™ts Pay√©s', 'Solde Restant D√ª']];
                        detailsBody = lastCalculationData.details.map(d => [d.month, `${d.principal.toLocaleString('fr-FR', {maximumFractionDigits: 2})} ‚Ç¨`, `${d.interest.toLocaleString('fr-FR', {maximumFractionDigits: 2})} ‚Ç¨`, `${d.balance.toLocaleString('fr-FR', {maximumFractionDigits: 2})} ‚Ç¨`]);
                        headStyles = { fillColor: [30, 64, 175] }; // Blue
                        columnStyles = { 0: { halign: 'center' }, 1: { halign: 'right' }, 2: { halign: 'right' }, 3: { halign: 'right' } };
                        break;
                    case 'savings':
                        doc.text("√âvolution Mensuelle du Capital", 14, 22);
                        head = [['Mois', 'Versement', 'Int√©r√™ts Gagn√©s', 'Solde Final']];
                        detailsBody = lastCalculationData.details.map(d => [d.month, `${d.contribution.toLocaleString('fr-FR', {maximumFractionDigits: 2})} ‚Ç¨`, `${d.interest.toLocaleString('fr-FR', {maximumFractionDigits: 2})} ‚Ç¨`, `${d.balance.toLocaleString('fr-FR', {maximumFractionDigits: 2})} ‚Ç¨`]);
                        headStyles = { fillColor: [5, 150, 105] }; // Green
                        columnStyles = { 0: { halign: 'center' }, 1: { halign: 'right' }, 2: { halign: 'right' }, 3: { halign: 'right' } };
                        break;
                    case 'retirement':
                        doc.text("Croissance du Capital (Phase d'√âpargne)", 14, 22);
                        head = [['√Çge', 'Int√©r√™ts Annuels', 'Solde Final']];
                        detailsBody = lastCalculationData.details.map(d => [d.age, `${d.interest.toLocaleString('fr-FR', {maximumFractionDigits: 2})} ‚Ç¨`, `${d.balance.toLocaleString('fr-FR', {maximumFractionDigits: 2})} ‚Ç¨`]);
                        headStyles = { fillColor: [124, 58, 237] }; // Purple
                        columnStyles = { 0: { halign: 'center' }, 1: { halign: 'right' }, 2: { halign: 'right' } };
                        break;
                    case 'inflation':
                        doc.text("D√©tail Annuel de l'√âvolution", 14, 22);
                        head = [['Ann√©e', 'Taux Inflation', 'Valeur en Fin d\'Ann√©e']];
                        detailsBody = lastCalculationData.details.map(d => [d.year, `${d.rate.toFixed(2)} %`, `${d.value.toLocaleString('fr-FR', {maximumFractionDigits: 2})} ‚Ç¨`]);
                        headStyles = { fillColor: [249, 115, 22] }; // Orange
                        columnStyles = { 0: { halign: 'center' }, 1: { halign: 'right' }, 2: { halign: 'right' } };
                        break;
                    case 'depreciation':
                        doc.text("Tableau de D√©pr√©ciation Annuelle", 14, 22);
                        head = [['Ann√©e', 'D√©pr√©ciation Annuelle', 'Valeur R√©siduelle']];
                        detailsBody = lastCalculationData.details.map(d => [d.year, `${d.depreciation.toLocaleString('fr-FR', {maximumFractionDigits: 2})} ‚Ç¨`, `${d.value.toLocaleString('fr-FR', {maximumFractionDigits: 2})} ‚Ç¨`]);
                        headStyles = { fillColor: [220, 38, 38] }; // Red
                        columnStyles = { 0: { halign: 'center' }, 1: { halign: 'right' }, 2: { halign: 'right' } };
                        break;
                }

                doc.autoTable({
                    startY: 30,
                    head: head,
                    body: detailsBody,
                    theme: 'grid',
                    headStyles: headStyles,
                    columnStyles: columnStyles
                });
            }

            const filename = title.toLowerCase().replace(/[^a-z0-9]/g, '_') + '_analyse.pdf';
            doc.save(filename);
        }

        function setupAnimations() {
            const observerOptions = { threshold: 0.1, rootMargin: '0px 0px -50px 0px' };
            const observer = new IntersectionObserver((entries, obs) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('fade-in');
                        obs.unobserve(entry.target);
                    }
                });
            }, observerOptions);
            document.querySelectorAll('.feature-card').forEach(card => observer.observe(card));
        }

    </script>
</body>
</html>
