<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyse Financière & Technique</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #111827; color: #f9fafb; }
        .card { background-color: #1f2937; border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); }
        .spinner { border-top-color: #3b82f6; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .fade-in { animation: fadeIn 0.5s ease-in-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .tab-btn { transition: all 0.3s ease; }
        .tab-btn.active { border-color: #3b82f6; color: #3b82f6; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
    <div class="container mx-auto max-w-7xl">
        <div class="text-center mb-8">
            <h1 class="text-4xl sm:text-5xl font-bold text-white">Analyse de Graphiques & Documents</h1>
            <p class="text-lg text-gray-400 mt-2">Obtenez une analyse technique et fondamentale instantanée.</p>
        </div>
        <div class="card p-6">
            <div class="mb-4 border-b border-gray-700">
                <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                    <button id="tab-analyzer" class="tab-btn active whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">Analyseur Graphique</button>
                    <button id="tab-pdf" class="tab-btn border-transparent text-gray-400 hover:text-gray-200 hover:border-gray-500 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">Analyseur Fondamental</button>
                </nav>
            </div>

            <div id="analyzer-content">
                <div class="flex flex-col items-center justify-center w-full">
                    <label for="dropzone-file-graphic" class="flex flex-col items-center justify-center w-full h-64 border-2 border-gray-600 border-dashed rounded-lg cursor-pointer bg-gray-700 hover:bg-gray-600">
                        <div class="flex flex-col items-center justify-center pt-5 pb-6">
                            <i class="fas fa-chart-line text-4xl text-gray-400 mb-4"></i>
                            <p class="mb-2 text-sm text-gray-400"><span class="font-semibold">Télécharger des graphiques</span> (PNG, JPG)</p>
                        </div>
                        <input id="dropzone-file-graphic" type="file" class="hidden" multiple accept="image/png, image/jpeg, image/gif"/>
                    </label>
                </div>
                <div class="mt-6 text-center flex flex-wrap justify-center gap-4">
                    <button id="analyzeBtnGraphic" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 transition duration-300 disabled:bg-gray-500" disabled>Lancer l'Analyse</button>
                    <button id="pdfBtnGraphic" class="bg-green-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-green-700 transition duration-300 disabled:bg-gray-500" disabled>Télécharger PDF</button>
                    <button id="resetBtnGraphic" class="bg-red-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-red-700 transition duration-300">Réinitialiser</button>
                </div>
            </div>

            <div id="pdf-content" class="hidden">
                 <div class="flex flex-col items-center justify-center w-full">
                    <label for="dropzone-file-financial" class="flex flex-col items-center justify-center w-full h-64 border-2 border-gray-600 border-dashed rounded-lg cursor-pointer bg-gray-700 hover:bg-gray-600">
                        <div class="flex flex-col items-center justify-center pt-5 pb-6">
                            <i class="fas fa-file-invoice-dollar text-4xl text-gray-400 mb-4"></i>
                            <p class="mb-2 text-sm text-gray-400"><span class="font-semibold">Télécharger des documents financiers</span> (PDF)</p>
                        </div>
                        <input id="dropzone-file-financial" type="file" class="hidden" multiple accept="application/pdf"/>
                    </label>
                </div>
                <div class="mt-6 text-center flex flex-wrap justify-center gap-4">
                    <button id="analyzeBtnFinancial" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 transition duration-300 disabled:bg-gray-500" disabled>Lancer l'Analyse</button>
                    <button id="pdfBtnFinancial" class="bg-green-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-green-700 transition duration-300 disabled:bg-gray-500" disabled>Télécharger PDF</button>
                    <button id="resetBtnFinancial" class="bg-red-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-red-700 transition duration-300">Réinitialiser</button>
                </div>
            </div>
        </div>
        <div id="graphic-results" class="mt-10 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        <div id="financial-results" class="mt-10 space-y-6 hidden"></div>
        <div id="messageBox" class="hidden fixed top-5 right-5 bg-red-600 text-white py-3 px-5 rounded-lg shadow-lg z-50 fade-in"><p id="messageText"></p></div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const { jsPDF } = window.jspdf;
            
            const messageBox = document.getElementById('messageBox');
            const messageText = document.getElementById('messageText');
            
            const tabAnalyzer = document.getElementById('tab-analyzer');
            const tabPdf = document.getElementById('tab-pdf');
            const analyzerContent = document.getElementById('analyzer-content');
            const pdfContent = document.getElementById('pdf-content');
            const graphicResultsContainer = document.getElementById('graphic-results');
            const financialResultsContainer = document.getElementById('financial-results');

            const dropzoneGraphic = document.getElementById('dropzone-file-graphic');
            const analyzeBtnGraphic = document.getElementById('analyzeBtnGraphic');
            const pdfBtnGraphic = document.getElementById('pdfBtnGraphic');
            const resetBtnGraphic = document.getElementById('resetBtnGraphic');
            let graphicFilesToAnalyze = [];

            const dropzoneFinancial = document.getElementById('dropzone-file-financial');
            const analyzeBtnFinancial = document.getElementById('analyzeBtnFinancial');
            const pdfBtnFinancial = document.getElementById('pdfBtnFinancial');
            const resetBtnFinancial = document.getElementById('resetBtnFinancial');
            let financialFilesToAnalyze = [];

            tabAnalyzer.addEventListener('click', () => switchTab('analyzer'));
            tabPdf.addEventListener('click', () => switchTab('pdf'));

            dropzoneGraphic.addEventListener('change', (e) => handleFiles(e.target.files, 'graphic'));
            analyzeBtnGraphic.addEventListener('click', () => runAnalysis('graphic'));
            pdfBtnGraphic.addEventListener('click', () => generatePDF('graphic'));
            resetBtnGraphic.addEventListener('click', () => resetApplication('graphic'));

            dropzoneFinancial.addEventListener('change', (e) => handleFiles(e.target.files, 'financial'));
            analyzeBtnFinancial.addEventListener('click', () => runAnalysis('financial'));
            pdfBtnFinancial.addEventListener('click', () => generatePDF('financial'));
            resetBtnFinancial.addEventListener('click', () => resetApplication('financial'));

            function switchTab(tabName) {
                analyzerContent.classList.toggle('hidden', tabName !== 'analyzer');
                pdfContent.classList.toggle('hidden', tabName === 'analyzer');
                graphicResultsContainer.classList.toggle('hidden', tabName !== 'analyzer');
                financialResultsContainer.classList.toggle('hidden', tabName === 'analyzer');
                tabAnalyzer.classList.toggle('active', tabName === 'analyzer');
                tabPdf.classList.toggle('active', tabName !== 'analyzer');
            }

            function handleFiles(files, type) {
                const container = type === 'graphic' ? graphicResultsContainer : financialResultsContainer;
                container.querySelectorAll('.is-preview').forEach(el => el.remove());
                
                const filesToProcess = Array.from(files);
                if (type === 'graphic') graphicFilesToAnalyze = filesToProcess;
                else financialFilesToAnalyze = filesToProcess;
                
                updateButtonStates(type);
                
                filesToProcess.forEach(file => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const card = createCard(file.name, type, e.target.result);
                        container.appendChild(card);
                    };
                    if (type === 'graphic') reader.readAsDataURL(file);
                    else {
                         const card = createCard(file.name, type);
                         container.appendChild(card);
                    }
                });
            }

            function updateButtonStates(type) {
                if (type === 'graphic') {
                    analyzeBtnGraphic.disabled = graphicFilesToAnalyze.length === 0;
                    pdfBtnGraphic.disabled = !graphicResultsContainer.querySelector('.result-card:not(.is-preview):not(.is-error)');
                } else {
                    analyzeBtnFinancial.disabled = financialFilesToAnalyze.length === 0;
                    pdfBtnFinancial.disabled = !financialResultsContainer.querySelector('.result-card:not(.is-preview):not(.is-error)');
                }
            }

            function resetApplication(type) {
                if (type === 'graphic') {
                    graphicResultsContainer.innerHTML = '';
                    graphicFilesToAnalyze = [];
                    dropzoneGraphic.value = '';
                } else {
                    financialResultsContainer.innerHTML = '';
                    financialFilesToAnalyze = [];
                    dropzoneFinancial.value = '';
                }
                updateButtonStates(type);
                showMessage("Rapport et analyses réinitialisés.");
            }

            async function runAnalysis(type) {
                const files = type === 'graphic' ? graphicFilesToAnalyze : financialFilesToAnalyze;
                if (files.length === 0) return;
                
                setButtonLoading(true, type);
                
                const analysisPromises = files.map(file => dispatchAnalysis(file, type));
                await Promise.allSettled(analysisPromises);
                
                if (type === 'graphic') graphicFilesToAnalyze = [];
                else financialFilesToAnalyze = [];
                
                setButtonLoading(false, type);
                updateButtonStates(type);
            }
            
            async function dispatchAnalysis(file, type) {
                const cardId = `card-${file.name.replace(/[^a-zA-Z0-9]/g, '-')}`;
                try {
                    const base64Data = await toBase64(file);
                    const { prompt, mimeType } = getPromptAndMimeType(type);

                    // L'analyse graphique reste synchrone, l'analyse financière devient asynchrone
                    if (type === 'graphic') {
                        const result = await callBackendAPI('/graph/api/analyser-sync', { prompt, imageData: base64Data.split(',')[1], mimeType });
                        const part = result?.candidates?.[0]?.content?.parts?.[0];
                        if (!part || !part.text) throw new Error("Réponse de l'API graphique invalide.");
                        const analysisData = JSON.parse(part.text.match(/\{[\s\S]*\}/)[0]);
                        updateCard(cardId, analysisData, 'graphic');
                    } else {
                        const { jobId } = await callBackendAPI('/graph/api/initiate-analysis', { prompt, imageData: base64Data.split(',')[1], mimeType });
                        if (!jobId) throw new Error("Impossible de démarrer le job d'analyse.");
                        pollForStatus(jobId, cardId);
                    }
                } catch (error) {
                    updateCardWithError(cardId, error.message);
                }
            }
            
            async function pollForStatus(jobId, cardId) {
                const intervalId = setInterval(async () => {
                    try {
                        const statusResponse = await callBackendAPI(`/graph/api/check-status?jobId=${jobId}`, null, 'GET');
                        
                        if (statusResponse.status === 'complete') {
                            clearInterval(intervalId);
                            const result = statusResponse.result;
                            const part = result?.candidates?.[0]?.content?.parts?.[0];
                            if (!part || !part.text) throw new Error("Résultat d'analyse invalide.");
                             const analysisData = JSON.parse(part.text.match(/\{[\s\S]*\}/)[0]);
                            updateCard(cardId, analysisData, 'financial');
                        } else if (statusResponse.status === 'failed') {
                            clearInterval(intervalId);
                            throw new Error(statusResponse.error || "Le job d'analyse a échoué.");
                        }
                    } catch (error) {
                         clearInterval(intervalId);
                         updateCardWithError(cardId, error.message);
                    }
                }, 5000);
            }

            async function callBackendAPI(endpoint, body, method = 'POST') {
                const options = { method };
                if (body) {
                    options.headers = { 'Content-Type': 'application/json' };
                    options.body = JSON.stringify(body);
                }
                
                const response = await fetch(endpoint, options);
                const data = await response.json();
                if (!response.ok) {
                    throw new Error(data.message || 'Erreur du serveur.');
                }
                return data;
            }

            function getPromptAndMimeType(type) {
                if (type === 'graphic') {
                    return {
                        mimeType: 'image/png',
                        prompt: `En tant que gérant de fonds actions expérimenté, spécialiste de l’analyse technique et comportementale, analyse ce graphique boursier. Structure ta réponse en JSON valide avec les clés suivantes : "tendances", "niveauxCles", "indicateursTechniques", "signauxTiming", "interpretationGerant".
                        Pour "tendances", inclus : "tendanceDominante", "figuresChartistes", "structures".
                        Pour "niveauxCles", inclus : "supportsResistances", "moyennesMobiles", "gaps".
                        Pour "indicateursTechniques", inclus : "rsi", "macd", "volume", "autres".
                        Pour "signauxTiming", inclus : "signaux", "zones", "timingEntree".
                        Pour "interpretationGerant", inclus : "synthese" (Favorable/Neutre/Défavorable), "contexte", "scenario", "horizon" (Court/Moyen/Long terme).
                        Adopte un style clair, synthétique et orienté prise de décision pour un comité d’allocation. Fournis uniquement le JSON.`
                    };
                }
                return {
                    mimeType: 'application/pdf',
                    prompt: `En tant que gérant de fonds actions expérimenté (style Mandarine, LFDE, Sycomore), analyse ce document financier. Structure ta réponse en JSON valide avec les clés suivantes : "fondamentaux", "valorisation", "gouvernance", "contexte", "conclusion".
                    Pour "fondamentaux", inclus : "chiffreAffaires", "marges", "endettement", "qualiteRevenus".
                    Pour "valorisation", inclus : "multiples", "comparaison", "potentiel".
                    Pour "gouvernance", inclus : "ton", "alignement", "historique".
                    Pour "contexte", inclus : "catalyseursRisques", "position", "impactsMacro".
                    Pour "conclusion", inclus un objet "swot" avec "forces", "faiblesses", "opportunites", "menaces", et aussi "opinion" (Acheter/Conserver/Vendre), "arguments", "risque" (Faible/Modéré/Élevé), et "horizon".
                    Adopte un style clair, concis et orienté décision. Fournis uniquement le JSON.`
                };
            }

            function generatePDF(type) {
                 if (type === 'graphic') generateGraphicPDF();
                 else generateFinancialPDF();
            }

            function generateGraphicPDF() {
                const doc = new jsPDF({ orientation: 'p', unit: 'mm', format: 'a4' });
                const resultCards = graphicResultsContainer.querySelectorAll('.result-card:not(.is-preview):not(.is-error)');
                if (resultCards.length === 0) return showMessage("Aucun rapport graphique valide à exporter.");
                
                resultCards.forEach((card, index) => {
                    if (index > 0) doc.addPage();
                    try {
                        const data = JSON.parse(card.dataset.analysis);
                        const fileName = card.querySelector('h3[data-filename]').dataset.filename;
                        const imageSrc = card.querySelector('img').src;
                        const margin = 15;
                        let y = margin + 5;

                        doc.setFontSize(16).text(fileName, margin, y);
                        y += 10;
                        const imgProps = doc.getImageProperties(imageSrc);
                        const contentWidth = doc.internal.pageSize.getWidth() - (margin * 2);
                        const imgHeight = (imgProps.height * contentWidth) / imgProps.width;
                        doc.addImage(imageSrc, 'PNG', margin, y, contentWidth, imgHeight);
                        y += imgHeight + 10;
                        
                        doc.setFontSize(12).text('Interprétation du Gérant', margin, y); y += 5;
                        doc.autoTable({ startY: y, theme: 'plain', styles: { fontSize: 9 }, body: [['Synthèse', data.interpretationGerant.synthese], ['Horizon', data.interpretationGerant.horizon], ['Scénario Privilégié', data.interpretationGerant.scenario], ['Contexte', data.interpretationGerant.contexte]] });
                        y = doc.lastAutoTable.finalY + 7;

                        const sections = ['tendances', 'niveauxCles', 'indicateursTechniques', 'signauxTiming'];
                        sections.forEach(sec => {
                             doc.setFontSize(12).text(sec.charAt(0).toUpperCase() + sec.slice(1).replace(/([A-Z])/g, ' $1'), margin, y); y += 5;
                             const sectionData = Object.entries(data[sec]).map(([key, value]) => [key.replace(/([A-Z])/g, ' $1').trim(), value]);
                             doc.autoTable({ startY: y, theme: 'grid', head: [['Critère', 'Analyse']], body: sectionData, headStyles: { fillColor: [31, 41, 55] }, styles: { fontSize: 9 } });
                             y = doc.lastAutoTable.finalY + 7;
                        });
                    } catch (e) {
                        console.error("Erreur PDF graphique:", e);
                        if (index > 0) doc.addPage();
                        doc.text("Erreur lors de la génération de cette page.", 15, 15);
                    }
                });
                doc.save(`Analyse_Technique_${new Date().toISOString().slice(0, 10)}.pdf`);
            }
            
            function generateFinancialPDF() {
                const doc = new jsPDF({ orientation: 'p', unit: 'mm', format: 'a4' });
                const resultCards = financialResultsContainer.querySelectorAll('.result-card:not(.is-preview):not(.is-error)');
                if (resultCards.length === 0) return showMessage("Aucun rapport financier valide à exporter.");

                resultCards.forEach((card, index) => {
                    if (index > 0) doc.addPage();
                    try {
                        const data = JSON.parse(card.dataset.analysis);
                        const margin = 15;
                        let y = margin + 5;

                        doc.setFontSize(16).text(card.querySelector('h3[data-filename]').dataset.filename, margin, y); y += 10;
                        doc.setFontSize(12).text('Synthèse & Recommandation', margin, y); y += 5;
                        doc.autoTable({ startY: y, theme: 'plain', styles: { fontSize: 9 }, body: [['Opinion', data.conclusion.opinion], ['Niveau de Risque', data.conclusion.risque], ['Horizon de Placement', data.conclusion.horizon], ['Arguments Clés', data.conclusion.arguments]] });
                        y = doc.lastAutoTable.finalY + 7;

                        const sections = ['fondamentaux', 'valorisation', 'gouvernance', 'contexte'];
                        sections.forEach(sec => {
                             doc.setFontSize(12).text(sec.charAt(0).toUpperCase() + sec.slice(1), margin, y); y += 5;
                             const sectionData = Object.entries(data[sec]).map(([key, value]) => [key.replace(/([A-Z])/g, ' $1').trim(), value]);
                             doc.autoTable({ startY: y, theme: 'grid', head: [['Critère', 'Analyse']], body: sectionData, headStyles: { fillColor: [31, 41, 55] }, styles: { fontSize: 9 } });
                             y = doc.lastAutoTable.finalY + 7;
                        });
                    } catch (e) {
                        console.error("Erreur PDF financier:", e);
                        if (index > 0) doc.addPage();
                        doc.text("Erreur lors de la génération de cette page.", 15, 15);
                    }
                });
                doc.save(`Analyse_Fondamentale_${new Date().toISOString().slice(0, 10)}.pdf`);
            }

            function createCard(fileName, type, imageSrc = null) {
                const card = document.createElement('div');
                const cardClass = type === 'graphic' ? 'md:col-span-1' : 'col-span-1 md:col-span-2 lg:col-span-3';
                card.className = `card p-4 flex flex-col justify-between fade-in result-card is-preview ${cardClass}`;
                card.id = `card-${fileName.replace(/[^a-zA-Z0-9]/g, '-')}`;
                
                let content = `<h3 class="font-bold text-lg truncate mb-2" data-filename="${fileName}">${fileName}</h3>`;
                if (type === 'graphic' && imageSrc) {
                    content += `<img src="${imageSrc}" alt="Graphique" class="rounded-md mb-4 w-full h-48 object-contain bg-gray-800">`;
                }
                content += `<div class="analysis-content space-y-2"><div class="flex items-center justify-center h-16"><div class="spinner w-8 h-8 rounded-full border-4 border-gray-600"></div></div></div>`;
                card.innerHTML = `<div>${content}</div>`;
                return card;
            }

            function updateCard(cardId, analysis, type) {
                const card = document.getElementById(cardId);
                if (!card) return;
                card.classList.remove('is-preview');
                card.dataset.analysis = JSON.stringify(analysis);
                
                const createAccordionItem = (title, data) => {
                    let content = '';
                    for (const [key, value] of Object.entries(data)) {
                        content += `<div class="py-2 border-b border-gray-700"><p class="font-semibold text-sm">${key.replace(/([A-Z])/g, ' $1').trim()}</p><p class="text-sm text-gray-400">${value}</p></div>`;
                    }
                    return `<details class="bg-gray-900/50 rounded-lg p-2 mt-2"><summary class="font-semibold cursor-pointer">${title}</summary><div class="pt-2">${content}</div></details>`;
                };
                
                if (type === 'graphic') {
                    const { interpretationGerant, tendances, niveauxCles, indicateursTechniques, signauxTiming } = analysis;
                     let html = `<div class="p-4 bg-gray-800 rounded-lg mb-4"><p class="text-lg font-bold ${getSentimentClass(interpretationGerant.synthese)}">${interpretationGerant.synthese}</p><p class="text-sm text-gray-400">Horizon: ${interpretationGerant.horizon}</p></div>`;
                    html += createAccordionItem('Tendances', tendances);
                    html += createAccordionItem('Niveaux Clés', niveauxCles);
                    html += createAccordionItem('Indicateurs Techniques', indicateursTechniques);
                    html += createAccordionItem('Signaux & Timing', signauxTiming);
                    card.querySelector('.analysis-content').innerHTML = html;
                } else {
                    const { conclusion, fondamentaux, valorisation, gouvernance, contexte } = analysis;
                    let html = `<div class="p-4 bg-gray-800 rounded-lg mb-4"><p class="text-lg font-bold ${getSentimentClass(conclusion.opinion)}">${conclusion.opinion}</p><p class="text-sm text-gray-400">Risque: ${conclusion.risque} | Horizon: ${conclusion.horizon}</p></div>`;
                    html += createAccordionItem('Fondamentaux', fondamentaux);
                    html += createAccordionItem('Valorisation', valorisation);
                    html += createAccordionItem('Gouvernance', gouvernance);
                    html += createAccordionItem('Contexte & Perspectives', contexte);
                    card.querySelector('.analysis-content').innerHTML = html;
                }
            }

            function updateCardWithError(cardId, errorMsg) {
                const card = document.getElementById(cardId);
                if (!card) return;
                card.classList.remove('is-preview');
                card.classList.add('is-error');
                card.querySelector('.analysis-content').innerHTML = `<div class="text-red-400 text-sm p-4 bg-red-900/50 rounded-lg"><p><strong>Erreur :</strong> ${errorMsg}</p></div>`;
            }

            function getSentimentClass(sentiment) {
                const s = sentiment?.toLowerCase() || '';
                if (s.includes('acheter') || s.includes('favorable')) return 'text-green-400';
                if (s.includes('vendre') || s.includes('défavorable')) return 'text-red-400';
                return 'text-yellow-400';
            }

            function setButtonLoading(isLoading, type) {
                const btn = type === 'graphic' ? analyzeBtnGraphic : analyzeBtnFinancial;
                btn.disabled = isLoading;
                btn.innerHTML = isLoading ? '<i class="fas fa-spinner fa-spin mr-2"></i>Analyse...' : `Lancer l'Analyse`;
            }

            const toBase64 = (file) => new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = (error) => reject(error);
            });

            function showMessage(message) {
                messageText.textContent = message;
                messageBox.classList.remove('hidden');
                setTimeout(() => { messageBox.classList.add('hidden'); }, 3000);
            }
        });
    </script>
</body>
</html>
