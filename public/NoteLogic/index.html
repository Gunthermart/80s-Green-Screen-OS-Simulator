<!DOCTYPE html>
<html lang="fr" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <title>NoteLogic V1.14 | Classeur Visual Ops</title>

    <!-- ==========================================================================================
         IC√îNES DU NAVIGATEUR (FAVICON)
    ========================================================================================== -->
    <!-- Option 1: Utilisation d'un Emoji comme ic√¥ne (Simple et efficace) -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìò</text></svg>">
    
    <!-- Option 2: Si vous avez un fichier image sp√©cifique, d√©commentez la ligne ci-dessous : -->
    <!-- <link rel="icon" type="image/png" href="https://leonce-equity.com/notelogic/favicon.png"> -->

    <!-- SEO & Partage Social -->
    <meta name="description" content="NoteLogic V1.14 : Syst√®me de classeur tactique local-first. Prise de notes rapide, tri neuronal, rappels TimeKeeper et export PDF.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://leonce-equity.com/notelogic/index.html">
    <meta property="og:title" content="NoteLogic V1.14 | Classeur Visual Ops">
    <meta property="og:description" content="Syst√®me de notes d√©centralis√© avec chiffrement local et syntaxe active.">
    <meta property="og:image" content="https://leonce-equity.com/notelogic/screenshot/notelogic.png">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://leonce-equity.com/notelogic/screenshot/notelogic.png">

    <!-- Styles & Frameworks -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/dexie/dist/dexie.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700;800&family=Inter:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">
    
    <style>
        :root { --bg-dark: #0f172a; --bg-panel: #1e293b; --accent: #3b82f6; --tag-bg: rgba(59, 130, 246, 0.1); --text-muted: #64748b; --border: rgba(255, 255, 255, 0.08); --font-mono: 'JetBrains Mono', monospace; }
        body { background-color: var(--bg-dark); color: #f8fafc; font-family: 'Inter', sans-serif; height: 100vh; overflow: hidden; display: flex; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 3px; }
        aside { transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s ease; }
        aside.collapsed { width: 0 !important; opacity: 0; overflow: hidden; border-right: none; }
        .editor-layer { background: rgba(15, 23, 42, 0.6); border: 1px solid var(--border); position: relative; display: flex; flex-direction: column; backdrop-filter: blur(2px); }
        #canvas-container { position: absolute; inset: 0; z-index: 0; opacity: 0.5; pointer-events: none; }
        #main-editor { flex: 1; overflow: auto; white-space: pre-wrap; outline: none; position: relative; z-index: 10; padding: 3rem; font-size: 1rem; line-height: 1.7; }
        .chrono-tag { font-family: var(--font-mono); font-size: 0.85em; font-weight: 800; color: #fbbf24; background: rgba(245, 158, 11, 0.15); border: 1px solid rgba(245, 158, 11, 0.4); padding: 0 4px; border-radius: 4px; display: inline-flex; align-items: center; margin: 0 2px; }
        .nexus-index { font-family: var(--font-mono); font-size: 0.85em; font-weight: 800; color: #f0abfc; background: rgba(192, 38, 211, 0.2); border: 1px solid #d946ef; padding: 0 4px; border-radius: 4px; cursor: pointer; }
        .page-card { border-bottom: 1px solid var(--border); border-left: 3px solid transparent; background: rgba(255,255,255,0.01); transition: background 0.2s; position: relative; cursor: pointer; }
        .page-card.active { background: rgba(59, 130, 246, 0.05); border-left-color: var(--accent); }
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(4px); z-index: 50; display: none; align-items: center; justify-content: center; }
        .modal-box { background: var(--bg-panel); border: 1px solid var(--border); width: 90%; max-width: 600px; max-height: 80vh; border-radius: 8px; display: flex; flex-direction: column; }
        .toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: #1e293b; border: 1px solid var(--accent); padding: 6px 12px; border-radius: 6px; font-size: 0.75rem; opacity: 0; pointer-events: none; transition: opacity 0.3s; z-index: 100; color: #fff; }
        .view-btn-active { background-color: #3b82f6 !important; color: white !important; }
        .dropdown-menu { transform-origin: top right; transition: all 0.2s; opacity: 0; transform: scale(0.95); pointer-events: none; }
        .dropdown-menu.active { opacity: 1; transform: scale(1); pointer-events: auto; }
    </style>
</head>
<body class="flex-col md:flex-row">

    <!-- SPLASH -->
    <div id="splash-screen" class="fixed inset-0 z-[9999] flex flex-col items-center justify-center bg-[#0b1120] transition-opacity duration-700">
        <h1 class="text-4xl font-black text-white tracking-tighter">NoteLogic V1.14</h1>
        <div class="text-xs font-mono font-bold text-blue-500 tracking-[0.3em] mt-2">INITIALISATION FLUX...</div>
    </div>

    <!-- SIDEBAR -->
    <aside id="main-sidebar" class="w-full md:w-[360px] border-r border-white/5 flex flex-col shrink-0 bg-[#0b1120]">
        <header class="h-12 flex items-center justify-between px-3 border-b border-white/5 shrink-0 bg-[#0f172a]">
            <span class="text-xs font-black text-white uppercase">Classeur</span>
            <div class="flex gap-1 items-center">
                <button data-action="newPage" class="text-[10px] font-bold bg-blue-500/10 text-blue-400 px-2 py-1 rounded border border-blue-500/20">+ NOTE</button>
                <button data-action="toggleView" data-view="pages" id="btn-view-pages" class="px-2 py-0.5 rounded text-[10px] font-bold uppercase text-slate-400 view-btn-active">Pages</button>
                <button data-action="toggleView" data-view="index" id="btn-view-index" class="px-2 py-0.5 rounded text-[10px] font-bold uppercase text-slate-400">Nexus</button>
            </div>
        </header>
        <div class="flex-1 overflow-y-auto custom-scrollbar">
            <div id="view-pages"><div id="ui-binder-content" class="flex flex-col"></div></div>
            <div id="view-index" class="hidden"><div id="ui-nexus-content"></div></div>
        </div>
    </aside>

    <!-- MAIN -->
    <main class="flex-1 flex flex-col relative overflow-hidden bg-[#0f172a]">
        <header class="h-12 border-b border-white/5 flex items-center justify-between px-4 bg-[#0f172a] z-20">
            <div class="flex items-center gap-2">
                <button data-action="toggleSidebar" class="p-2 text-slate-500 hover:text-white">‚ò∞</button>
                <button data-action="insertIndex" class="p-1.5 text-blue-500/80 font-mono font-bold">[ ]</button>
            </div>
            <div class="flex items-center gap-2">
                <button data-action="triggerSitrep" class="px-2 py-1 text-[10px] font-bold text-blue-400 bg-blue-500/5 border border-blue-500/20">üì° SITREP</button>
                <button data-action="socialBroadcast" class="p-2 text-indigo-400 hover:bg-indigo-500/10 rounded">üì§</button>
                <button data-action="openSearch" class="p-2 text-slate-500 hover:text-white">üîç</button>
                <button data-action="dispatchToPage" class="p-2 text-emerald-400 hover:bg-emerald-500/10 rounded">üíæ</button>
            </div>
        </header>

        <div class="flex-1 overflow-hidden p-6 md:p-12 flex flex-col relative z-10">
            <div class="max-w-4xl mx-auto w-full editor-layer rounded-lg flex-1 overflow-hidden">
                <div id="canvas-container"></div>
                <div id="main-editor" contenteditable="true" class="custom-scrollbar" placeholder="Saisir donn√©es..."></div>
            </div>
        </div>
    </main>

    <div id="toast" class="toast">Notif</div>

    <!-- MODAL SEARCH -->
    <div id="modal-search" class="modal-overlay" data-action="closeModals">
        <div class="modal-box p-4" onclick="event.stopPropagation()">
            <input type="text" id="search-input" class="w-full bg-black/20 text-white p-3 rounded border border-white/10 outline-none" placeholder="Rechercher...">
            <div id="search-results" class="mt-4 max-h-[40vh] overflow-auto"></div>
        </div>
    </div>

    <!-- MODAL SOCIAL -->
    <div id="modal-social" class="modal-overlay" data-action="closeModals">
        <div class="modal-box p-6 space-y-4" onclick="event.stopPropagation()">
            <h3 class="text-white font-bold">TRANSMISSION</h3>
            <button data-action="shareTwitter" class="w-full p-3 bg-black/40 text-white rounded">Partager sur X</button>
            <button data-action="copyToClipboard" class="w-full p-3 bg-indigo-500/20 text-indigo-300 rounded">Copier le texte</button>
        </div>
    </div>

    <script>
        // Logique simplifi√©e pour la d√©monstration du favicon et du broadcast
        const System = (() => {
            const Storage = {
                db: null,
                async init() {
                    this.db = new Dexie("NoteLogic_Ops");
                    this.db.version(1).stores({ pages: "++id, title, updated", meta: "id" });
                    const draft = await this.db.meta.get('draft');
                    if(draft) document.getElementById('main-editor').innerHTML = draft.content;
                },
                async saveDraft(c) { await this.db.meta.put({id: 'draft', content: c}); },
                async getPages() { return await this.db.pages.orderBy('updated').reverse().toArray(); },
                async createPage(title, content) { await this.db.pages.add({ title, content, updated: Date.now() }); }
            };

            const Bus = {
                handle(e) {
                    const t = e.target.closest('[data-action]');
                    if(t) {
                        const act = t.dataset.action;
                        if(act === 'newPage') { document.getElementById('main-editor').innerHTML = ''; Storage.saveDraft(''); }
                        if(act === 'openSearch') document.getElementById('modal-search').style.display = 'flex';
                        if(act === 'socialBroadcast') document.getElementById('modal-social').style.display = 'flex';
                        if(act === 'closeModals') document.querySelectorAll('.modal-overlay').forEach(m => m.style.display = 'none');
                        if(act === 'dispatchToPage') this.save();
                        if(act === 'copyToClipboard') {
                            navigator.clipboard.writeText(document.getElementById('main-editor').innerText);
                            document.getElementById('modal-social').style.display = 'none';
                            this.toast("COPI√â");
                        }
                    }
                },
                async save() {
                    const text = document.getElementById('main-editor').innerText.trim();
                    if(!text) return;
                    const title = text.split('\n')[0].substring(0, 30);
                    await Storage.createPage(title, document.getElementById('main-editor').innerHTML);
                    document.getElementById('main-editor').innerHTML = '';
                    Storage.saveDraft('');
                    this.toast("ENREGISTR√â");
                },
                toast(m) {
                    const el = document.getElementById('toast');
                    el.textContent = m; el.style.opacity = 1;
                    setTimeout(() => el.style.opacity = 0, 2000);
                }
            };

            return {
                init: async () => {
                    await Storage.init();
                    document.body.addEventListener('click', (e) => Bus.handle(e));
                    document.getElementById('main-editor').addEventListener('input', () => Storage.saveDraft(document.getElementById('main-editor').innerHTML));
                    setTimeout(() => document.getElementById('splash-screen').remove(), 1000);
                }
            };
        })();
        window.onload = System.init;
    </script>
</body>
</html>
